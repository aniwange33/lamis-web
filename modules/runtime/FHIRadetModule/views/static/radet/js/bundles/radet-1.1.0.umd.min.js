!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("@lamis/web-core"),require("moment"),require("@stomp/ng2-stompjs"),require("@angular/platform-browser"),require("file-saver"),require("@angular/common"),require("@angular/material"),require("@angular/router"),require("@angular/forms"),require("@syncfusion/ej2-angular-dropdowns"),require("@syncfusion/ej2-angular-calendars")):"function"==typeof define&&define.amd?define("radet-1.1.0",["exports","@angular/core","@angular/common/http","@lamis/web-core","moment","@stomp/ng2-stompjs","@angular/platform-browser","file-saver","@angular/common","@angular/material","@angular/router","@angular/forms","@syncfusion/ej2-angular-dropdowns","@syncfusion/ej2-angular-calendars"],t):t(((e=e||self)["radet-1"]=e["radet-1"]||{},e["radet-1"][1]=e["radet-1"][1]||{},e["radet-1"][1][0]={}),e.ng.core,e.ng.common.http,e.webCore,e.moment_,e.ng2Stompjs,e.ng.platformBrowser,e.fileSaver,e.ng.common,e.ng.material,e.ng.router,e.ng.forms,e.ej2AngularDropdowns,e.ej2AngularCalendars)}(this,(function(e,t,r,n,a,i,o,s,l,c,d,u,m,p){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function f(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var g=a,b=function(){function e(e,t){this.http=e,this.serverUrl=t,this.resourceUrl="",this.resourceUrl=t.SERVER_API_URL+"/api/radet"}var a,i;return e.prototype.convert=function(e,t,a,i,o){var s=new r.HttpParams;return s=(s=(s=(s=s.append("cohortStart",g(e).format(n.DATE_FORMAT))).append("cohortEnd",g(t).format(n.DATE_FORMAT))).append("reportingPeriod",g(a).format(n.DATE_FORMAT))).append("today",o),i.forEach((function(e){return s=s.append("ids",e.toString())})),this.http.get(this.resourceUrl+"/convert",{params:s})},e.prototype.listFacilities=function(){return this.http.get(this.resourceUrl+"/list-facilities")},e.prototype.download=function(e){return this.http.get(this.resourceUrl+"/download/"+e,{responseType:"blob"})},e.prototype.listFiles=function(){return this.http.get(this.resourceUrl+"/list-files")},e.ctorParameters=function(){return[{type:r.HttpClient},{type:void 0,decorators:[{type:t.Inject,args:[n.SERVER_API_URL_CONFIG]}]}]},e=f([t.Injectable(),(a=1,i=t.Inject(n.SERVER_API_URL_CONFIG),function(e,t){i(e,t,a)}),h("design:paramtypes",[r.HttpClient,Object])],e)}(),v=function(){function e(e,t,r){this.service=e,this.stompService=t,this.domSanitizer=r,this.facilities=[],this.running=!1,this.finished=!1,this.dateRange={start:new Date(1900,0,1),end:new Date},this.reportingPeriod=new Date,this.todaySelectable=!0,this.today=new Date,this.current=!1}return e.prototype.ngOnInit=function(){var e=this;this.service.listFacilities().subscribe((function(t){return e.facilities=t})),this.topicSubscription=this.stompService.watch("/topic/radet/status").subscribe((function(t){"start"===t.body?e.running=!0:"end"===t.body?(e.running=!1,e.message="Conversion finished; download files from Download tab",e.finished=!0,e.service.listFiles().subscribe((function(t){e.files=t}))):(e.message=t.body,e.running=!0)}))},e.prototype.selected=function(){return this.facilities.filter((function(e){return e.selected})).length>0},e.prototype.download=function(e){this.service.download(e).subscribe((function(t){var r=new File([t],e+"_Radet.xlsx",{type:"application/octet-stream"});s.saveAs(r)}))},e.prototype.tabChanged=function(e){var t=this;1===e.index&&this.service.listFiles().subscribe((function(e){t.files=e}))},e.prototype.monthChanged=function(e){this.todaySelectable=(new Date).getMonth()===e.getMonth()},e.prototype.convert=function(){this.running=!0,this.finished=!1;var e=this.facilities.filter((function(e){return e.selected})).map((function(e){return e.id}));this.service.convert(this.dateRange.start,this.dateRange.end,this.reportingPeriod,e,this.current).subscribe()},e.prototype.ngOnDestroy=function(){this.topicSubscription.unsubscribe()},e.ctorParameters=function(){return[{type:b},{type:i.RxStompService},{type:o.DomSanitizer}]},e=f([t.Component({selector:"radet-converter",template:'<mat-card>\r\n    <mat-card-content>\r\n        <mat-tab-group (selectedTabChange)="tabChanged($event)">\r\n            <mat-tab label="Conversion">\r\n                <mat-card>\r\n                    <mat-card-header class="full-width">\r\n                        <ng-container *ngIf="running">\r\n                            <div class="full-width">\r\n                                <mat-progress-bar class="full-width" mode="indeterminate"></mat-progress-bar>\r\n                                <mat-form-field class="full-width">\r\n                                    <input [disabled]="true" matInput [value]="message"/>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </ng-container>\r\n                        <ng-container *ngIf="finished">\r\n                            <div class="full-width">\r\n                                <mat-form-field class="full-width">\r\n                                    <input [disabled]="true" matInput [value]="message"/>\r\n                                </mat-form-field>\r\n                            </div>\r\n                        </ng-container>\r\n                    </mat-card-header>\r\n                    <mat-card-content>\r\n                        <mat-list>\r\n                            <div mat-subheader>Available Facilities</div>\r\n                            <mat-list-item *ngFor="let facility of facilities">\r\n                                <div mat-line>\r\n                                    <mat-checkbox\r\n                                            [(ngModel)]="facility.selected"\r\n                                            labelPosition="after">\r\n                                        {{facility.name}}\r\n                                    </mat-checkbox>\r\n                                </div>\r\n                            </mat-list-item>\r\n                        </mat-list>\r\n                        <mat-divider></mat-divider>\r\n                        <div class="row">\r\n                            <div class="col-md-6">\r\n                                <ejs-daterangepicker placeholder="Select Cohort" [start]="\'Year\'" [format]="\'MMM yyyy\'"\r\n                                                     [max]="today"\r\n                                                     [(value)]="dateRange"\r\n                                                     [depth]="\'Year\'">\r\n                                </ejs-daterangepicker>\r\n                            </div>\r\n                            <div class="col-md-6">\r\n                                <ejs-datepicker placeholder="Select Reporting period" [start]="\'Year\'"\r\n                                                [format]="\'MMMM y\'"\r\n                                                [(value)]="reportingPeriod"\r\n                                                (valueChange)="monthChanged($event)"\r\n                                                [depth]="\'Year\'">\r\n                                </ejs-datepicker>\r\n                            </div>\r\n                        </div>\r\n                        <div class="row">\r\n                            <div class="col-md-6">\r\n                                <mat-checkbox [(ngModel)]="current" name="today" *ngIf="todaySelectable">As at today</mat-checkbox>\r\n                            </div>\r\n                        </div>\r\n                    </mat-card-content>\r\n                    <mat-card-actions>\r\n                        <button mat-raised-button color="primary"\r\n                                (click)="convert()"\r\n                                [disabled]="running || !selected() || !dateRange || !reportingPeriod">Generate Radet\r\n                        </button>\r\n                    </mat-card-actions>\r\n                </mat-card>\r\n            </mat-tab>\r\n            <mat-tab label="Download">\r\n                <mat-list>\r\n                    <div mat-subheader>Available Radet Files</div>\r\n                    <mat-list-item *ngFor="let file of files">\r\n                        <div mat-line>\r\n                            {{file}}\r\n                            <button mat-list-icon\r\n                                    (click)="download(file)">\r\n                                <mat-icon>file_download</mat-icon>\r\n                            </button>\r\n                        </div>\r\n                    </mat-list-item>\r\n                </mat-list>\r\n            </mat-tab>\r\n        </mat-tab-group>\r\n    </mat-card-content>\r\n</mat-card>\r\n'}),h("design:paramtypes",[b,i.RxStompService,o.DomSanitizer])],e)}(),y={title:"Radet Converter",breadcrumb:"RADET CONVERTER"},M={breadcrumb:"RADET CONVERTER",title:"Radet Converter"},R=[{path:"",data:y,children:[{path:"",component:v,data:M}]}],w=function(){function e(){}return e=f([t.NgModule({declarations:[v],imports:[l.CommonModule,u.FormsModule,c.MatInputModule,c.MatIconModule,c.MatDividerModule,c.MatCardModule,c.MatSelectModule,c.MatButtonModule,c.MatTabsModule,d.RouterModule.forChild(R),c.MatProgressBarModule,c.MatListModule,c.MatCheckboxModule,p.DateRangePickerModule,m.DropDownListModule,p.DatePickerModule],exports:[v],providers:[b]})],e)}();e.ROUTES=R,e.RadetConverterComponent=v,e.RadetConverterService=b,e.RadetModule=w,e.ɵ0=y,e.ɵ1=M,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=radet-1.1.0.umd.min.js.map
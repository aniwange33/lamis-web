import * as tslib_1 from "tslib";
import { Component } from '@angular/core';
import { ClinicService } from '../../services/clinic.service';
import { NotificationService } from '@alfresco/adf-core';
import { ActivatedRoute } from '@angular/router';
import * as moment_ from 'moment';
import { AppLoaderService, DATE_FORMAT, entityCompare } from '@lamis/web-core';
import { ColumnMode } from '@swimlane/ngx-datatable';
const moment = moment_;
let ClinicEditComponent = class ClinicEditComponent {
    constructor(clinicService, notification, activatedRoute, appLoaderService) {
        this.clinicService = clinicService;
        this.notification = notification;
        this.activatedRoute = activatedRoute;
        this.appLoaderService = appLoaderService;
        this.error = false;
        this.today = moment();
        this.visitDates = [];
        this.selectedClinicAdr = [];
        this.oiList = [];
        this.adhereList = [];
        this.ColumnMode = ColumnMode;
        this.adr = false;
        this.otzApplicable = false;
        this.hasOtz = false;
    }
    createEntity() {
        return {};
    }
    ngOnInit() {
        this.clinicService.opportunisticInfections().subscribe(res => this.opportunisticInfections = res);
        this.clinicService.adheres().subscribe(res => this.adheres = res);
        this.isSaving = false;
        this.clinicService.getRegimenLines().subscribe(res => {
            this.regimenLines = res;
        });
        this.activatedRoute.data.subscribe(({ entity }) => {
            this.commence = !!this.activatedRoute.snapshot.data['commence'];
            this.entity = !!entity && entity.body ? entity.body : entity;
            if (this.entity === undefined) {
                this.entity = this.createEntity();
            }
            const patientId = this.activatedRoute.snapshot.paramMap.get('patientId');
            this.clinicService.getPatient(patientId).subscribe((res) => {
                this.entity.patient = res;
                this.entity.facility = res.facility;
                this.dateBirth = res.dateBirth;
                this.dateRegistration = res.dateRegistration;
                if (res.statusAtRegistration === 'ART_TRANSFER_IN') {
                    this.dateRegistration = moment('1999-01-01', 'YYYY-MM-DD');
                    if (this.dateRegistration.isBefore(this.entity.patient.dateBirth)) {
                        this.dateRegistration = this.entity.patient.dateBirth.clone().add(3, 'months');
                    }
                }
                if (res.extra && res.extra.prep && res.extra.prep.registered) {
                    this.prep = true;
                    this.clinicService.getRegimenLines().subscribe(res1 => {
                        this.regimenLines = res1.filter(t => {
                            return t.id === 30;
                        });
                    });
                }
                this.clinicService.enrolledOnOTZ(res.id).subscribe(r => {
                    this.enrolledOnOTZ = r;
                    this.hasOtz = r;
                });
                this.otzApplicable = !moment().subtract(24, 'years').isAfter(this.entity.patient.dateBirth)
                    && !moment().subtract(10, 'years').isBefore(this.entity.patient.dateBirth);
                this.clinicService.getVisitDatesByPatient(this.entity.patient.id).subscribe((res1) => {
                    this.visitDates = res1;
                });
            });
            if (this.entity.commence && this.entity.regimenType) {
                this.regimenLineChange(this.entity.regimenType);
            }
            this.commence = this.commence || this.entity.commence;
            if (this.commence) {
                this.entity.commence = true;
                if (this.entity.regimenType) {
                    this.regimenLineChange(this.entity.regimenType);
                }
            }
            if (this.entity.id) {
                this.appointmentMin = this.entity.dateVisit.clone().add(14, 'days');
                this.appointmentMax = this.entity.dateVisit.clone().add(8, 'months');
                this.clinicService.adverseDrugReactions().subscribe(res1 => {
                    this.adverseDrugReactions = res1;
                    this.adr = !!this.entity.adverseDrugReactions;
                    this.adverseDrugReactions.forEach(adr => {
                        let found = false;
                        (this.entity.adverseDrugReactions || []).forEach(cadr => {
                            if (cadr.adverseDrugReaction.id === adr.id) {
                                found = true;
                                this.selectedClinicAdr.push(cadr);
                            }
                        });
                        if (!found) {
                            this.selectedClinicAdr.push({
                                adverseDrugReaction: adr
                            });
                        }
                    });
                    this.selectedClinicAdr = [...this.selectedClinicAdr];
                    if (this.entity.extra) {
                        if (this.entity.extra.prep) {
                            this.hivTestResult = this.entity.extra.prep.hivTestResult;
                            this.creatinineClearance = this.entity.extra.prep.creatinineClearance;
                            this.hepatitisB = this.entity.extra.prep.hepatitisB;
                            this.hepatitisC = this.entity.extra.prep.hepatitisC;
                            this.urinalysis = this.entity.extra.prep.urinalysis;
                        }
                        if (this.entity.extra.otz) {
                            if (!!this.entity.extra.otz.dateOfFullDisclosure) {
                                this.dateOfFullDisclosure = moment(this.entity.extra.otz.dateOfFullDisclosure);
                            }
                            this.attendedLastOTZMeeting = !!this.entity.extra.otz.attendedLastOTZMeeting;
                            this.enrolledOnOTZ = !!this.entity.extra.otz.enrolledOnOTZ;
                            if (!!this.entity.extra.otz.dateEnrolledOnOTZ) {
                                this.dateEnrolledOnOTZ = moment(this.entity.extra.otz.dateEnrolledOnOTZ);
                            }
                            if (!!this.entity.extra.otz.dateLastOTZMeeting) {
                                this.dateLastOTZMeeting = moment(this.entity.extra.otz.dateLastOTZMeeting);
                            }
                            this.caregiverPhone = this.entity.extra.otz.caregiverPhone;
                            this.caregiverAddress = this.entity.extra.otz.caregiverAddress;
                            this.modulesCompleted = this.entity.extra.otz.modulesCompleted;
                            this.fullDisclosure = this.entity.extra.otz.fullDisclosure;
                        }
                    }
                });
            }
            else {
                this.clinicService.adverseDrugReactions().subscribe(res => {
                    this.adverseDrugReactions = res;
                    this.adverseDrugReactions.forEach(adr => {
                        this.selectedClinicAdr.push({
                            adverseDrugReaction: adr
                        });
                    });
                });
                this.selectedClinicAdr = [...this.selectedClinicAdr];
            }
        });
    }
    updateValue(event, cell, row) {
        console.log('Edit', event, cell, row);
        this.selectedClinicAdr = [...this.selectedClinicAdr.map(cadr => {
                if (cadr.adverseDrugReaction && cadr.adverseDrugReaction.id === row.id) {
                    cadr.severity = event;
                }
                return cadr;
            })];
        console.log('UPDATED!', row, event);
    }
    filterDates(date) {
        let exists = false;
        this.visitDates.forEach(d => {
            if (date.diff(d, 'days') === 0) {
                exists = true;
            }
        });
        return (this.entity.id && date.diff(this.entity.dateVisit, 'days') === 0) || !exists;
    }
    dateChanged(date) {
        this.appointmentMax = date.clone().add(6, 'months');
        this.lmpMin = date.clone().subtract(2, 'years');
        this.appointmentMin = date.clone().add(14, 'days');
        this.otzApplicable = !date.clone().subtract(24, 'years').isAfter(this.entity.patient.dateBirth)
            && !date.clone().subtract(10, 'years').isBefore(this.entity.patient.dateBirth);
    }
    entityCompare(e1, e2) {
        return entityCompare(e1, e2);
    }
    previousState() {
        window.history.back();
    }
    save() {
        this.isSaving = true;
        if (!this.entity.extra) {
            this.entity.extra = {};
        }
        this.entity.extra.otz = {};
        this.entity.extra.otz.fullDisclosure = this.fullDisclosure;
        this.entity.extra.otz.dateOfFullDisclosure = this.dateOfFullDisclosure != null && this.dateOfFullDisclosure.isValid() ?
            this.dateOfFullDisclosure.format(DATE_FORMAT) : null;
        this.entity.extra.otz.dateEnrolledOnOTZ = this.dateEnrolledOnOTZ != null && this.dateEnrolledOnOTZ.isValid() ?
            this.dateEnrolledOnOTZ.format(DATE_FORMAT) : null;
        this.entity.extra.otz.attendedLastOTZMeeting = !!this.attendedLastOTZMeeting;
        this.entity.extra.otz.dateLastOTZMeeting = this.dateLastOTZMeeting != null && this.dateLastOTZMeeting.isValid() ?
            this.dateLastOTZMeeting.format(DATE_FORMAT) : null;
        this.entity.extra.otz.enrolledOnOTZ = this.enrolledOnOTZ;
        this.entity.extra.otz.caregiverPhone = this.caregiverPhone;
        this.entity.extra.otz.caregiverAddress = this.caregiverAddress;
        this.entity.extra.otz.modulesCompleted = this.modulesCompleted;
        if (this.prep) {
            this.entity.extra.prep = {};
            this.entity.extra.prep.hivTestResult = this.hivTestResult;
            this.entity.extra.prep.creatinineClearance = this.creatinineClearance;
            this.entity.extra.prep.hepatitisB = this.hepatitisB;
            this.entity.extra.prep.hepatitisC = this.hepatitisC;
            this.entity.extra.prep.urinalysis = this.urinalysis;
        }
        this.entity.adverseDrugReactions = this.selectedClinicAdr.filter(cadr => !!cadr.severity);
        this.entity.opportunisticInfections = this.oiList;
        this.entity.adheres = this.adhereList;
        this.appLoaderService.open('Saving clinic visit..');
        if (this.entity.id !== undefined) {
            this.subscribeToSaveResponse(this.clinicService.update(this.entity));
        }
        else {
            this.subscribeToSaveResponse(this.clinicService.create(this.entity));
        }
    }
    regimenLineChange(type) {
        this.clinicService.getRegimenByLine(type.id).subscribe(res => this.regimens = res);
    }
    subscribeToSaveResponse(result) {
        result.subscribe((res) => this.onSaveSuccess(res.body), (res) => {
            this.onSaveError();
            this.onError(res.message);
        });
    }
    onSaveSuccess(result) {
        this.appLoaderService.close();
        this.isSaving = false;
        this.notification.showInfo('Clinic visit successfully saved');
        this.previousState();
    }
    onSaveError() {
        this.isSaving = false;
        this.appLoaderService.close();
        this.error = true;
        // this.submitButton.disabled = true;
        this.notification.showError('Error occurred saving clinic visit; try again');
        // this.progressBar.mode = 'determinate';
    }
    onError(errorMessage) {
        this.appLoaderService.close();
        this.notification.showError(errorMessage);
    }
};
ClinicEditComponent.ctorParameters = () => [
    { type: ClinicService },
    { type: NotificationService },
    { type: ActivatedRoute },
    { type: AppLoaderService }
];
ClinicEditComponent = tslib_1.__decorate([
    Component({
        selector: 'lamis-clinic-edit',
        template: "<div class=\"lamis-edit-form\">\n    <div class=\"lamis-edit-form-container\">\n        <form name=\"form\" role=\"form\" novalidate (ngSubmit)=\"save()\" #clinicForm=\"ngForm\">\n            <mat-card class=\"default\">\n                <mat-card-content *ngIf=\"!!entity.patient\">\n                    <ng-container *ngIf=\"commence === true\">\n                        <div>\n                            <mat-form-field class=\"full-width\">\n                                <input matInput [matDatepicker]=\"picker\"\n                                       placeholder=\"ART Start Date\"\n                                       [(ngModel)]=\"entity.dateVisit\"\n                                       #visit=\"ngModel\"\n                                       (dateChange)=\"dateChanged($event.value)\"\n                                       [matDatepickerFilter]=\"filterDates.bind(this)\"\n                                       [max]=\"today\"\n                                       [min]=\"dateRegistration\"\n                                       name=\"visit\"\n                                       required>\n                                <mat-datepicker-toggle\n                                        matSuffix\n                                        [for]=\"picker\">\n                                </mat-datepicker-toggle>\n                                <mat-datepicker #picker></mat-datepicker>\n                                <mat-error\n                                        *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.required)\">\n                                    {{prep ? 'Date of PrEP Initiation ' : 'ART Start Date '}}is required\n                                </mat-error>\n                                <mat-error\n                                        *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.min)\">\n                                    Date of visit cannot be before {{dateRegistration | date: 'dd MMM, yyyy'}}\n                                </mat-error>\n                                <mat-error\n                                        *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.max)\">\n                                    {{prep ? 'Date of PrEP Initiation ' : 'ART Start Date '}}cannot be in the future\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"row\" *ngIf=\"!prep\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <input matInput placeholder=\"CD4 at start of ART\" [min]=\"0\" type=\"number\"\n                                           #cd4=\"ngModel\" name=\"cd4\" [(ngModel)]=\"entity.cd4\"/>\n                                    <mat-error\n                                            *ngIf=\"cd4.errors && (cd4.dirty || cd4.touched) && (cd4.errors.min)\">\n                                        Minimum CD4 is 0\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <input matInput placeholder=\"CD4 %\" [min]=\"0\" [max]=\"100\" type=\"number\"\n                                           #cd4p=\"ngModel\" name=\"cd4p\" [(ngModel)]=\"entity.cd4p\"/>\n                                    <mat-error\n                                            *ngIf=\"cd4p.errors && (cd4p.dirty || cd4p.touched) && (cd4p.errors.min)\">\n                                        Minimum CD4 % is 0\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"cd4p.errors && (cd4p.dirty || cd4p.touched) && (cd4p.errors.max)\">\n                                        Maximum CD4 % is 100\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-select [(ngModel)]=\"entity.regimenType\"\n                                                placeholder=\"Original Regimen Line\"\n                                                #rtype=\"ngModel\" required name=\"rt\"\n                                                [compareWith]=\"entityCompare\"\n                                                (selectionChange)=\"regimenLineChange($event.value)\">\n                                        <mat-option>None</mat-option>\n                                        <mat-option *ngFor=\"let line of regimenLines\"\n                                                    [value]=\"line\">{{line.description}}</mat-option>\n                                        <mat-error\n                                                *ngIf=\"rtype.errors && (rtype.dirty || rtype.touched) && (rtype.errors.required)\">\n                                            Regimen Line is required\n                                        </mat-error>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-select [(ngModel)]=\"entity.regimen\"\n                                                placeholder=\"Original Regimen\"\n                                                [compareWith]=\"entityCompare\"\n                                                #rm=\"ngModel\" required name=\"rm\">\n                                        <mat-option>None</mat-option>\n                                        <mat-option *ngFor=\"let regimen of regimens\"\n                                                    [value]=\"regimen\">{{regimen.description}}</mat-option>\n                                        <mat-error\n                                                *ngIf=\"rm.errors && (rm.dirty || rm.touched) && (rm.errors.required)\">\n                                            Regimen is required\n                                        </mat-error>\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                    </ng-container>\n                    <div *ngIf=\"commence === false || commence === undefined\">\n                        <mat-form-field class=\"full-width\">\n                            <input matInput [matDatepicker]=\"picker\"\n                                   placeholder=\"Date of Visit\"\n                                   [(ngModel)]=\"entity.dateVisit\"\n                                   [matDatepickerFilter]=\"filterDates.bind(this)\"\n                                   #visit=\"ngModel\"\n                                   (dateChange)=\"dateChanged($event.value)\"\n                                   [max]=\"today\"\n                                   [min]=\"dateRegistration\"\n                                   name=\"visit\"\n                                   required>\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.required)\">\n                                Date of visit is required\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.min)\">\n                                Date of visit cannot be before {{dateRegistration | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.max)\">\n                                Date of visit cannot be in the future\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <ng-container *ngIf=\"otzApplicable && !hasOtz\">\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-checkbox [(ngModel)]=\"fullDisclosure\" name=\"fd\">\n                                    Full Disclosure?\n                                </mat-checkbox>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\" *ngIf=\"fullDisclosure\">\n                                    <input matInput [matDatepicker]=\"picker8\"\n                                           placeholder=\"Date of Full Disclosure\"\n                                           [(ngModel)]=\"dateOfFullDisclosure\"\n                                           #dfd=\"ngModel\"\n                                           [max]=\"today\"\n                                           [min]=\"entity.patient.dateBirth\"\n                                           name=\"dfd\"\n                                           required>\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker8\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker8></mat-datepicker>\n                                    <mat-error\n                                            *ngIf=\"dfd.errors && (dfd.dirty || dfd.touched) && (dfd.errors.required)\">\n                                        Date of Full Disclosure is required\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"dfd.errors && (dfd.dirty || dfd.touched) && (dfd.errors.min)\">\n                                        Date of Full Disclosure cannot be before date of\n                                        birth {{entity.patient.dateBirth | date: 'dd MMM, yyyy'}}\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"dfd.errors && (dfd.dirty || dfd.touched) && (dfd.errors.max)\">\n                                        Date of Full Disclosure cannot be in the future\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <ng-container *ngIf=\"fullDisclosure && !hasOtz\">\n                            <div class=\"row\">\n                                <div class=\"col-md-6\">\n                                    <mat-checkbox [(ngModel)]=\"enrolledOnOTZ\" name=\"otz\">\n                                        Enrolled on OTZ?\n                                    </mat-checkbox>\n                                </div>\n                                <div class=\"col-md-6\">\n                                    <mat-form-field class=\"full-width\" *ngIf=\"enrolledOnOTZ\">\n                                        <input matInput [matDatepicker]=\"picker7\"\n                                               placeholder=\"Date Enrolled on OTZ\"\n                                               [(ngModel)]=\"dateEnrolledOnOTZ\"\n                                               #otze=\"ngModel\"\n                                               [max]=\"today\"\n                                               [min]=\"entity.patient.dateBirth\"\n                                               name=\"otze\"\n                                               [required]=\"enrolledOnOTZ\">\n                                        <mat-datepicker-toggle\n                                                matSuffix\n                                                [for]=\"picker7\">\n                                        </mat-datepicker-toggle>\n                                        <mat-datepicker #picker7></mat-datepicker>\n                                        <mat-error\n                                                *ngIf=\"otze.errors && (otze.dirty || otze.touched) && (otze.errors.required)\">\n                                            Date enrolled on OTZ is required\n                                        </mat-error>\n                                        <mat-error\n                                                *ngIf=\"otze.errors && (otze.dirty || otze.touched) && (otze.errors.min)\">\n                                            Date enrolled on OTZ cannot be before date of\n                                            birth {{entity.patient.dateBirth | date: 'dd MMM, yyyy'}}\n                                        </mat-error>\n                                        <mat-error\n                                                *ngIf=\"otze.errors && (otze.dirty || otze.touched) && (otze.errors.max)\">\n                                            Date enrolled on OTZ cannot be in the future\n                                        </mat-error>\n                                    </mat-form-field>\n                                </div>\n                            </div>\n                            <ng-container *ngIf=\"enrolledOnOTZ\">\n                                <fieldset>\n                                    <legend>OTZ</legend>\n                                    <div class=\"row\">\n                                        <div class=\"col-md-6\">\n                                            <mat-form-field class=\"full-width\">\n                                                <mat-label>Caregiver Phone</mat-label>\n                                                <input matInput name=\"phone\" [(ngModel)]=\"caregiverPhone\"\n                                                       #phone=\"ngModel\"\n                                                       phoneNumber/>\n                                                <mat-error\n                                                        *ngIf=\"phone.errors && (phone.dirty || phone.touched) && (phone.errors.required)\">\n                                                    Caregiver phone number is required\n                                                </mat-error>\n                                                <mat-error\n                                                        *ngIf=\"phone.errors && (phone.dirty || phone.touched || !!entity.id) && (phone.errors.phoneNumber)\">\n                                                    Invalid phone number\n                                                </mat-error>\n                                            </mat-form-field>\n                                        </div>\n                                        <div class=\"col-md-6\">\n                                            <mat-form-field class=\"full-width\">\n                                                <mat-label>Caregiver Address</mat-label>\n                                                <textarea matInput name=\"address\" [(ngModel)]=\"caregiverAddress\"\n                                                          #address=\"ngModel\"\n                                                          rows=\"2\">\n                                            </textarea>\n                                                <mat-error\n                                                        *ngIf=\"address.errors && (address.dirty || address.touched) && (address.errors.required)\">\n                                                    Case Manager address is required\n                                                </mat-error>\n                                            </mat-form-field>\n                                        </div>\n                                    </div>\n                                </fieldset>\n                            </ng-container>\n                        </ng-container>\n                    </ng-container>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"entity.clinicStage\"\n                                        placeholder=\"Clinical Stage\"\n                                        #clinicStage=\"ngModel\" name=\"cs\">\n                                <mat-option>None</mat-option>\n                                <mat-option [value]=\"'Stage I'\">Stage I</mat-option>\n                                <mat-option [value]=\"'Stage II'\">Stage II</mat-option>\n                                <mat-option [value]=\"'Stage III'\">Stage III</mat-option>\n                                <mat-option [value]=\"'Stage IV'\">Stage IV</mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"entity.funcStatus\"\n                                        placeholder=\"Functional Status\"\n                                        #funcStatus=\"ngModel\" name=\"fs\">\n                                <mat-option>None</mat-option>\n                                <mat-option [value]=\"'Working'\">Working</mat-option>\n                                <mat-option [value]=\"'Ambulatory'\">Ambulatory</mat-option>\n                                <mat-option [value]=\"'Bedridden'\">Bedridden</mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <ng-container *ngIf=\"prep\">\n                        <fieldset>\n                            <legend>PrEP</legend>\n                            <div *ngIf=\"commence\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-select [(ngModel)]=\"hivTestResult\"\n                                                placeholder=\"HIV Status at PrEP Initiation\"\n                                                required\n                                                #hivStatus=\"ngModel\" name=\"htr\">\n                                        <mat-option>None</mat-option>\n                                        <mat-option [value]=\"'NEGATIVE'\">Negative</mat-option>\n                                        <mat-option [value]=\"'POSITIVE'\">Positive</mat-option>\n                                    </mat-select>\n                                    <mat-error\n                                            *ngIf=\"hivStatus.errors && (hivStatus.dirty || hivStatus.touched) && (hivStatus.errors.required)\">\n                                        HIV Status is required\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                            <div *ngIf=\"!commence\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-select [(ngModel)]=\"hivTestResult\"\n                                                placeholder=\"HIV Status /Test Result\"\n                                                required\n                                                #hivStatus=\"ngModel\" name=\"htr\">\n                                        <mat-option>None</mat-option>\n                                        <mat-option [value]=\"'NEGATIVE'\">Negative</mat-option>\n                                        <mat-option [value]=\"'POSITIVE'\">Positive</mat-option>\n                                        <mat-option [value]=\"'NOT_DONE'\">Not Done</mat-option>\n                                    </mat-select>\n                                    <mat-error\n                                            *ngIf=\"hivStatus.errors && (hivStatus.dirty || hivStatus.touched) && (hivStatus.errors.required)\">\n                                        HIV Status is required\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                            <ng-container *ngIf=\"commence\">\n                                <div class=\"row\">\n                                    <div class=\"col-md-6\">\n                                        <mat-form-field class=\"full-width\">\n                                            <input matInput [(ngModel)]=\"creatinineClearance\"\n                                                   placeholder=\"Creatinine Clearance (mL/min)\"\n                                                   #creatinine=\"ngModel\" name=\"creatinine\"/>\n                                        </mat-form-field>\n                                    </div>\n                                    <div class=\"col-md-6\">\n                                        <mat-form-field class=\"full-width\">\n                                            <mat-select [(ngModel)]=\"urinalysis\"\n                                                        placeholder=\"Urinalysis\"\n                                                        #urinal=\"ngModel\" name=\"urinalysis\">\n                                                <mat-option>None</mat-option>\n                                                <mat-option [value]=\"'Normal'\">Normal</mat-option>\n                                                <mat-option [value]=\"'Deranged'\">Deranged</mat-option>\n                                            </mat-select>\n                                        </mat-form-field>\n                                    </div>\n                                </div>\n                                <div class=\"row\">\n                                    <div class=\"col-md-6\">\n                                        <mat-form-field class=\"full-width\">\n                                            <mat-select [(ngModel)]=\"hepatitisB\"\n                                                        placeholder=\"Hepatitis B Screening\"\n                                                        #hepatitisb=\"ngModel\" name=\"hepatitisB\">\n                                                <mat-option>None</mat-option>\n                                                <mat-option [value]=\"'Positive'\">Positive</mat-option>\n                                                <mat-option [value]=\"'Negative'\">Negative</mat-option>\n                                                <mat-option [value]=\"'Not Done'\">Not Done</mat-option>\n                                            </mat-select>\n                                        </mat-form-field>\n                                    </div>\n                                    <div class=\"col-md-6\">\n                                        <mat-form-field class=\"full-width\">\n                                            <mat-select [(ngModel)]=\"hepatitisC\"\n                                                        placeholder=\"Hepatitis C Screening\"\n                                                        #hepatitisb=\"ngModel\" name=\"hepatitisC\">\n                                                <mat-option>None</mat-option>\n                                                <mat-option [value]=\"'Positive'\">Positive</mat-option>\n                                                <mat-option [value]=\"'Negative'\">Negative</mat-option>\n                                                <mat-option [value]=\"'Not Done'\">Not Done</mat-option>\n                                            </mat-select>\n                                        </mat-form-field>\n                                    </div>\n                                </div>\n                            </ng-container>\n                        </fieldset>\n                    </ng-container>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"entity.tbStatus\"\n                                        placeholder=\"TB Status\"\n                                        name=\"tb\"\n                                        #tbStatus=\"ngModel\">\n                                <mat-option>None</mat-option>\n                                <mat-option [value]=\"'No sign or symptoms of TB'\">No sign or symptoms of TB</mat-option>\n                                <mat-option [value]=\"'TB suspected and referred for evaluation'\">TB suspected and\n                                    referred\n                                    for evaluation\n                                </mat-option>\n                                <mat-option [value]=\"'Currently on INH prophylaxis'\">Currently on INH prophylaxis\n                                </mat-option>\n                                <mat-option [value]=\"'Currently on TB treatment'\">Currently on TB treatment</mat-option>\n                                <mat-option [value]=\"'TB positive not on TB drugs'\">TB positive not on TB drugs\n                                </mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <input matInput placeholder=\"Body weight(Kg)\" [min]=\"0\" [max]=\"250\" type=\"number\"\n                                   #weight=\"ngModel\" name=\"weight\" [(ngModel)]=\"entity.bodyWeight\"/>\n                            <mat-error\n                                    *ngIf=\"weight.errors && (weight.dirty || weight.touched) && (weight.errors.min)\">\n                                Minimum body weight is 0\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"weight.errors && (weight.dirty || weight.touched) && (weight.errors.max)\">\n                                Maximum body weight is 250\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <input matInput placeholder=\"Height (m)\" [min]=\"0\" [max]=\"1.8\" type=\"number\"\n                                   #height=\"ngModel\" name=\"height\" [(ngModel)]=\"entity.height\"/>\n                            <mat-error\n                                    *ngIf=\"height.errors && (height.dirty || height.touched) && (height.errors.min)\">\n                                Minimum height is 0\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"height.errors && (height.dirty || height.touched) && (height.errors.max)\">\n                                Maximum height is 1.8m\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <fieldset>\n                        <h6>Blood Pressure(mmHg)</h6>\n                        <div class=\"row\">\n                            <div class=\"col-md-3\">\n                                <mat-form-field class=\"full-width\">\n                                    <input matInput placeholder=\"Systolic\"\n                                           name=\"bp1\" type=\"number\"\n                                           [max]=\"190\"\n                                           [min]=\"70\"\n                                           [required]=\"!!entity.bp2\"\n                                           #bp1=\"ngModel\" [(ngModel)]=\"entity.bp1\"/>\n                                    <mat-error\n                                            *ngIf=\"bp1.errors && (bp1.dirty || bp1.touched) && (bp1.errors.max)\">\n                                        Maximum Systolic is 190\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"bp1.errors && (bp1.dirty || bp1.touched) && (bp1.errors.min)\">\n                                        Minimum Systolic is 70\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"bp1.errors && (bp1.dirty || bp1.touched) && (bp1.errors.required)\">\n                                        Systolic is required\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                            <div class=\"col-md-3\">\n                                <mat-form-field class=\"full-width\">\n                                    <input matInput placeholder=\"Diastolic\"\n                                           name=\"bp2\" type=\"number\"\n                                           [max]=\"100\"\n                                           [min]=\"40\"\n                                           [required]=\"!!entity.bp1\"\n                                           #bp2=\"ngModel\" [(ngModel)]=\"entity.bp2\"/>\n                                    <mat-error\n                                            *ngIf=\"bp2.errors && (bp2.dirty || bp2.touched) && (bp2.errors.max)\">\n                                        Maximum Diastolic is 100\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"bp2.errors && (bp2.dirty || bp2.touched) && (bp2.errors.min)\">\n                                        Minimum Diastolic is 40\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"bp2.errors && (bp2.dirty || bp2.touched) && (bp2.errors.required)\">\n                                        Diastolic is required\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                    </fieldset>\n                    <div *ngIf=\"entity.patient && entity.patient.gender === 'FEMALE'\">\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"entity.pregnancyStatus\"\n                                        placeholder=\"Pregnancy Status\"\n                                        #pregStatus=\"ngModel\" name=\"ps\">\n                                <mat-option>None</mat-option>\n                                <mat-option [value]=\"1\">Not Pregnant</mat-option>\n                                <mat-option [value]=\"2\">Pregnant</mat-option>\n                                <mat-option [value]=\"3\">Breastfeeding</mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div *ngIf=\"entity.patient && entity.patient.gender === 'FEMALE' && lmpMin\">\n                        <mat-form-field class=\"full-width\">\n                            <input matInput [matDatepicker]=\"picker1\"\n                                   placeholder=\"LMP\"\n                                   [(ngModel)]=\"entity.lmp\"\n                                   #lmp=\"ngModel\"\n                                   [max]=\"entity.dateVisit\"\n                                   [min]=\"lmpMin\"\n                                   name=\"lmp\">\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker1\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker1></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"lmp.errors && (lmp.dirty || lmp.touched) && (lmp.errors.max)\">\n                                LMP cannot be after {{entity.dateVisit | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"lmp.errors && (lmp.dirty || lmp.touched) && (lmp.errors.min)\">\n                                LMP cannot be before {{lmpMin | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"oiList\"\n                                        placeholder=\"Opportunistic Infections\"\n                                        [compareWith]=\"entityCompare\"\n                                        name=\"ois\"\n                                        #oiIds=\"ngModel\" multiple>\n                                <mat-option>None</mat-option>\n                                <mat-option *ngFor=\"let oi of opportunisticInfections\"\n                                            [value]=\"oi\">{{oi.description}}</mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-4\">\n                            <mat-checkbox [(ngModel)]=\"adr\"\n                                          name=\"ad\">Adverse Drug Reaction Screened?\n                            </mat-checkbox>\n                        </div>\n                        <div style=\"height: 300px; overflow-y: auto;\" *ngIf=\"adr\" class=\"col-md-8\">\n                            <adf-datatable [rows]=\"selectedClinicAdr\"\n                                           [stickyHeader]=\"true\">\n                                <data-columns>\n                                    <data-column key=\"adverseDrugReaction.description\" title=\"Description\"\n                                                 sortable=\"true\"></data-column>\n                                    <data-column key=\"severity\" title=\"Severity\" sortable=\"false\">\n                                        <ng-template let-context=\"$implicit\">\n                                            <mat-form-field class=\"full-width\">\n                                                <mat-select autofocus\n                                                            [value]=\"context.row.getValue('severity')\"\n                                                            name=\"severity\"\n                                                            (valueChange)=\"updateValue($event, 'severity', context.row.getValue('adverseDrugReaction'))\">\n                                                    <mat-option>None</mat-option>\n                                                    <mat-option [value]=\"'Grade 1'\">Grade 1</mat-option>\n                                                    <mat-option [value]=\"'Grade 2'\">Grade 2</mat-option>\n                                                    <mat-option [value]=\"'Grade 3'\">Grade 3</mat-option>\n                                                    <mat-option [value]=\"'Grade 4'\">Grade 4</mat-option>\n                                                </mat-select>\n                                            </mat-form-field>\n                                        </ng-template>\n                                    </data-column>\n                                </data-columns>\n                            </adf-datatable>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\">\n                                <mat-select [(ngModel)]=\"entity.adherenceLevel\"\n                                            placeholder=\"Level of Adherence\"\n                                            #adherence=\"ngModel\" name=\"al\">\n                                    <mat-option>None</mat-option>\n                                    <mat-option [value]=\"'Good'\">Good</mat-option>\n                                    <mat-option [value]=\"'Fair'\">Fair</mat-option>\n                                    <mat-option [value]=\"'Poor'\">Poor</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\"\n                                            *ngIf=\"entity.adherenceLevel === 'Fair' || entity.adherenceLevel === 'Poor'\">\n                                <mat-select [(ngModel)]=\"adhereList\"\n                                            placeholder=\"Adherence\"\n                                            name=\"ads\"\n                                            [compareWith]=\"entityCompare\"\n                                            #adrIds=\"ngModel\" multiple>\n                                    <mat-option>None</mat-option>\n                                    <mat-option *ngFor=\"let adhere of adheres\"\n                                                [value]=\"adhere\">{{adhere.description}}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <ng-container *ngIf=\"otzApplicable || enrolledOnOTZ\">\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-checkbox [(ngModel)]=\"attendedLastOTZMeeting\" name=\"aotz\">\n                                    Attended last support group (OTZ club) meeting?\n                                </mat-checkbox>\n                            </div>\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\" *ngIf=\"attendedLastOTZMeeting\">\n                                    <input matInput [matDatepicker]=\"picker8\"\n                                           placeholder=\"Date of Last OTZ Club Meeting\"\n                                           [(ngModel)]=\"dateLastOTZMeeting\"\n                                           #lotzm=\"ngModel\"\n                                           [max]=\"today\"\n                                           [min]=\"dateEnrolledOnOTZ\"\n                                           name=\"lotzm\"\n                                           [required]=\"attendedLastOTZMeeting\">\n                                    <mat-datepicker-toggle\n                                            matSuffix\n                                            [for]=\"picker8\">\n                                    </mat-datepicker-toggle>\n                                    <mat-datepicker #picker8></mat-datepicker>\n                                    <mat-error\n                                            *ngIf=\"lotzm.errors && (lotzm.dirty || lotzm.touched) && (lotzm.errors.required)\">\n                                        Date of Last OTZ meeting is required\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"lotzm.errors && (lotzm.dirty || lotzm.touched) && (lotzm.errors.min)\">\n                                        Date of last OTZ meeting cannot be\n                                        before {{dateEnrolledOnOTZ | date: 'dd MMM, yyyy'}}\n                                    </mat-error>\n                                    <mat-error\n                                            *ngIf=\"lotzm.errors && (lotzm.dirty || lotzm.touched) && (lotzm.errors.max)\">\n                                        Date of last OTZ meeting cannot be in the future\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <mat-form-field class=\"full-width\">\n                                    <mat-select name=\"modules\" [(ngModel)]=\"modulesCompleted\" #modules=\"ngModel\"\n                                                [required]=\"attendedLastOTZMeeting\">\n                                        <mat-option></mat-option>\n                                        <mat-option [value]=\"1\">1</mat-option>\n                                        <mat-option [value]=\"2\">2</mat-option>\n                                        <mat-option [value]=\"3\">3</mat-option>\n                                        <mat-option [value]=\"4\">4</mat-option>\n                                        <mat-option [value]=\"5\">5</mat-option>\n                                        <mat-option [value]=\"6\">6</mat-option>\n                                        <mat-option [value]=\"7\">7</mat-option>\n                                    </mat-select>\n                                    <mat-error\n                                            *ngIf=\"modules.errors && (modules.dirty || modules.touched) && (modules.errors.required)\">\n                                        Number of modules attended required\n                                    </mat-error>\n                                </mat-form-field>\n                            </div>\n                        </div>\n                    </ng-container>\n                    <div *ngIf=\"!!appointmentMin\">\n                        <mat-form-field class=\"full-width\">\n                            <input matInput [matDatepicker]=\"picker2\"\n                                   placeholder=\"Date of Next Appointment\"\n                                   [(ngModel)]=\"entity.nextAppointment\"\n                                   #na=\"ngModel\"\n                                   [min]=\"appointmentMin\"\n                                   [max]=\"appointmentMax\"\n                                   name=\"na\"\n                                   required>\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker2\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker2></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"na.errors && (na.dirty || na.touched) && (na.errors.required)\">\n                                Date of next appointment is required\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"na.errors && (na.dirty || na.touched) && (na.errors.max)\">\n                                Date of next appointment cannot be after {{appointmentMax | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"na.errors && (na.dirty || na.touched) && (na.errors.min)\">\n                                Date of next appointment cannot be before {{appointmentMin | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <textarea matInput placeholder=\"Clinical Notes\"\n                                      cols=\"30\"\n                                      rows=\"3\"\n                                      name=\"notes\"\n                                      #note=\"ngModel\" [(ngModel)]=\"entity.notes\"></textarea>\n                        </mat-form-field>\n                    </div>\n                    <mat-card-actions class=\"lamis-edit-form-actions\">\n                        <button mat-raised-button type=\"button\" (click)=\"previousState()\">Back</button>\n                        <button mat-raised-button color='primary'\n                                [disabled]=\"clinicForm.invalid || isSaving\"\n                                type=\"submit\">\n                            {{entity.id !== undefined ? 'Update' : 'Save'}}\n                        </button>\n                    </mat-card-actions>\n                </mat-card-content>\n            </mat-card>\n        </form>\n    </div>\n</div>\n"
    }),
    tslib_1.__metadata("design:paramtypes", [ClinicService,
        NotificationService,
        ActivatedRoute,
        AppLoaderService])
], ClinicEditComponent);
export { ClinicEditComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpbmljLWVkaXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbGFtaXMtY2xpbmljLTEuNC4wLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvY2xpbmljL2NsaW5pYy1lZGl0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBUyxNQUFNLGVBQWUsQ0FBQztBQVNoRCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sK0JBQStCLENBQUM7QUFDNUQsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDdkQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBRy9DLE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDO0FBRWxDLE9BQU8sRUFBQyxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDN0UsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBRW5ELE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQztBQU12QixJQUFhLG1CQUFtQixHQUFoQyxNQUFhLG1CQUFtQjtJQTBDNUIsWUFBb0IsYUFBNEIsRUFDMUIsWUFBaUMsRUFDakMsY0FBOEIsRUFDaEMsZ0JBQWtDO1FBSGxDLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzFCLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtRQUNqQyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDaEMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQXhDdEQsVUFBSyxHQUFHLEtBQUssQ0FBQztRQUVkLFVBQUssR0FBRyxNQUFNLEVBQUUsQ0FBQztRQVdqQixlQUFVLEdBQWEsRUFBRSxDQUFDO1FBQzFCLHNCQUFpQixHQUFnQyxFQUFFLENBQUM7UUFDcEQsV0FBTSxHQUE2QixFQUFFLENBQUM7UUFDdEMsZUFBVSxHQUFhLEVBQUUsQ0FBQztRQUMxQixlQUFV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QWdCOztBQTdDN0MsbUJBQW1CO0lBSi9CLFNBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxtQkFBbUI7UUFDN0Isb2c1Q0FBMkM7S0FDOUMsQ0FBQzs2Q0EyQ3FDLGFBQWE7UUFDWixtQkFBbUI7UUFDakIsY0FBYztRQUNkLGdCQUFnQjtHQTdDN0MsbUJBQW1CLENBcVMvQjtTQXJTWSxtQkFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgT25Jbml0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgQWRoZXJlLFxuICAgIEFkdmVyc2VEcnVnUmVhY3Rpb24sXG4gICAgQ2xpbmljLFxuICAgIENsaW5pY0FkdmVyc2VEcnVnUmVhY3Rpb24sXG4gICAgQ2xpbmljVm0sXG4gICAgT3Bwb3J0dW5pc3RpY0luZmVjdGlvblxufSBmcm9tICcuLi8uLi9tb2RlbC9jbGluaWMubW9kZWwnO1xuaW1wb3J0IHtDbGluaWNTZXJ2aWNlfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jbGluaWMuc2VydmljZSc7XG5pbXBvcnQge05vdGlmaWNhdGlvblNlcnZpY2V9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge0FjdGl2YXRlZFJvdXRlfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtIdHRwRXJyb3JSZXNwb25zZSwgSHR0cFJlc3BvbnNlfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHtNb21lbnR9IGZyb20gJ21vbWVudCc7XG5pbXBvcnQge0FwcExvYWRlclNlcnZpY2UsIERBVEVfRk9STUFULCBlbnRpdHlDb21wYXJlfSBmcm9tICdAbGFtaXMvd2ViLWNvcmUnO1xuaW1wb3J0IHtDb2x1bW5Nb2RlfSBmcm9tICdAc3dpbWxhbmUvbmd4LWRhdGF0YWJsZSc7XG5cbmNvbnN0IG1vbWVudCA9IG1vbWVudF87XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbGFtaXMtY2xpbmljLWVkaXQnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9jbGluaWMtZWRpdC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQ2xpbmljRWRpdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgLy8gQFZpZXdDaGlsZChNYXRQcm9ncmVzc0Jhciwge3N0YXRpYzogdHJ1ZX0pIHByb2dyZXNzQmFyOiBNYXRQcm9ncmVzc0JhcjtcbiAgICAvLyBAVmlld0NoaWxkKE1hdEJ1dHRvbiwge3N0YXRpYzogdHJ1ZX0pIHN1Ym1pdEJ1dHRvbjogTWF0QnV0dG9uO1xuICAgIGVudGl0eTogQ2xpbmljO1xuICAgIGlzU2F2aW5nOiBib29sZWFuO1xuICAgIGVycm9yID0gZmFsc2U7XG4gICAgY29tbWVuY2U6IGFueTtcbiAgICB0b2RheSA9IG1vbWVudCgpO1xuICAgIGxtcE1pbjogTW9tZW50O1xuICAgIGFwcG9pbnRtZW50TWF4OiBNb21lbnQ7XG4gICAgYXBwb2ludG1lbnRNaW46IE1vbWVudDtcbiAgICBvcHBvcnR1bmlzdGljSW5mZWN0aW9uczogT3Bwb3J0dW5pc3RpY0luZmVjdGlvbltdO1xuICAgIGFkdmVyc2VEcnVnUmVhY3Rpb25zOiBBZHZlcnNlRHJ1Z1JlYWN0aW9uW107XG4gICAgYWRoZXJlczogQWRoZXJlW107XG4gICAgcmVnaW1lbkxpbmVzOiBhbnlbXTtcbiAgICByZWdpbWVuczogYW55W107XG4gICAgZGF0ZUJpcnRoOiBNb21lbnQ7XG4gICAgZGF0ZVJlZ2lzdHJhdGlvbjogTW9tZW50O1xuICAgIHZpc2l0RGF0ZXM6IE1vbWVudFtdID0gW107XG4gICAgc2VsZWN0ZWRDbGluaWNBZHI6IENsaW5pY0FkdmVyc2VEcnVnUmVhY3Rpb25bXSA9IFtdO1xuICAgIG9pTGlzdDogT3Bwb3J0dW5pc3RpY0luZmVjdGlvbltdID0gW107XG4gICAgYWRoZXJlTGlzdDogQWRoZXJlW10gPSBbXTtcbiAgICBDb2x1bW5Nb2RlID0gQ29sdW1uTW9kZTtcbiAgICBhZHIgPSBmYWxzZTtcbiAgICBlbnJvbGxlZE9uT1RaOiBib29sZWFuO1xuICAgIGZ1bGxEaXNjbG9zdXJlOiBib29sZWFuO1xuICAgIGRhdGVPZkZ1bGxEaXNjbG9zdXJlOiBNb21lbnQ7XG4gICAgZGF0ZUVucm9sbGVkT25PVFo6IE1vbWVudDtcbiAgICBhdHRlbmRlZExhc3RPVFpNZWV0aW5nOiBib29sZWFuO1xuICAgIGRhdGVMYXN0T1RaTWVldGluZzogTW9tZW50O1xuICAgIG1vZHVsZXNDb21wbGV0ZWQ6IG51bWJlcjtcbiAgICBjYXJlZ2l2ZXJQaG9uZTogc3RyaW5nO1xuICAgIGNhcmVnaXZlckFkZHJlc3M6IHN0cmluZztcbiAgICBvdHpBcHBsaWNhYmxlID0gZmFsc2U7XG4gICAgaGFzT3R6ID0gZmFsc2U7XG4gICAgaGl2VGVzdFJlc3VsdDogc3RyaW5nO1xuICAgIHByZXA6IGJvb2xlYW47XG4gICAgdXJpbmFseXNpczogc3RyaW5nO1xuICAgIGhlcGF0aXRpc0I6IHN0cmluZztcbiAgICBoZXBhdGl0aXNDOiBzdHJpbmc7XG4gICAgY3JlYXRpbmluZUNsZWFyYW5jZTogYW55O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjbGluaWNTZXJ2aWNlOiBDbGluaWNTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCBub3RpZmljYXRpb246IE5vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcExvYWRlclNlcnZpY2U6IEFwcExvYWRlclNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBjcmVhdGVFbnRpdHkoKTogQ2xpbmljIHtcbiAgICAgICAgcmV0dXJuIDxDbGluaWM+e307XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5vcHBvcnR1bmlzdGljSW5mZWN0aW9ucygpLnN1YnNjcmliZShyZXMgPT4gdGhpcy5vcHBvcnR1bmlzdGljSW5mZWN0aW9ucyA9IHJlcyk7XG4gICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5hZGhlcmVzKCkuc3Vic2NyaWJlKHJlcyA9PiB0aGlzLmFkaGVyZXMgPSByZXMpO1xuICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5nZXRSZWdpbWVuTGluZXMoKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVnaW1lbkxpbmVzID0gcmVzO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5kYXRhLnN1YnNjcmliZSgoe2VudGl0eX0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29tbWVuY2UgPSAhIXRoaXMuYWN0aXZhdGVkUm91dGUuc25hcHNob3QuZGF0YVsnY29tbWVuY2UnXTtcblxuICAgICAgICAgICAgdGhpcy5lbnRpdHkgPSAhIWVudGl0eSAmJiBlbnRpdHkuYm9keSA/IGVudGl0eS5ib2R5IDogZW50aXR5O1xuICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVudGl0eSA9IHRoaXMuY3JlYXRlRW50aXR5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBwYXRpZW50SWQgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnNuYXBzaG90LnBhcmFtTWFwLmdldCgncGF0aWVudElkJyk7XG5cbiAgICAgICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5nZXRQYXRpZW50KHBhdGllbnRJZCkuc3Vic2NyaWJlKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVudGl0eS5wYXRpZW50ID0gcmVzO1xuICAgICAgICAgICAgICAgIHRoaXMuZW50aXR5LmZhY2lsaXR5ID0gcmVzLmZhY2lsaXR5O1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0ZUJpcnRoID0gcmVzLmRhdGVCaXJ0aDtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGVSZWdpc3RyYXRpb24gPSByZXMuZGF0ZVJlZ2lzdHJhdGlvbjtcblxuICAgICAgICAgICAgICAgIGlmIChyZXMuc3RhdHVzQXRSZWdpc3RyYXRpb24gPT09ICdBUlRfVFJBTlNGRVJfSU4nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0ZVJlZ2lzdHJhdGlvbiA9IG1vbWVudCgnMTk5OS0wMS0wMScsICdZWVlZLU1NLUREJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGVSZWdpc3RyYXRpb24uaXNCZWZvcmUodGhpcy5lbnRpdHkucGF0aWVudC5kYXRlQmlydGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGVSZWdpc3RyYXRpb24gPSB0aGlzLmVudGl0eS5wYXRpZW50LmRhdGVCaXJ0aC5jbG9uZSgpLmFkZCgzLCAnbW9udGhzJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5leHRyYSAmJiByZXMuZXh0cmEucHJlcCAmJiByZXMuZXh0cmEucHJlcC5yZWdpc3RlcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJlcCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbGluaWNTZXJ2aWNlLmdldFJlZ2ltZW5MaW5lcygpLnN1YnNjcmliZShyZXMxID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW1lbkxpbmVzID0gcmVzMS5maWx0ZXIodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuaWQgPT09IDMwO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5lbnJvbGxlZE9uT1RaKHJlcy5pZCkuc3Vic2NyaWJlKHIgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVucm9sbGVkT25PVFogPSByO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmhhc090eiA9IHI7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLm90ekFwcGxpY2FibGUgPSAhbW9tZW50KCkuc3VidHJhY3QoMjQsICd5ZWFycycpLmlzQWZ0ZXIodGhpcy5lbnRpdHkucGF0aWVudC5kYXRlQmlydGgpXG4gICAgICAgICAgICAgICAgICAgICYmICFtb21lbnQoKS5zdWJ0cmFjdCgxMCwgJ3llYXJzJykuaXNCZWZvcmUodGhpcy5lbnRpdHkucGF0aWVudC5kYXRlQmlydGgpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jbGluaWNTZXJ2aWNlLmdldFZpc2l0RGF0ZXNCeVBhdGllbnQodGhpcy5lbnRpdHkucGF0aWVudC5pZCkuc3Vic2NyaWJlKChyZXMxKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlzaXREYXRlcyA9IHJlczE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5jb21tZW5jZSAmJiB0aGlzLmVudGl0eS5yZWdpbWVuVHlwZSkge1xuICAgICAgICAgICAgICAgIHRoaXMucmVnaW1lbkxpbmVDaGFuZ2UodGhpcy5lbnRpdHkucmVnaW1lblR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jb21tZW5jZSA9IHRoaXMuY29tbWVuY2UgfHwgdGhpcy5lbnRpdHkuY29tbWVuY2U7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbW1lbmNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkuY29tbWVuY2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5yZWdpbWVuVHlwZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5MaW5lQ2hhbmdlKHRoaXMuZW50aXR5LnJlZ2ltZW5UeXBlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5pZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwb2ludG1lbnRNaW4gPSB0aGlzLmVudGl0eS5kYXRlVmlzaXQuY2xvbmUoKS5hZGQoMTQsICdkYXlzJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBvaW50bWVudE1heCA9IHRoaXMuZW50aXR5LmRhdGVWaXNpdC5jbG9uZSgpLmFkZCg4LCAnbW9udGhzJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGluaWNTZXJ2aWNlLmFkdmVyc2VEcnVnUmVhY3Rpb25zKCkuc3Vic2NyaWJlKHJlczEgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkdmVyc2VEcnVnUmVhY3Rpb25zID0gcmVzMTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkciA9ICEhdGhpcy5lbnRpdHkuYWR2ZXJzZURydWdSZWFjdGlvbnM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWR2ZXJzZURydWdSZWFjdGlvbnMuZm9yRWFjaChhZHIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5lbnRpdHkuYWR2ZXJzZURydWdSZWFjdGlvbnMgfHwgW10pLmZvckVhY2goY2FkciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhZHIuYWR2ZXJzZURydWdSZWFjdGlvbi5pZCA9PT0gYWRyLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENsaW5pY0Fkci5wdXNoKGNhZHIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRDbGluaWNBZHIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmVyc2VEcnVnUmVhY3Rpb246IGFkclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENsaW5pY0FkciA9IFsuLi50aGlzLnNlbGVjdGVkQ2xpbmljQWRyXTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5lbnRpdHkuZXh0cmEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5leHRyYS5wcmVwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oaXZUZXN0UmVzdWx0ID0gdGhpcy5lbnRpdHkuZXh0cmEucHJlcC5oaXZUZXN0UmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRpbmluZUNsZWFyYW5jZSA9IHRoaXMuZW50aXR5LmV4dHJhLnByZXAuY3JlYXRpbmluZUNsZWFyYW5jZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmhlcGF0aXRpc0IgPSB0aGlzLmVudGl0eS5leHRyYS5wcmVwLmhlcGF0aXRpc0I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5oZXBhdGl0aXNDID0gdGhpcy5lbnRpdHkuZXh0cmEucHJlcC5oZXBhdGl0aXNDO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXJpbmFseXNpcyA9IHRoaXMuZW50aXR5LmV4dHJhLnByZXAudXJpbmFseXNpcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZW50aXR5LmV4dHJhLm90eikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlT2ZGdWxsRGlzY2xvc3VyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGVPZkZ1bGxEaXNjbG9zdXJlID0gbW9tZW50KHRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlT2ZGdWxsRGlzY2xvc3VyZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXR0ZW5kZWRMYXN0T1RaTWVldGluZyA9ICEhdGhpcy5lbnRpdHkuZXh0cmEub3R6LmF0dGVuZGVkTGFzdE9UWk1lZXRpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbnJvbGxlZE9uT1RaID0gISF0aGlzLmVudGl0eS5leHRyYS5vdHouZW5yb2xsZWRPbk9UWjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISF0aGlzLmVudGl0eS5leHRyYS5vdHouZGF0ZUVucm9sbGVkT25PVFopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRlRW5yb2xsZWRPbk9UWiA9IG1vbWVudCh0aGlzLmVudGl0eS5leHRyYS5vdHouZGF0ZUVucm9sbGVkT25PVFopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghIXRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlTGFzdE9UWk1lZXRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRlTGFzdE9UWk1lZXRpbmcgPSBtb21lbnQodGhpcy5lbnRpdHkuZXh0cmEub3R6LmRhdGVMYXN0T1RaTWVldGluZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FyZWdpdmVyUGhvbmUgPSB0aGlzLmVudGl0eS5leHRyYS5vdHouY2FyZWdpdmVyUGhvbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXJlZ2l2ZXJBZGRyZXNzID0gdGhpcy5lbnRpdHkuZXh0cmEub3R6LmNhcmVnaXZlckFkZHJlc3M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2R1bGVzQ29tcGxldGVkID0gdGhpcy5lbnRpdHkuZXh0cmEub3R6Lm1vZHVsZXNDb21wbGV0ZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mdWxsRGlzY2xvc3VyZSA9IHRoaXMuZW50aXR5LmV4dHJhLm90ei5mdWxsRGlzY2xvc3VyZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsaW5pY1NlcnZpY2UuYWR2ZXJzZURydWdSZWFjdGlvbnMoKS5zdWJzY3JpYmUocmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZHZlcnNlRHJ1Z1JlYWN0aW9ucyA9IHJlcztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZHZlcnNlRHJ1Z1JlYWN0aW9ucy5mb3JFYWNoKGFkciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQ2xpbmljQWRyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmVyc2VEcnVnUmVhY3Rpb246IGFkclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZENsaW5pY0FkciA9IFsuLi50aGlzLnNlbGVjdGVkQ2xpbmljQWRyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXBkYXRlVmFsdWUoZXZlbnQsIGNlbGwsIHJvdzogQWR2ZXJzZURydWdSZWFjdGlvbikge1xuICAgICAgICBjb25zb2xlLmxvZygnRWRpdCcsIGV2ZW50LCBjZWxsLCByb3cpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkQ2xpbmljQWRyID0gWy4uLnRoaXMuc2VsZWN0ZWRDbGluaWNBZHIubWFwKGNhZHIgPT4ge1xuICAgICAgICAgICAgaWYgKGNhZHIuYWR2ZXJzZURydWdSZWFjdGlvbiAmJiBjYWRyLmFkdmVyc2VEcnVnUmVhY3Rpb24uaWQgPT09IHJvdy5pZCkge1xuICAgICAgICAgICAgICAgIGNhZHIuc2V2ZXJpdHkgPSBldmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjYWRyO1xuICAgICAgICB9KV07XG4gICAgICAgIGNvbnNvbGUubG9nKCdVUERBVEVEIScsIHJvdywgZXZlbnQpO1xuICAgIH1cblxuXG4gICAgZmlsdGVyRGF0ZXMoZGF0ZTogTW9tZW50KTogYm9vbGVhbiB7XG4gICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnZpc2l0RGF0ZXMuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICAgIGlmIChkYXRlLmRpZmYoZCwgJ2RheXMnKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKHRoaXMuZW50aXR5LmlkICYmIGRhdGUuZGlmZih0aGlzLmVudGl0eS5kYXRlVmlzaXQsICdkYXlzJykgPT09IDApIHx8ICFleGlzdHM7XG4gICAgfVxuXG4gICAgZGF0ZUNoYW5nZWQoZGF0ZTogTW9tZW50KSB7XG4gICAgICAgIHRoaXMuYXBwb2ludG1lbnRNYXggPSBkYXRlLmNsb25lKCkuYWRkKDYsICdtb250aHMnKTtcbiAgICAgICAgdGhpcy5sbXBNaW4gPSBkYXRlLmNsb25lKCkuc3VidHJhY3QoMiwgJ3llYXJzJyk7XG4gICAgICAgIHRoaXMuYXBwb2ludG1lbnRNaW4gPSBkYXRlLmNsb25lKCkuYWRkKDE0LCAnZGF5cycpO1xuXG4gICAgICAgIHRoaXMub3R6QXBwbGljYWJsZSA9ICFkYXRlLmNsb25lKCkuc3VidHJhY3QoMjQsICd5ZWFycycpLmlzQWZ0ZXIodGhpcy5lbnRpdHkucGF0aWVudC5kYXRlQmlydGgpXG4gICAgICAgICAgICAmJiAhZGF0ZS5jbG9uZSgpLnN1YnRyYWN0KDEwLCAneWVhcnMnKS5pc0JlZm9yZSh0aGlzLmVudGl0eS5wYXRpZW50LmRhdGVCaXJ0aCk7XG4gICAgfVxuXG4gICAgZW50aXR5Q29tcGFyZShlMSwgZTIpIHtcbiAgICAgICAgcmV0dXJuIGVudGl0eUNvbXBhcmUoZTEsIGUyKTtcbiAgICB9XG5cbiAgICBwcmV2aW91c1N0YXRlKCkge1xuICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgfVxuXG4gICAgc2F2ZSgpIHtcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IHRydWU7XG4gICAgICAgIGlmICghdGhpcy5lbnRpdHkuZXh0cmEpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhID0ge307XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6ID0ge307XG5cbiAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmZ1bGxEaXNjbG9zdXJlID0gdGhpcy5mdWxsRGlzY2xvc3VyZTtcbiAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6LmRhdGVPZkZ1bGxEaXNjbG9zdXJlID0gdGhpcy5kYXRlT2ZGdWxsRGlzY2xvc3VyZSAhPSBudWxsICYmIHRoaXMuZGF0ZU9mRnVsbERpc2Nsb3N1cmUuaXNWYWxpZCgpID9cbiAgICAgICAgICAgIHRoaXMuZGF0ZU9mRnVsbERpc2Nsb3N1cmUuZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5kYXRlRW5yb2xsZWRPbk9UWiA9IHRoaXMuZGF0ZUVucm9sbGVkT25PVFogIT0gbnVsbCAmJiB0aGlzLmRhdGVFbnJvbGxlZE9uT1RaLmlzVmFsaWQoKSA/XG4gICAgICAgICAgICB0aGlzLmRhdGVFbnJvbGxlZE9uT1RaLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsO1xuICAgICAgICB0aGlzLmVudGl0eS5leHRyYS5vdHouYXR0ZW5kZWRMYXN0T1RaTWVldGluZyA9ICEhdGhpcy5hdHRlbmRlZExhc3RPVFpNZWV0aW5nO1xuICAgICAgICB0aGlzLmVudGl0eS5leHRyYS5vdHouZGF0ZUxhc3RPVFpNZWV0aW5nID0gdGhpcy5kYXRlTGFzdE9UWk1lZXRpbmcgIT0gbnVsbCAmJiB0aGlzLmRhdGVMYXN0T1RaTWVldGluZy5pc1ZhbGlkKCkgP1xuICAgICAgICAgICAgdGhpcy5kYXRlTGFzdE9UWk1lZXRpbmcuZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGw7XG4gICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLm90ei5lbnJvbGxlZE9uT1RaID0gdGhpcy5lbnJvbGxlZE9uT1RaO1xuICAgICAgICB0aGlzLmVudGl0eS5leHRyYS5vdHouY2FyZWdpdmVyUGhvbmUgPSB0aGlzLmNhcmVnaXZlclBob25lO1xuICAgICAgICB0aGlzLmVudGl0eS5leHRyYS5vdHouY2FyZWdpdmVyQWRkcmVzcyA9IHRoaXMuY2FyZWdpdmVyQWRkcmVzcztcbiAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEub3R6Lm1vZHVsZXNDb21wbGV0ZWQgPSB0aGlzLm1vZHVsZXNDb21wbGV0ZWQ7XG5cbiAgICAgICAgaWYgKHRoaXMucHJlcCkge1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEucHJlcCA9IHt9O1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEucHJlcC5oaXZUZXN0UmVzdWx0ID0gdGhpcy5oaXZUZXN0UmVzdWx0O1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEucHJlcC5jcmVhdGluaW5lQ2xlYXJhbmNlID0gdGhpcy5jcmVhdGluaW5lQ2xlYXJhbmNlO1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEucHJlcC5oZXBhdGl0aXNCID0gdGhpcy5oZXBhdGl0aXNCO1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEucHJlcC5oZXBhdGl0aXNDID0gdGhpcy5oZXBhdGl0aXNDO1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkuZXh0cmEucHJlcC51cmluYWx5c2lzID0gdGhpcy51cmluYWx5c2lzO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZW50aXR5LmFkdmVyc2VEcnVnUmVhY3Rpb25zID0gdGhpcy5zZWxlY3RlZENsaW5pY0Fkci5maWx0ZXIoY2FkciA9PiAhIWNhZHIuc2V2ZXJpdHkpO1xuICAgICAgICB0aGlzLmVudGl0eS5vcHBvcnR1bmlzdGljSW5mZWN0aW9ucyA9IHRoaXMub2lMaXN0O1xuICAgICAgICB0aGlzLmVudGl0eS5hZGhlcmVzID0gdGhpcy5hZGhlcmVMaXN0O1xuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2Uub3BlbignU2F2aW5nIGNsaW5pYyB2aXNpdC4uJyk7XG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZVRvU2F2ZVJlc3BvbnNlKHRoaXMuY2xpbmljU2VydmljZS51cGRhdGUodGhpcy5lbnRpdHkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9TYXZlUmVzcG9uc2UodGhpcy5jbGluaWNTZXJ2aWNlLmNyZWF0ZSh0aGlzLmVudGl0eSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVnaW1lbkxpbmVDaGFuZ2UodHlwZTogYW55KSB7XG4gICAgICAgIHRoaXMuY2xpbmljU2VydmljZS5nZXRSZWdpbWVuQnlMaW5lKHR5cGUuaWQpLnN1YnNjcmliZShyZXMgPT4gdGhpcy5yZWdpbWVucyA9IHJlcyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdWJzY3JpYmVUb1NhdmVSZXNwb25zZShyZXN1bHQ6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPGFueT4+KSB7XG4gICAgICAgIHJlc3VsdC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAocmVzOiBIdHRwUmVzcG9uc2U8YW55PikgPT4gdGhpcy5vblNhdmVTdWNjZXNzKHJlcy5ib2R5KSxcbiAgICAgICAgICAgIChyZXM6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblNhdmVFcnJvcigpO1xuICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihyZXMubWVzc2FnZSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU2F2ZVN1Y2Nlc3MocmVzdWx0OiBhbnkpIHtcbiAgICAgICAgdGhpcy5hcHBMb2FkZXJTZXJ2aWNlLmNsb3NlKCk7XG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb24uc2hvd0luZm8oJ0NsaW5pYyB2aXNpdCBzdWNjZXNzZnVsbHkgc2F2ZWQnKTtcbiAgICAgICAgdGhpcy5wcmV2aW91c1N0YXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblNhdmVFcnJvcigpIHtcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMuc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb24uc2hvd0Vycm9yKCdFcnJvciBvY2N1cnJlZCBzYXZpbmcgY2xpbmljIHZpc2l0OyB0cnkgYWdhaW4nKTtcbiAgICAgICAgLy8gdGhpcy5wcm9ncmVzc0Jhci5tb2RlID0gJ2RldGVybWluYXRlJztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgb25FcnJvcihlcnJvck1lc3NhZ2U6IHN0cmluZykge1xuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb24uc2hvd0Vycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgfVxufVxuIl19
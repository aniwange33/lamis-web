import * as tslib_1 from "tslib";
import {Inject, Injectable} from '@angular/core';
import {HttpClient, HttpResponse} from '@angular/common/http';
import {DATE_FORMAT, SERVER_API_URL_CONFIG} from '@lamis/web-core';
import {map} from 'rxjs/operators';
import * as moment_ from 'moment';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@lamis/web-core";

var moment = moment_;
var DevolveService = /** @class */ (function () {
    function DevolveService(http, serverUrl) {
        this.http = http;
        this.serverUrl = serverUrl;
        this.resourceUrl = '';
        this.resourceUrl = serverUrl.SERVER_API_URL + '/api/devolves';
    }

    DevolveService.prototype.create = function (devolve) {
        var _this = this;
        var copy = this.convertDateFromClient(devolve);
        return this.http
            .post(this.resourceUrl, copy, {observe: 'response'})
            .pipe(map(function (res) {
                return _this.convertDateFromServer(res);
            }));
    };
    DevolveService.prototype.update = function (devolve) {
        var _this = this;
        var copy = this.convertDateFromClient(devolve);
        return this.http
            .put(this.resourceUrl, copy, {observe: 'response'})
            .pipe(map(function (res) {
                return _this.convertDateFromServer(res);
            }));
    };
    DevolveService.prototype.find = function (id) {
        var _this = this;
        return this.http
            .get(this.resourceUrl + "/" + id, {observe: 'response'})
            .pipe(map(function (res) {
                return _this.convertDateFromServer(res);
            }));
    };
    DevolveService.prototype.findByUuid = function (id) {
        var _this = this;
        return this.http
            .get(this.resourceUrl + "/by-uuid/" + id, {observe: 'response'})
            .pipe(map(function (res) {
                return _this.convertDateFromServer(res);
            }));
    };
    DevolveService.prototype.delete = function (id) {
        return this.http.delete(this.resourceUrl + "/" + id, {observe: 'response'});
    };
    DevolveService.prototype.getDevolveDatesByPatient = function (patientId) {
        return this.http.get(this.resourceUrl + "/patient/" + patientId + "/visit-dates")
            .pipe(map(function (res) {
                res.forEach(function (d) {
                    return moment(d);
                });
                return res;
            }));
    };
    DevolveService.prototype.getStates = function () {
        return this.http.get('/api/states');
    };
    DevolveService.prototype.getLgasByState = function (id) {
        return this.http.get("/api/provinces/state/" + id);
    };
    DevolveService.prototype.getCommunityPharmaciesByLga = function (id) {
        return this.http.get(this.resourceUrl + "/community-pharmacies/lga/" + id);
    };
    DevolveService.prototype.getRelatedPharmacy = function (devolveId, patientId, date) {
        var d = date.format(DATE_FORMAT);
        return this.http.get(this.resourceUrl + "/" + devolveId + "/patient/" + patientId + "/related-pharmacy/at/" + d)
            .pipe(map(function (res) {
                if (res.dateVisit) {
                    res.dateVisit = moment(res.dateVisit).format('DD MMM, YYYY');
                }
                return res;
            }));
    };
    DevolveService.prototype.getRelatedClinic = function (devolveId, patientId, date) {
        var d = date.format(DATE_FORMAT);
        return this.http.get(this.resourceUrl + "/" + devolveId + "/patient/" + patientId + "/related-clinic/at/" + d)
            .pipe(map(function (res) {
                if (res.dateVisit) {
                    res.dateVisit = moment(res.dateVisit).format('DD MMM, YYYY');
                }
                return res;
            }));
    };
    DevolveService.prototype.getRelatedViralLoad = function (devolveId, patientId, date) {
        var d = date.format(DATE_FORMAT);
        return this.http.get(this.resourceUrl + "/" + devolveId + "/patient/" + patientId + "/related-viral-load/at/" + d)
            .pipe(map(function (res) {
                if (res.dateResultReceived) {
                    res.dateResultReceived = moment(res.dateResultReceived).format('DD MMM, YYYY');
                }
                return res;
            }));
    };
    DevolveService.prototype.getRelatedCD4 = function (devolveId, patientId, date) {
        var d = date.format(DATE_FORMAT);
        return this.http.get(this.resourceUrl + "/" + devolveId + "/patient/" + patientId + "/related-cd4/at/" + d)
            .pipe(map(function (res) {
                if (res.dateResultReceived) {
                    res.dateResultReceived = moment(res.dateResultReceived).format('DD MMM, YYYY');
                }
                return res;
            }));
    };
    DevolveService.prototype.getStateByLga = function (id) {
        return this.http.get("/api/provinces/" + id + "/state");
    };
    DevolveService.prototype.convertDateFromClient = function (devolve) {
        var copy = Object.assign({}, devolve, {
            dateDevolved: devolve.dateDevolved != null && devolve.dateDevolved.isValid() ? devolve.dateDevolved.format(DATE_FORMAT) : null,
            dateNextClinic: devolve.dateNextClinic != null && devolve.dateNextClinic.isValid() ? devolve.dateNextClinic.format(DATE_FORMAT) : null,
            dateNextRefill: devolve.dateNextRefill != null && devolve.dateNextRefill.isValid() ? devolve.dateNextRefill.format(DATE_FORMAT) : null,
            dateDiscontinued: devolve.dateDiscontinued != null && devolve.dateDiscontinued.isValid() ? devolve.dateDiscontinued.format(DATE_FORMAT) : null,
            dateReturnedToFacility: devolve.dateReturnedToFacility != null && devolve.dateReturnedToFacility.isValid() ? devolve.dateReturnedToFacility.format(DATE_FORMAT) : null
        });
        return copy;
    };
    DevolveService.prototype.convertDateFromServer = function (res) {
        if (res.body) {
            res.body.dateReturnedToFacility = res.body.dateReturnedToFacility != null ? moment(res.body.dateReturnedToFacility) : null;
            res.body.dateNextRefill = res.body.dateNextRefill != null ? moment(res.body.dateNextRefill) : null;
            res.body.dateNextClinic = res.body.dateNextClinic != null ? moment(res.body.dateNextClinic) : null;
            res.body.dateDevolved = res.body.dateDevolved != null ? moment(res.body.dateDevolved) : null;
            res.body.dateDiscontinued = res.body.dateDiscontinued != null ? moment(res.body.dateDiscontinued) : null;
        }
        return res;
    };
    DevolveService.ctorParameters = function () {
        return [
            {type: HttpClient},
            {type: undefined, decorators: [{type: Inject, args: [SERVER_API_URL_CONFIG,]}]}
        ];
    };
    DevolveService.ngInjectableDef = i0.ɵɵdefineInjectable({
        factory: function DevolveService_Factory() {
            return new DevolveService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.SERVER_API_URL_CONFIG));
        }, token: DevolveService, providedIn: "root"
    });
    DevolveService = tslib_1.__decorate([
        Injectable({providedIn: 'root'}),
        tslib_1.__param(1, Inject(SERVER_API_URL_CONFIG)),
        tslib_1.__metadata("design:paramtypes", [HttpClient, Object])
    ], DevolveService);
    return DevolveService;
}());
export {DevolveService};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2b2x2ZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbGFtaXMtcGhhcm1hY3ktMS4xLjQvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvZGV2b2x2ZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWhFLE9BQU8sRUFBRSxXQUFXLEVBQUUscUJBQXFCLEVBQXNCLE1BQU0saUJBQWlCLENBQUM7QUFDekYsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDOzs7O0FBV2xDLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQztBQUt2QjtJQUdJLHdCQUFzQixJQUFnQixFQUF5QyxTQUE2QjtRQUF0RixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQXlDLGNBQVMsR0FBVCxTQUFTLENBQW9CO1FBRnJHLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBR3BCLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDLGNBQWMsR0FBRyxlQUFlLENBQUM7SUFDbEUsQ0FBQztJQUVELCtCQUFNLEdBQU4sVUFBTyxPQUFnQjtRQUF2QixpQkFLQztRQUpHLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNqRCxPQUFPLElBQUksQ0FBQyxJQUFJO2FBQ1gsSUFBSSxDQUFVLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLEVBQUMsT0FBTyxFQUFFLFVBQVUsRUFBQyxDQUFDO2FBQzVELElBQUksQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUF1QixJQUFLLE9BQUEsS0FBSSxDQUFDLHFCQUFxQixDQUFDLEdBQUcsQ0FBQyxFQUEvQixDQUErQixDQUFD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Y0FBYyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNuRyxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFDbkcsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQzdGLEdBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztTQUM1RztRQUNELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQzs7Z0JBNUgyQixVQUFVO2dEQUFHLE1BQU0sU0FBQyxxQkFBcUI7OztJQUg1RCxjQUFjO1FBRDFCLFVBQVUsQ0FBQyxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUMsQ0FBQztRQUlZLG1CQUFBLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFBO2lEQUExQyxVQUFVO09BSDdCLGNBQWMsQ0FnSTFCO3lCQXJKRDtDQXFKQyxBQWhJRCxJQWdJQztTQWhJWSxjQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBEQVRFX0ZPUk1BVCwgU0VSVkVSX0FQSV9VUkxfQ09ORklHLCBTZXJ2ZXJBcGlVcmxDb25maWcgfSBmcm9tICdAbGFtaXMvd2ViLWNvcmUnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHsgTW9tZW50IH0gZnJvbSAnbW9tZW50JztcbmltcG9ydCB7XG4gICAgQ29tbXVuaXR5UGhhcm1hY3ksXG4gICAgRGV2b2x2ZSxcbiAgICBSZWxhdGVkQ0Q0LFxuICAgIFJlbGF0ZWRDbGluaWMsXG4gICAgUmVsYXRlZFBoYXJtYWN5LFxuICAgIFJlbGF0ZWRWaXJhbExvYWRcbn0gZnJvbSAnLi4vbW9kZWwvcGhhcm1hY3kubW9kZWwnO1xuXG5jb25zdCBtb21lbnQgPSBtb21lbnRfO1xuXG50eXBlIEVudGl0eVJlc3BvbnNlVHlwZSA9IEh0dHBSZXNwb25zZTxEZXZvbHZlPjtcblxuQEluamVjdGFibGUoe3Byb3ZpZGVkSW46ICdyb290J30pXG5leHBvcnQgY2xhc3MgRGV2b2x2ZVNlcnZpY2Uge1xuICAgIHB1YmxpYyByZXNvdXJjZVVybCA9ICcnO1xuXG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGh0dHA6IEh0dHBDbGllbnQsIEBJbmplY3QoU0VSVkVSX0FQSV9VUkxfQ09ORklHKSBwcml2YXRlIHNlcnZlclVybDogU2VydmVyQXBpVXJsQ29uZmlnKSB7XG4gICAgICAgIHRoaXMucmVzb3VyY2VVcmwgPSBzZXJ2ZXJVcmwuU0VSVkVSX0FQSV9VUkwgKyAnL2FwaS9kZXZvbHZlcyc7XG4gICAgfVxuXG4gICAgY3JlYXRlKGRldm9sdmU6IERldm9sdmUpOiBPYnNlcnZhYmxlPEVudGl0eVJlc3BvbnNlVHlwZT4ge1xuICAgICAgICBjb25zdCBjb3B5ID0gdGhpcy5jb252ZXJ0RGF0ZUZyb21DbGllbnQoZGV2b2x2ZSk7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgICAgICAgIC5wb3N0PERldm9sdmU+KHRoaXMucmVzb3VyY2VVcmwsIGNvcHksIHtvYnNlcnZlOiAncmVzcG9uc2UnfSlcbiAgICAgICAgICAgIC5waXBlKG1hcCgocmVzOiBFbnRpdHlSZXNwb25zZVR5cGUpID0+IHRoaXMuY29udmVydERhdGVGcm9tU2VydmVyKHJlcykpKTtcbiAgICB9XG5cbiAgICB1cGRhdGUoZGV2b2x2ZTogRGV2b2x2ZSk6IE9ic2VydmFibGU8RW50aXR5UmVzcG9uc2VUeXBlPiB7XG4gICAgICAgIGNvbnN0IGNvcHkgPSB0aGlzLmNvbnZlcnREYXRlRnJvbUNsaWVudChkZXZvbHZlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgICAgICAgLnB1dDxEZXZvbHZlPih0aGlzLnJlc291cmNlVXJsLCBjb3B5LCB7b2JzZXJ2ZTogJ3Jlc3BvbnNlJ30pXG4gICAgICAgICAgICAucGlwZShtYXAoKHJlczogRW50aXR5UmVzcG9uc2VUeXBlKSA9PiB0aGlzLmNvbnZlcnREYXRlRnJvbVNlcnZlcihyZXMpKSk7XG4gICAgfVxuXG4gICAgZmluZChpZDogbnVtYmVyKTogT2JzZXJ2YWJsZTxFbnRpdHlSZXNwb25zZVR5cGU+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgICAgICAgLmdldDxEZXZvbHZlPihgJHt0aGlzLnJlc291cmNlVXJsfS8ke2lkfWAsIHtvYnNlcnZlOiAncmVzcG9uc2UnfSlcbiAgICAgICAgICAgIC5waXBlKG1hcCgocmVzOiBFbnRpdHlSZXNwb25zZVR5cGUpID0+IHRoaXMuY29udmVydERhdGVGcm9tU2VydmVyKHJlcykpKTtcbiAgICB9XG5cbiAgICBmaW5kQnlVdWlkKGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPEVudGl0eVJlc3BvbnNlVHlwZT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwXG4gICAgICAgICAgICAuZ2V0PERldm9sdmU+KGAke3RoaXMucmVzb3VyY2VVcmx9L2J5LXV1aWQvJHtpZH1gLCB7b2JzZXJ2ZTogJ3Jlc3BvbnNlJ30pXG4gICAgICAgICAgICAucGlwZShtYXAoKHJlczogRW50aXR5UmVzcG9uc2VUeXBlKSA9PiB0aGlzLmNvbnZlcnREYXRlRnJvbVNlcnZlcihyZXMpKSk7XG4gICAgfVxuXG5cbiAgICBkZWxldGUoaWQ6IG51bWJlcik6IE9ic2VydmFibGU8SHR0cFJlc3BvbnNlPGFueT4+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGU8YW55PihgJHt0aGlzLnJlc291cmNlVXJsfS8ke2lkfWAsIHtvYnNlcnZlOiAncmVzcG9uc2UnfSk7XG4gICAgfVxuXG4gICAgZ2V0RGV2b2x2ZURhdGVzQnlQYXRpZW50KHBhdGllbnRJZDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PE1vbWVudFtdPihgJHt0aGlzLnJlc291cmNlVXJsfS9wYXRpZW50LyR7cGF0aWVudElkfS92aXNpdC1kYXRlc2ApXG4gICAgICAgICAgICAucGlwZShtYXAoKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXMuZm9yRWFjaChkID0+IG1vbWVudChkKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICB9XG5cbiAgICBnZXRTdGF0ZXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PGFueVtdPignL2FwaS9zdGF0ZXMnKVxuICAgIH1cblxuICAgIGdldExnYXNCeVN0YXRlKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PGFueVtdPihgL2FwaS9wcm92aW5jZXMvc3RhdGUvJHtpZH1gKVxuICAgIH1cblxuICAgIGdldENvbW11bml0eVBoYXJtYWNpZXNCeUxnYShpZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxDb21tdW5pdHlQaGFybWFjeVtdPihgJHt0aGlzLnJlc291cmNlVXJsfS9jb21tdW5pdHktcGhhcm1hY2llcy9sZ2EvJHtpZH1gKVxuICAgIH1cblxuICAgIGdldFJlbGF0ZWRQaGFybWFjeShkZXZvbHZlSWQ6IG51bWJlciwgcGF0aWVudElkOiBudW1iZXIsIGRhdGU6IE1vbWVudCkge1xuICAgICAgICBjb25zdCBkID0gZGF0ZS5mb3JtYXQoREFURV9GT1JNQVQpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZWxhdGVkUGhhcm1hY3k+KGAke3RoaXMucmVzb3VyY2VVcmx9LyR7ZGV2b2x2ZUlkfS9wYXRpZW50LyR7cGF0aWVudElkfS9yZWxhdGVkLXBoYXJtYWN5L2F0LyR7ZH1gKVxuICAgICAgICAgICAgLnBpcGUobWFwKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRlVmlzaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzLmRhdGVWaXNpdCA9IG1vbWVudChyZXMuZGF0ZVZpc2l0KS5mb3JtYXQoJ0REIE1NTSwgWVlZWScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICAgICAgfSkpXG4gICAgfVxuXG4gICAgZ2V0UmVsYXRlZENsaW5pYyhkZXZvbHZlSWQ6IG51bWJlciwgcGF0aWVudElkOiBudW1iZXIsIGRhdGU6IE1vbWVudCkge1xuICAgICAgICBjb25zdCBkID0gZGF0ZS5mb3JtYXQoREFURV9GT1JNQVQpO1xuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxSZWxhdGVkQ2xpbmljPihgJHt0aGlzLnJlc291cmNlVXJsfS8ke2Rldm9sdmVJZH0vcGF0aWVudC8ke3BhdGllbnRJZH0vcmVsYXRlZC1jbGluaWMvYXQvJHtkfWApXG4gICAgICAgICAgICAucGlwZShtYXAocmVzID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGVWaXNpdCkge1xuICAgICAgICAgICAgICAgICAgICByZXMuZGF0ZVZpc2l0ID0gbW9tZW50KHJlcy5kYXRlVmlzaXQpLmZvcm1hdCgnREQgTU1NLCBZWVlZJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICB9KSlcbiAgICB9XG5cbiAgICBnZXRSZWxhdGVkVmlyYWxMb2FkKGRldm9sdmVJZDogbnVtYmVyLCBwYXRpZW50SWQ6IG51bWJlciwgZGF0ZTogTW9tZW50KSB7XG4gICAgICAgIGNvbnN0IGQgPSBkYXRlLmZvcm1hdChEQVRFX0ZPUk1BVCk7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlbGF0ZWRWaXJhbExvYWQ+KGAke3RoaXMucmVzb3VyY2VVcmx9LyR7ZGV2b2x2ZUlkfS9wYXRpZW50LyR7cGF0aWVudElkfS9yZWxhdGVkLXZpcmFsLWxvYWQvYXQvJHtkfWApXG4gICAgICAgICAgICAucGlwZShtYXAocmVzID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGVSZXN1bHRSZWNlaXZlZCkge1xuICAgICAgICAgICAgICAgICAgICByZXMuZGF0ZVJlc3VsdFJlY2VpdmVkID0gbW9tZW50KHJlcy5kYXRlUmVzdWx0UmVjZWl2ZWQpLmZvcm1hdCgnREQgTU1NLCBZWVlZJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgICAgICB9KSlcbiAgICB9XG5cbiAgICBnZXRSZWxhdGVkQ0Q0KGRldm9sdmVJZDogbnVtYmVyLCBwYXRpZW50SWQ6IG51bWJlciwgZGF0ZTogTW9tZW50KSB7XG4gICAgICAgIGNvbnN0IGQgPSBkYXRlLmZvcm1hdChEQVRFX0ZPUk1BVCk7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFJlbGF0ZWRDRDQ+KGAke3RoaXMucmVzb3VyY2VVcmx9LyR7ZGV2b2x2ZUlkfS9wYXRpZW50LyR7cGF0aWVudElkfS9yZWxhdGVkLWNkNC9hdC8ke2R9YClcbiAgICAgICAgICAgIC5waXBlKG1hcChyZXMgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0ZVJlc3VsdFJlY2VpdmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5kYXRlUmVzdWx0UmVjZWl2ZWQgPSBtb21lbnQocmVzLmRhdGVSZXN1bHRSZWNlaXZlZCkuZm9ybWF0KCdERCBNTU0sIFlZWVknKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgICAgIH0pKVxuICAgIH1cblxuICAgIGdldFN0YXRlQnlMZ2EoaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYC9hcGkvcHJvdmluY2VzLyR7aWR9L3N0YXRlYClcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgY29udmVydERhdGVGcm9tQ2xpZW50KGRldm9sdmU6IERldm9sdmUpOiBEZXZvbHZlIHtcbiAgICAgICAgY29uc3QgY29weTogRGV2b2x2ZSA9IE9iamVjdC5hc3NpZ24oe30sIGRldm9sdmUsIHtcbiAgICAgICAgICAgIGRhdGVEZXZvbHZlZDogZGV2b2x2ZS5kYXRlRGV2b2x2ZWQgIT0gbnVsbCAmJiBkZXZvbHZlLmRhdGVEZXZvbHZlZC5pc1ZhbGlkKCkgPyBkZXZvbHZlLmRhdGVEZXZvbHZlZC5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbCxcbiAgICAgICAgICAgIGRhdGVOZXh0Q2xpbmljOiBkZXZvbHZlLmRhdGVOZXh0Q2xpbmljICE9IG51bGwgJiYgZGV2b2x2ZS5kYXRlTmV4dENsaW5pYy5pc1ZhbGlkKCkgPyBkZXZvbHZlLmRhdGVOZXh0Q2xpbmljLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsLFxuICAgICAgICAgICAgZGF0ZU5leHRSZWZpbGw6IGRldm9sdmUuZGF0ZU5leHRSZWZpbGwgIT0gbnVsbCAmJiBkZXZvbHZlLmRhdGVOZXh0UmVmaWxsLmlzVmFsaWQoKSA/IGRldm9sdmUuZGF0ZU5leHRSZWZpbGwuZm9ybWF0KERBVEVfRk9STUFUKSA6IG51bGwsXG4gICAgICAgICAgICBkYXRlRGlzY29udGludWVkOiBkZXZvbHZlLmRhdGVEaXNjb250aW51ZWQgIT0gbnVsbCAmJiBkZXZvbHZlLmRhdGVEaXNjb250aW51ZWQuaXNWYWxpZCgpID8gZGV2b2x2ZS5kYXRlRGlzY29udGludWVkLmZvcm1hdChEQVRFX0ZPUk1BVCkgOiBudWxsLFxuICAgICAgICAgICAgZGF0ZVJldHVybmVkVG9GYWNpbGl0eTogZGV2b2x2ZS5kYXRlUmV0dXJuZWRUb0ZhY2lsaXR5ICE9IG51bGwgJiYgZGV2b2x2ZS5kYXRlUmV0dXJuZWRUb0ZhY2lsaXR5LmlzVmFsaWQoKSA/IGRldm9sdmUuZGF0ZVJldHVybmVkVG9GYWNpbGl0eS5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvcHk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNvbnZlcnREYXRlRnJvbVNlcnZlcihyZXM6IEVudGl0eVJlc3BvbnNlVHlwZSk6IEVudGl0eVJlc3BvbnNlVHlwZSB7XG4gICAgICAgIGlmIChyZXMuYm9keSkge1xuICAgICAgICAgICAgcmVzLmJvZHkuZGF0ZVJldHVybmVkVG9GYWNpbGl0eSA9IHJlcy5ib2R5LmRhdGVSZXR1cm5lZFRvRmFjaWxpdHkgIT0gbnVsbCA/IG1vbWVudChyZXMuYm9keS5kYXRlUmV0dXJuZWRUb0ZhY2lsaXR5KSA6IG51bGw7XG4gICAgICAgICAgICByZXMuYm9keS5kYXRlTmV4dFJlZmlsbCA9IHJlcy5ib2R5LmRhdGVOZXh0UmVmaWxsICE9IG51bGwgPyBtb21lbnQocmVzLmJvZHkuZGF0ZU5leHRSZWZpbGwpIDogbnVsbDtcbiAgICAgICAgICAgIHJlcy5ib2R5LmRhdGVOZXh0Q2xpbmljID0gcmVzLmJvZHkuZGF0ZU5leHRDbGluaWMgIT0gbnVsbCA/IG1vbWVudChyZXMuYm9keS5kYXRlTmV4dENsaW5pYykgOiBudWxsO1xuICAgICAgICAgICAgcmVzLmJvZHkuZGF0ZURldm9sdmVkID0gcmVzLmJvZHkuZGF0ZURldm9sdmVkICE9IG51bGwgPyBtb21lbnQocmVzLmJvZHkuZGF0ZURldm9sdmVkKSA6IG51bGw7XG4gICAgICAgICAgICByZXMuYm9keS5kYXRlRGlzY29udGludWVkID0gcmVzLmJvZHkuZGF0ZURpc2NvbnRpbnVlZCAhPSBudWxsID8gbW9tZW50KHJlcy5ib2R5LmRhdGVEaXNjb250aW51ZWQpIDogbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cbn1cbiJdfQ==

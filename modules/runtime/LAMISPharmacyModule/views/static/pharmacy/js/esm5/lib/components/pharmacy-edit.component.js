import * as tslib_1 from "tslib";
import { Component, ViewChild } from '@angular/core';
import { PharmacyService } from '../services/pharmacy.service';
import { NotificationService } from '@alfresco/adf-core';
import { ActivatedRoute } from '@angular/router';
import { MatButton, MatProgressBar } from '@angular/material';
import { ColumnMode } from '@swimlane/ngx-datatable';
import * as moment_ from 'moment';
import { AppLoaderService, DATE_FORMAT, entityCompare } from '@lamis/web-core';
var moment = moment_;
export var IPT_TYPE = {
    'START_INITIATION': 'Start Initiation',
    'START_REFILL': 'Start Refill',
    'FOLLOWUP_INITIATION': 'Followup Initiation',
    'FOLLOWUP_REFILL': 'Followup Refill'
};
var PharmacyEditComponent = /** @class */ (function () {
    function PharmacyEditComponent(pharmacyService, notification, appLoaderService, activatedRoute) {
        this.pharmacyService = pharmacyService;
        this.notification = notification;
        this.appLoaderService = appLoaderService;
        this.activatedRoute = activatedRoute;
        this.entity = {};
        this.regimenTypes = [];
        this.regimens = [];
        this.selectedRegimens = [];
        this.error = false;
        this.tomorrow = moment().add(1, 'days');
        this.today = moment();
        this.ColumnMode = ColumnMode;
        this.editing = {};
        this.rows = [];
        this.drugIds = new Set();
        this.visitDates = [];
        this.drugs = [];
        this.iptSelected = false;
        this.ipt = {};
    }
    PharmacyEditComponent.prototype.createEntity = function () {
        return {};
    };
    PharmacyEditComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.isSaving = false;
        this.activatedRoute.data.subscribe(function (_a) {
            var entity = _a.entity;
            _this.entity = !!entity && entity.body ? entity.body : entity;
            if (_this.entity === undefined) {
                _this.entity = _this.createEntity();
            }
            var patientId = _this.activatedRoute.snapshot.paramMap.get('patientId');
            _this.pharmacyService.getPatient(patientId).subscribe(function (res) {
                _this.entity.patient = res;
                _this.patient = res;
                _this.dateRegistration = res.dateRegistration;
                _this.entity.facility = res.facility;
                _this.minNextAppointment = _this.dateRegistration.clone().add(15, 'days');
                _this.pharmacyService.getVisitDatesByPatient(res.id).subscribe(function (res1) {
                    _this.visitDates = res1;
                });
                _this.pharmacyService.regimenTypes().subscribe(function (res1) {
                    _this.regimenTypes = res1.filter(function (t) {
                        return _this.entity.patient.extra && _this.entity.patient.extra.prep && _this.entity.patient.extra.prep.registered ?
                            t.id === 30 : t.id !== 30;
                    });
                });
                _this.pharmacyService.hasDeadStatus(patientId).subscribe(function (r) { return _this.deadStatus = r.body; });
            });
            if (_this.entity.id) {
                if (_this.entity.extra && _this.entity.extra.ipt) {
                    _this.ipt = Object.assign({}, _this.entity.extra.ipt, {
                        dateCompleted: _this.entity.extra.ipt.dateCompleted != null ? moment(_this.entity.extra.ipt.dateCompleted) : null
                    });
                }
                _this.rows = tslib_1.__spread(_this.entity.lines.map(function (r) {
                    _this.pharmacyService.getDrugsByRegimen(r.regimen_id).subscribe(function (res) {
                        r.description = res.find(function (d) { return d.regimenDrug.id === r.regimen_drug_id; }).drug.name;
                    });
                    r.morning = r.morning || 0;
                    r.afternoon = r.afternoon || 0;
                    r.evening = r.evening || 0;
                    if (r.regimen_type_id === 15) {
                        _this.iptSelected = true;
                    }
                    r.quantity = ((r.morning || 0) + (r.afternoon || 0) + (r.evening || 0)) * r.duration;
                    _this.pharmacyService.getRegimenById(r.regimen_id).subscribe(function (res) {
                        if (!_this.regimens.map(function (rs) { return rs.id; }).includes(r.regimen_id)) {
                            _this.regimens.push(res);
                            _this.selectedRegimens.push(res);
                            _this.regimens = tslib_1.__spread(_this.regimens);
                            _this.selectedRegimens = tslib_1.__spread(_this.selectedRegimens);
                        }
                    });
                    return r;
                }));
                _this.entity.duration = _this.entity.lines.map(function (r) { return r.duration; })
                    .sort(function (r1, r2) { return r1 - r2; })
                    .pop();
                _this.pharmacyService.getDevolvement(_this.entity.patient.id, _this.entity.dateVisit).subscribe(function (res) {
                    _this.devolve = res;
                    _this.updateDmocType();
                });
            }
        });
    };
    PharmacyEditComponent.prototype.dateVisitChanged = function (date) {
        var _this = this;
        this.entity.nextAppointment = this.suggestedNextAppointment();
        this.minNextAppointment = this.entity.nextAppointment.clone().subtract(7, 'days');
        this.maxNextVisit = this.entity.nextAppointment.clone().add(8, 'months');
        this.pharmacyService.getDevolvement(this.entity.patient.id, this.entity.dateVisit).subscribe(function (res) {
            _this.devolve = res;
            _this.updateDmocType();
        });
    };
    PharmacyEditComponent.prototype.suggestedNextAppointment = function () {
        if (this.entity.dateVisit) {
            var nextAppointment = this.entity.dateVisit.clone().add(this.entity.duration - 2 || 13, 'days');
            var weekday = nextAppointment.isoWeekday();
            if (weekday === 6) {
                nextAppointment = nextAppointment.clone().add(2, 'days');
            }
            else if (weekday === 7) {
                nextAppointment = nextAppointment.clone().add(1, 'days');
            }
            return nextAppointment;
        }
        return null;
    };
    PharmacyEditComponent.prototype.updateDmocType = function () {
        var type = 'MMD';
        switch (this.devolve.dmocType) {
            case 'ARC':
                type = 'Adolescent Refill Club';
                break;
            case 'CPARP':
                type = 'CPARP';
                break;
            case 'CARC':
                type = 'CARC';
                break;
            case 'F_CARG':
                type = 'F-CARG';
                break;
            case 'FAST_TRACK':
                type = 'Fast Track';
                break;
            case 'S_CARG':
                type = 'S-CARG';
                break;
            case 'MMS':
                type = 'MMS';
                break;
        }
        this.dmocType = type;
    };
    PharmacyEditComponent.prototype.filterDates = function (date) {
        var exists = false;
        this.visitDates.forEach(function (d) {
            if (date.diff(d, 'days') === 0) {
                exists = true;
            }
        });
        return (this.entity.id && date.diff(this.entity.dateVisit, 'days') === 0) || !exists;
    };
    PharmacyEditComponent.prototype.previousState = function () {
        window.history.back();
    };
    PharmacyEditComponent.prototype.entityCompare = function (e1, e2) {
        return entityCompare(e1, e2);
    };
    PharmacyEditComponent.prototype.save = function () {
        this.submitButton.disabled = true;
        // this.progressBar.mode = 'indeterminate';
        this.appLoaderService.open('Saving visit...');
        this.entity.lines = this.rows;
        this.isSaving = true;
        if (!this.entity.extra) {
            this.entity.extra = {};
        }
        if (this.iptSelected && this.ipt) {
            this.entity.extra.ipt = Object.assign({}, this.ipt, {
                dateCompleted: this.ipt.dateCompleted != null && this.ipt.dateCompleted.isValid() ?
                    this.ipt.dateCompleted.format(DATE_FORMAT) : null
            });
        }
        if (this.deadStatus && this.deadStatus.dateStatus) {
            if (this.deadStatus.dateStatus.isBefore(this.entity.dateVisit)) {
                this.notification.showError("Cannot save refill, patient was declared dead\n                 (" + this.deadStatus.dateStatus.format('DD MMMM, YYYY') + ") before date of current refill");
                this.appLoaderService.close();
                this.isSaving = false;
                return;
            }
        }
        if (this.entity.id !== undefined) {
            this.subscribeToSaveResponse(this.pharmacyService.update(this.entity));
        }
        else {
            this.subscribeToSaveResponse(this.pharmacyService.create(this.entity));
        }
    };
    PharmacyEditComponent.prototype.regimenTypeChange = function (type) {
        var _this = this;
        this.pharmacyService.regimesByRegimenType(type.id).subscribe(function (res) {
            res.forEach(function (regimen) {
                if (!_this.regimens.map(function (r) { return r.id; }).includes(regimen.id)) {
                    _this.regimens.push(regimen);
                    _this.regimens = tslib_1.__spread(_this.regimens);
                }
            });
        });
    };
    PharmacyEditComponent.prototype.durationChanged = function (duration) {
        this.rows = this.rows.map(function (r) {
            r.duration = duration;
            r.quantity = (r.morning + r.afternoon + r.evening) * duration;
            return r;
        });
        this.rows = tslib_1.__spread(this.rows);
        this.entity.nextAppointment = this.suggestedNextAppointment();
        if (duration === 90) {
            this.entity.mmdType = 'MMD-3';
        }
        else if (duration === 120) {
            this.entity.mmdType = 'MMD-4';
        }
        else if (duration === 150) {
            this.entity.mmdType = 'MMD-5';
        }
        else if (duration === 180) {
            this.entity.mmdType = 'MMD-6';
        }
        else {
            this.entity.mmdType = null;
        }
        if (this.entity.dateVisit) {
            this.ipt['dateCompleted'] = this.entity.dateVisit.clone().add(duration, 'days');
        }
    };
    PharmacyEditComponent.prototype.iptTypes = function () {
        return IPT_TYPE;
    };
    PharmacyEditComponent.prototype.regimenChange = function (event) {
        var _this = this;
        this.selectedRegimens.forEach(function (regimen) {
            if (regimen.regimenType.id === 15) {
                _this.iptSelected = true;
            }
            _this.pharmacyService.getDrugsByRegimen(regimen.id).subscribe(function (res) {
                res.forEach(function (drug) {
                    if (!_this.rows.map(function (r) { return r.description; }).includes(drug.drug.name)) {
                        _this.rows.push({
                            drug: drug.drug,
                            description: drug.drug.name,
                            morning: drug.drug.morning,
                            afternoon: drug.drug.afternoon,
                            evening: drug.drug.evening,
                            regimen_id: regimen.id,
                            duration: _this.entity.duration,
                            quantity: _this.entity.duration * ((drug.drug.morning || 0) + (drug.drug.afternoon || 0)
                                + (drug.drug.evening || 0)),
                            regimen_type_id: regimen.regimenType.id,
                            regimen_drug_id: drug.regimenDrug.id
                        });
                        _this.rows = tslib_1.__spread(_this.rows);
                        // this.drugs.push(drug.drug);
                    }
                    _this.rows = _this.rows.filter(function (row) { return _this.selectedRegimens.map(function (regimen1) { return regimen1.id; }).includes(row.regimen_id); });
                    _this.drugs.forEach(function (drug1) {
                        if (!_this.rows.map(function (r) { return r.description; }).includes(drug1.name)) {
                            _this.drugs = _this.drugs.filter(function (d) { return d.id !== drug1.id; });
                        }
                    });
                });
            });
        });
    };
    PharmacyEditComponent.prototype.updateValue = function (event, cell, rowIndex) {
        this.editing[rowIndex + '-' + cell] = false;
        this.rows[rowIndex][cell] = event.target.value;
        if (this.entity.duration) {
            var total = parseInt(this.rows[rowIndex]['morning'] + '' || '0', 10) +
                parseInt(this.rows[rowIndex]['afternoon'] + '' || '0', 10) +
                parseInt(this.rows[rowIndex]['evening'] + '' || '0', 10);
            this.rows[rowIndex]['quantity'] = (total * this.entity.duration);
        }
        if (cell === 'duration' && this.rows[rowIndex].regimen_type_id === 15) {
            if (this.entity.dateVisit) {
                this.ipt['dateCompleted'] = this.entity.dateVisit.clone().add(event.target.value, 'days');
            }
        }
        this.rows = tslib_1.__spread(this.rows);
    };
    PharmacyEditComponent.prototype.subscribeToSaveResponse = function (result) {
        var _this = this;
        result.subscribe(function (res) { return _this.onSaveSuccess(res.body); }, function (res) {
            _this.appLoaderService.close();
            _this.onSaveError();
            _this.onError(res.message);
        });
    };
    PharmacyEditComponent.prototype.onSaveSuccess = function (result) {
        this.appLoaderService.close();
        this.isSaving = false;
        this.notification.showInfo('Pharmacy visit successfully saved');
        this.previousState();
    };
    PharmacyEditComponent.prototype.onSaveError = function () {
        this.isSaving = false;
        this.error = true;
        this.notification.showError('Error saving pharmacy visit');
    };
    PharmacyEditComponent.prototype.onError = function (errorMessage) {
        this.isSaving = false;
        this.notification.showError(errorMessage);
    };
    PharmacyEditComponent.ctorParameters = function () { return [
        { type: PharmacyService },
        { type: NotificationService },
        { type: AppLoaderService },
        { type: ActivatedRoute }
    ]; };
    tslib_1.__decorate([
        ViewChild(MatProgressBar, { static: true }),
        tslib_1.__metadata("design:type", MatProgressBar)
    ], PharmacyEditComponent.prototype, "progressBar", void 0);
    tslib_1.__decorate([
        ViewChild(MatButton, { static: true }),
        tslib_1.__metadata("design:type", MatButton)
    ], PharmacyEditComponent.prototype, "submitButton", void 0);
    PharmacyEditComponent = tslib_1.__decorate([
        Component({
            selector: 'lamis-pharmacy-edit',
            template: "<div class=\"lamis-edit-form\">\n    <div class=\"lamis-edit-form-container\">\n        <form name=\"form\" role=\"form\" novalidate (ngSubmit)=\"save()\" #pharmacyForm=\"ngForm\">\n            <mat-card class=\"default\">\n                <mat-card-header>\n                </mat-card-header>\n                <mat-card-content *ngIf=\"patient\">\n                    <div>\n                        <mat-form-field class=\"full-width\" *ngIf=\"entity && dateRegistration\">\n                            <input matInput [matDatepicker]=\"picker\"\n                                   placeholder=\"Date of Dispensing\"\n                                   [(ngModel)]=\"entity.dateVisit\"\n                                   [matDatepickerFilter]=\"filterDates.bind(this)\"\n                                   (dateChange)=\"dateVisitChanged($event.value)\"\n                                   #visit=\"ngModel\"\n                                   [max]=\"today\"\n                                   [min]=\"dateRegistration\"\n                                   name=\"visit\"\n                                   required>\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.required)\">\n                                Date of dispensing is required\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.min)\">\n                                Date of dispensing cannot be before {{dateRegistration | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.max)\">\n                                Date of dispensing cannot be in the future\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"row\" *ngIf=\"devolve && !devolve.dateReturnedToFacility\">\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\">\n                                <mat-label>Date of Devolvement</mat-label>\n                                <input matInput disabled value=\"{{devolve.dateDevolved | date: 'dd MMM, yyyy'}}\">\n                            </mat-form-field>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\">\n                                <mat-label>DMOC Type</mat-label>\n                                <input matInput disabled [value]=\"dmocType\">\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"entity.duration\"\n                                        placeholder=\"Refill Period (days)\"\n                                        (selectionChange)=\"durationChanged($event.value)\"\n                                        #refill=\"ngModel\" required name=\"refill\">\n                                <mat-option></mat-option>\n                                <mat-option [value]=\"15\">15</mat-option>\n                                <mat-option [value]=\"30\">30</mat-option>\n                                <mat-option [value]=\"60\">60</mat-option>\n                                <mat-option [value]=\"90\">90</mat-option>\n                                <mat-option [value]=\"120\">120</mat-option>\n                                <mat-option [value]=\"150\">150</mat-option>\n                                <mat-option [value]=\"180\">180</mat-option>\n                            </mat-select>\n                            <mat-error\n                                    *ngIf=\"refill.errors && (refill.dirty || refill.touched) && (refill.errors.required)\">\n                                Refill Duration is required\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div *ngIf=\"minNextAppointment\">\n                        <mat-form-field class=\"full-width\">\n                            <input matInput [matDatepicker]=\"picker1\"\n                                   placeholder=\"Date of Next Appointment\"\n                                   [(ngModel)]=\"entity.nextAppointment\"\n                                   #next=\"ngModel\"\n                                   [min]=\"minNextAppointment\"\n                                   [max]=\"maxNextVisit\"\n                                   name=\"next\"\n                                   required>\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker1\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker1></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"next.errors && (next.dirty || next.touched) && (next.errors.required)\">\n                                Date of Next Appointment is required\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"next.errors && (next.dirty || next.touched) && (next.errors.max)\">\n                                Date of Next Appointment must be after {{maxNextVisit | date:'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"next.errors && (next.dirty || next.touched) && (next.errors.min)\">\n                                Date of Next Appointment must be after {{minNextAppointment | date:'dd MMM, yyyy'}}\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\" *ngIf=\"entity.mmdType\">\n                            <mat-label>MMD Type</mat-label>\n                            <input matInput disabled [value]=\"entity.mmdType || ''\">\n                        </mat-form-field>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-checkbox [(ngModel)]=\"entity.prescriptionError\" name=\"error\">Any prescription error?\n                            </mat-checkbox>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-checkbox [(ngModel)]=\"entity.adrScreened\" name=\"screened\">Adverse Drug Reactions\n                            </mat-checkbox>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field *ngIf=\"entity.adrScreened\">\n                                <mat-select multiple [(ngModel)]=\"entity.adrs\"\n                                            name=\"adrs\"\n                                >\n                                    <mat-option></mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-form-field>\n                                <mat-select placeholder=\"Regimen Type\"\n                                            (selectionChange)=\"regimenTypeChange($event.value)\">\n                                    <mat-option></mat-option>\n                                    <mat-option *ngFor=\"let type of regimenTypes\"\n                                                [value]=\"type\">{{type.description}}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field>\n                                <mat-select placeholder=\"Regimen\"\n                                            multiple\n                                            name=\"regimen\"\n                                            [(ngModel)]=\"selectedRegimens\"\n                                            [compareWith]=\"entityCompare\"\n                                            (selectionChange)=\"regimenChange($event.value)\">\n                                    <mat-option *ngFor=\"let regimen of regimens\"\n                                                [value]=\"regimen\">{{regimen.description}}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div>\n                        Drug Dispensed\n                        <mat-divider></mat-divider>\n                        <ngx-datatable\n                            #mydatatable\n                            class=\"material\"\n                            [headerHeight]=\"50\"\n                            [limit]=\"8\"\n                            [columnMode]=\"ColumnMode.force\"\n                            [footerHeight]=\"50\"\n                            rowHeight=\"auto\"\n                            [rows]=\"rows\"\n                        >\n                            <ngx-datatable-column name=\"Description\">\n                                <ng-template ngx-datatable-cell-template let-value=\"value\">\n                                    <mat-form-field>\n                                        <input matInput disabled [value]=\"value\" style=\"font-weight: 900\">\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Morning\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'morning', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Afternoon\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'afternoon', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Evening\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'evening', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Duration\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'duration', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Quantity\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field>\n                                        <input matInput disabled [value]=\"value\" style=\"font-weight: 900\">\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                        </ngx-datatable>\n                    </div>\n                    <mat-divider></mat-divider>\n                </mat-card-content>\n                <ng-container *ngIf=\"iptSelected\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <mat-form-field>\n                                <mat-label>IPT Type</mat-label>\n                                <mat-select required [(ngModel)]=\"ipt.type\" name=\"inh\" #inh=\"ngModel\">\n                                    <mat-option></mat-option>\n                                    <mat-option [value]=\"'START_INITIATION'\">Start Initiation</mat-option>\n                                    <mat-option [value]=\"'START_REFILL'\">Start Refill</mat-option>\n                                    <mat-option [value]=\"'FOLLOWUP_INITIATION'\">Followup Initiation</mat-option>\n                                    <mat-option [value]=\"'FOLLOWUP_REFILL'\">Followup Refill</mat-option>\n                                </mat-select>\n                                <mat-error\n                                        *ngIf=\"inh.errors && (inh.dirty || inh.touched) && (inh.errors.required)\">\n                                    IPT Type is required\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-checkbox [(ngModel)]=\"ipt.completed\"\n                                          name=\"uibn\"\n                            >\n                                IPT completed?\n                            </mat-checkbox>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\" *ngIf=\"entity.dateVisit && ipt.completed\">\n                                <input matInput [matDatepicker]=\"picker2\"\n                                       placeholder=\"Date of Completion\"\n                                       [(ngModel)]=\"ipt.dateCompleted\"\n                                       #com=\"ngModel\"\n                                       [min]=\"entity.dateVisit\"\n                                       name=\"com\"\n                                       required>\n                                <mat-datepicker-toggle\n                                        matSuffix\n                                        [for]=\"picker2\">\n                                </mat-datepicker-toggle>\n                                <mat-datepicker #picker2></mat-datepicker>\n                                <mat-error\n                                        *ngIf=\"com.errors && (com.dirty || com.touched) && (com.errors.required)\">\n                                    Date completed is required\n                                </mat-error>\n                                <mat-error\n                                        *ngIf=\"com.errors && (com.dirty || com.touched) && (com.errors.min)\">\n                                    Date must not be before {{entity.dateVisit | date:'dd MMM, yyyy'}}\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                </ng-container>\n                <mat-card-actions class=\"lamis-edit-form-actions\">\n                    <button mat-raised-button type=\"button\" (click)=\"previousState()\">Back</button>\n                    <button mat-raised-button color='primary'\n                            [disabled]=\"pharmacyForm.invalid || rows.length === 0 || isSaving\"\n                            type=\"submit\">\n                        {{entity.id !== undefined ? 'Update' : 'Save'}}\n                    </button>\n                </mat-card-actions>\n            </mat-card>\n        </form>\n    </div>\n</div>\n"
        }),
        tslib_1.__metadata("design:paramtypes", [PharmacyService,
            NotificationService,
            AppLoaderService,
            ActivatedRoute])
    ], PharmacyEditComponent);
    return PharmacyEditComponent;
}());
export { PharmacyEditComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGhhcm1hY3ktZWRpdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9sYW1pcy1waGFybWFjeS0xLjQuMC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BoYXJtYWN5LWVkaXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFVLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUUzRCxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDN0QsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDdkQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBQyxTQUFTLEVBQUUsY0FBYyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFHNUQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ25ELE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDO0FBRWxDLE9BQU8sRUFBQyxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFFN0UsSUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDO0FBRXZCLE1BQU0sQ0FBQyxJQUFNLFFBQVEsR0FBRztJQUNwQixrQkFBa0IsRUFBRSxrQkFBa0I7SUFDdEMsY0FBYyxFQUFFLGNBQWM7SUFDOUIscUJBQXFCLEVBQUUscUJBQXFCO0lBQzVDLGlCQUFpQixFQUFFLGlCQUFpQjtDQUN2QyxDQUFDO0FBWUY7SUE0QkksK0JBQW9CLGVBQWdDLEVBQzlCLFlBQWlDLEVBQ25DLGdCQUFrQyxFQUNoQyxjQUE4QjtRQUhoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFDOUIsaUJBQVksR0FBWixZQUFZLENBQXFCO1FBQ25DLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDaEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBNUJw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O2dCQW5Ub0MsZUFBZTtnQkFDaEIsbUJBQW1CO2dCQUNqQixnQkFBZ0I7Z0JBQ2hCLGNBQWM7O0lBOUJUO1FBQTFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDLENBQUM7MENBQWMsY0FBYzs4REFBQztJQUNqQztRQUFyQyxTQUFTLENBQUMsU0FBUyxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDOzBDQUFlLFNBQVM7K0RBQUM7SUFGckQscUJBQXFCO1FBSmpDLFNBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxxQkFBcUI7WUFDL0IsNm9vQkFBNkM7U0FDaEQsQ0FBQztpREE2QnVDLGVBQWU7WUFDaEIsbUJBQW1CO1lBQ2pCLGdCQUFnQjtZQUNoQixjQUFjO09BL0IzQyxxQkFBcUIsQ0FnVmpDO0lBQUQsNEJBQUM7Q0FBQSxBQWhWRCxJQWdWQztTQWhWWSxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBZHIsIERldm9sdmUsIERydWcsIERydWdEVE8sIFBhdGllbnQsIFBoYXJtYWN5LCBQaGFybWFjeUxpbmUsIFJlZ2ltZW4sIFJlZ2ltZW5UeXBlLCBTdGF0dXNIaXN0b3J5fSBmcm9tICcuLi9tb2RlbC9waGFybWFjeS5tb2RlbCc7XG5pbXBvcnQge1BoYXJtYWN5U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvcGhhcm1hY3kuc2VydmljZSc7XG5pbXBvcnQge05vdGlmaWNhdGlvblNlcnZpY2V9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge0FjdGl2YXRlZFJvdXRlfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtNYXRCdXR0b24sIE1hdFByb2dyZXNzQmFyfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQge0h0dHBFcnJvclJlc3BvbnNlLCBIdHRwUmVzcG9uc2V9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0NvbHVtbk1vZGV9IGZyb20gJ0Bzd2ltbGFuZS9uZ3gtZGF0YXRhYmxlJztcbmltcG9ydCAqIGFzIG1vbWVudF8gZnJvbSAnbW9tZW50JztcbmltcG9ydCB7TW9tZW50fSBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHtBcHBMb2FkZXJTZXJ2aWNlLCBEQVRFX0ZPUk1BVCwgZW50aXR5Q29tcGFyZX0gZnJvbSAnQGxhbWlzL3dlYi1jb3JlJztcblxuY29uc3QgbW9tZW50ID0gbW9tZW50XztcblxuZXhwb3J0IGNvbnN0IElQVF9UWVBFID0ge1xuICAgICdTVEFSVF9JTklUSUFUSU9OJzogJ1N0YXJ0IEluaXRpYXRpb24nLFxuICAgICdTVEFSVF9SRUZJTEwnOiAnU3RhcnQgUmVmaWxsJyxcbiAgICAnRk9MTE9XVVBfSU5JVElBVElPTic6ICdGb2xsb3d1cCBJbml0aWF0aW9uJyxcbiAgICAnRk9MTE9XVVBfUkVGSUxMJzogJ0ZvbGxvd3VwIFJlZmlsbCdcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgSXB0IHtcbiAgICB0eXBlPzogc3RyaW5nO1xuICAgIGNvbXBsZXRlZD86IGJvb2xlYW47XG4gICAgZGF0ZUNvbXBsZXRlZD86IE1vbWVudDtcbn1cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsYW1pcy1waGFybWFjeS1lZGl0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcGhhcm1hY3ktZWRpdC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUGhhcm1hY3lFZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBAVmlld0NoaWxkKE1hdFByb2dyZXNzQmFyLCB7c3RhdGljOiB0cnVlfSkgcHJvZ3Jlc3NCYXI6IE1hdFByb2dyZXNzQmFyO1xuICAgIEBWaWV3Q2hpbGQoTWF0QnV0dG9uLCB7c3RhdGljOiB0cnVlfSkgc3VibWl0QnV0dG9uOiBNYXRCdXR0b247XG4gICAgZW50aXR5OiBQaGFybWFjeSA9IHt9O1xuICAgIHBhdGllbnQ6IFBhdGllbnQ7XG4gICAgZGF0ZVJlZ2lzdHJhdGlvbjogTW9tZW50O1xuICAgIG1heE5leHRWaXNpdDogTW9tZW50O1xuICAgIHJlZ2ltZW5UeXBlczogUmVnaW1lblR5cGVbXSA9IFtdO1xuICAgIHJlZ2ltZW5zOiBSZWdpbWVuW10gPSBbXTtcbiAgICBzZWxlY3RlZFJlZ2ltZW5zOiBSZWdpbWVuW10gPSBbXTtcbiAgICBhZHJzOiBBZHJbXTtcbiAgICBpc1NhdmluZzogYm9vbGVhbjtcbiAgICBlcnJvciA9IGZhbHNlO1xuICAgIHRvbW9ycm93ID0gbW9tZW50KCkuYWRkKDEsICdkYXlzJyk7XG4gICAgdG9kYXkgPSBtb21lbnQoKTtcbiAgICBtaW5OZXh0QXBwb2ludG1lbnQ6IE1vbWVudDtcbiAgICBDb2x1bW5Nb2RlID0gQ29sdW1uTW9kZTtcbiAgICBlZGl0aW5nID0ge307XG4gICAgcm93czogUGhhcm1hY3lMaW5lW10gPSBbXTtcbiAgICBkcnVnSWRzID0gbmV3IFNldCgpO1xuICAgIHZpc2l0RGF0ZXM6IE1vbWVudFtdID0gW107XG4gICAgZGV2b2x2ZTogRGV2b2x2ZTtcbiAgICBkbW9jVHlwZTogc3RyaW5nO1xuICAgIGRydWdzOiBEcnVnW10gPSBbXTtcbiAgICBpcHRTZWxlY3RlZCA9IGZhbHNlO1xuICAgIGlwdDogSXB0ID0ge307XG4gICAgZGVhZFN0YXR1czogU3RhdHVzSGlzdG9yeTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcGhhcm1hY3lTZXJ2aWNlOiBQaGFybWFjeVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcExvYWRlclNlcnZpY2U6IEFwcExvYWRlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge1xuICAgIH1cblxuICAgIGNyZWF0ZUVudGl0eSgpOiBQaGFybWFjeSB7XG4gICAgICAgIHJldHVybiA8UGhhcm1hY3k+e307XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5kYXRhLnN1YnNjcmliZSgoe2VudGl0eX0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5ID0gISFlbnRpdHkgJiYgZW50aXR5LmJvZHkgPyBlbnRpdHkuYm9keSA6IGVudGl0eTtcbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkgPSB0aGlzLmNyZWF0ZUVudGl0eSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcGF0aWVudElkID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5wYXJhbU1hcC5nZXQoJ3BhdGllbnRJZCcpO1xuICAgICAgICAgICAgdGhpcy5waGFybWFjeVNlcnZpY2UuZ2V0UGF0aWVudChwYXRpZW50SWQpLnN1YnNjcmliZSgocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkucGF0aWVudCA9IHJlcztcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGllbnQgPSByZXM7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRlUmVnaXN0cmF0aW9uID0gcmVzLmRhdGVSZWdpc3RyYXRpb247XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkuZmFjaWxpdHkgPSByZXMuZmFjaWxpdHk7XG4gICAgICAgICAgICAgICAgdGhpcy5taW5OZXh0QXBwb2ludG1lbnQgPSB0aGlzLmRhdGVSZWdpc3RyYXRpb24uY2xvbmUoKS5hZGQoMTUsICdkYXlzJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFybWFjeVNlcnZpY2UuZ2V0VmlzaXREYXRlc0J5UGF0aWVudChyZXMuaWQpLnN1YnNjcmliZSgocmVzMSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2l0RGF0ZXMgPSByZXMxO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5waGFybWFjeVNlcnZpY2UucmVnaW1lblR5cGVzKCkuc3Vic2NyaWJlKHJlczEgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5UeXBlcyA9IHJlczEuZmlsdGVyKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5LnBhdGllbnQuZXh0cmEgJiYgdGhpcy5lbnRpdHkucGF0aWVudC5leHRyYS5wcmVwICYmIHRoaXMuZW50aXR5LnBhdGllbnQuZXh0cmEucHJlcC5yZWdpc3RlcmVkID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmlkID09PSAzMCA6IHQuaWQgIT09IDMwO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLmhhc0RlYWRTdGF0dXMocGF0aWVudElkKS5zdWJzY3JpYmUociA9PiB0aGlzLmRlYWRTdGF0dXMgPSByLmJvZHkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5pZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5leHRyYSAmJiB0aGlzLmVudGl0eS5leHRyYS5pcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pcHQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmVudGl0eS5leHRyYS5pcHQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVDb21wbGV0ZWQ6IHRoaXMuZW50aXR5LmV4dHJhLmlwdC5kYXRlQ29tcGxldGVkICE9IG51bGwgPyBtb21lbnQodGhpcy5lbnRpdHkuZXh0cmEuaXB0LmRhdGVDb21wbGV0ZWQpIDogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnJvd3MgPSBbLi4udGhpcy5lbnRpdHkubGluZXMubWFwKHIgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXJtYWN5U2VydmljZS5nZXREcnVnc0J5UmVnaW1lbihyLnJlZ2ltZW5faWQpLnN1YnNjcmliZSgocmVzOiBEcnVnRFRPW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIuZGVzY3JpcHRpb24gPSByZXMuZmluZChkID0+IGQucmVnaW1lbkRydWcuaWQgPT09IHIucmVnaW1lbl9kcnVnX2lkKS5kcnVnLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByLm1vcm5pbmcgPSByLm1vcm5pbmcgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgci5hZnRlcm5vb24gPSByLmFmdGVybm9vbiB8fCAwO1xuICAgICAgICAgICAgICAgICAgICByLmV2ZW5pbmcgPSByLmV2ZW5pbmcgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHIucmVnaW1lbl90eXBlX2lkID09PSAxNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pcHRTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgci5xdWFudGl0eSA9ICgoci5tb3JuaW5nIHx8IDApICsgKHIuYWZ0ZXJub29uIHx8IDApICsgKHIuZXZlbmluZyB8fCAwKSkgKiByLmR1cmF0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLmdldFJlZ2ltZW5CeUlkKHIucmVnaW1lbl9pZCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVnaW1lbnMubWFwKHJzID0+IHJzLmlkKS5pbmNsdWRlcyhyLnJlZ2ltZW5faWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpbWVucy5wdXNoKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFJlZ2ltZW5zLnB1c2gocmVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5zID0gWy4uLnRoaXMucmVnaW1lbnNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSZWdpbWVucyA9IFsuLi50aGlzLnNlbGVjdGVkUmVnaW1lbnNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgICAgICAgICAgfSldO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkuZHVyYXRpb24gPSB0aGlzLmVudGl0eS5saW5lcy5tYXAociA9PiByLmR1cmF0aW9uKVxuICAgICAgICAgICAgICAgICAgICAuc29ydCgocjEsIHIyKSA9PiByMSAtIHIyKVxuICAgICAgICAgICAgICAgICAgICAucG9wKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnBoYXJtYWN5U2VydmljZS5nZXREZXZvbHZlbWVudCh0aGlzLmVudGl0eS5wYXRpZW50LmlkLCB0aGlzLmVudGl0eS5kYXRlVmlzaXQpLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRldm9sdmUgPSByZXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRG1vY1R5cGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZGF0ZVZpc2l0Q2hhbmdlZChkYXRlOiBNb21lbnQpIHtcbiAgICAgICAgdGhpcy5lbnRpdHkubmV4dEFwcG9pbnRtZW50ID0gdGhpcy5zdWdnZXN0ZWROZXh0QXBwb2ludG1lbnQoKTtcbiAgICAgICAgdGhpcy5taW5OZXh0QXBwb2ludG1lbnQgPSB0aGlzLmVudGl0eS5uZXh0QXBwb2ludG1lbnQuY2xvbmUoKS5zdWJ0cmFjdCg3LCAnZGF5cycpO1xuICAgICAgICB0aGlzLm1heE5leHRWaXNpdCA9IHRoaXMuZW50aXR5Lm5leHRBcHBvaW50bWVudC5jbG9uZSgpLmFkZCg4LCAnbW9udGhzJyk7XG4gICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLmdldERldm9sdmVtZW50KHRoaXMuZW50aXR5LnBhdGllbnQuaWQsIHRoaXMuZW50aXR5LmRhdGVWaXNpdCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgICAgICB0aGlzLmRldm9sdmUgPSByZXM7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZURtb2NUeXBlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgc3VnZ2VzdGVkTmV4dEFwcG9pbnRtZW50KCk6IE1vbWVudCB7XG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5kYXRlVmlzaXQpIHtcbiAgICAgICAgICAgIGxldCBuZXh0QXBwb2ludG1lbnQgPSB0aGlzLmVudGl0eS5kYXRlVmlzaXQuY2xvbmUoKS5hZGQodGhpcy5lbnRpdHkuZHVyYXRpb24gLSAyIHx8IDEzLCAnZGF5cycpO1xuICAgICAgICAgICAgY29uc3Qgd2Vla2RheSA9IG5leHRBcHBvaW50bWVudC5pc29XZWVrZGF5KCk7XG4gICAgICAgICAgICBpZiAod2Vla2RheSA9PT0gNikge1xuICAgICAgICAgICAgICAgIG5leHRBcHBvaW50bWVudCA9IG5leHRBcHBvaW50bWVudC5jbG9uZSgpLmFkZCgyLCAnZGF5cycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh3ZWVrZGF5ID09PSA3KSB7XG4gICAgICAgICAgICAgICAgbmV4dEFwcG9pbnRtZW50ID0gbmV4dEFwcG9pbnRtZW50LmNsb25lKCkuYWRkKDEsICdkYXlzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV4dEFwcG9pbnRtZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHVwZGF0ZURtb2NUeXBlKCkge1xuICAgICAgICBsZXQgdHlwZSA9ICdNTUQnO1xuICAgICAgICBzd2l0Y2ggKHRoaXMuZGV2b2x2ZS5kbW9jVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnQVJDJzpcbiAgICAgICAgICAgICAgICB0eXBlID0gJ0Fkb2xlc2NlbnQgUmVmaWxsIENsdWInO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQ1BBUlAnOlxuICAgICAgICAgICAgICAgIHR5cGUgPSAnQ1BBUlAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQ0FSQyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdDQVJDJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ0ZfQ0FSRyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdGLUNBUkcnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnRkFTVF9UUkFDSyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdGYXN0IFRyYWNrJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1NfQ0FSRyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdTLUNBUkcnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnTU1TJzpcbiAgICAgICAgICAgICAgICB0eXBlID0gJ01NUyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kbW9jVHlwZSA9IHR5cGU7XG4gICAgfVxuXG4gICAgZmlsdGVyRGF0ZXMoZGF0ZTogTW9tZW50KTogYm9vbGVhbiB7XG4gICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnZpc2l0RGF0ZXMuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICAgIGlmIChkYXRlLmRpZmYoZCwgJ2RheXMnKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKHRoaXMuZW50aXR5LmlkICYmIGRhdGUuZGlmZih0aGlzLmVudGl0eS5kYXRlVmlzaXQsICdkYXlzJykgPT09IDApIHx8ICFleGlzdHM7XG4gICAgfVxuXG5cbiAgICBwcmV2aW91c1N0YXRlKCkge1xuICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgfVxuXG4gICAgZW50aXR5Q29tcGFyZShlMSwgZTIpIHtcbiAgICAgICAgcmV0dXJuIGVudGl0eUNvbXBhcmUoZTEsIGUyKTtcbiAgICB9XG5cbiAgICBzYXZlKCkge1xuICAgICAgICB0aGlzLnN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMucHJvZ3Jlc3NCYXIubW9kZSA9ICdpbmRldGVybWluYXRlJztcbiAgICAgICAgdGhpcy5hcHBMb2FkZXJTZXJ2aWNlLm9wZW4oJ1NhdmluZyB2aXNpdC4uLicpO1xuICAgICAgICB0aGlzLmVudGl0eS5saW5lcyA9IHRoaXMucm93cztcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IHRydWU7XG4gICAgICAgIGlmICghdGhpcy5lbnRpdHkuZXh0cmEpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXB0U2VsZWN0ZWQgJiYgdGhpcy5pcHQpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLmlwdCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaXB0LCB7XG4gICAgICAgICAgICAgICAgZGF0ZUNvbXBsZXRlZDogdGhpcy5pcHQuZGF0ZUNvbXBsZXRlZCAhPSBudWxsICYmIHRoaXMuaXB0LmRhdGVDb21wbGV0ZWQuaXNWYWxpZCgpID9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pcHQuZGF0ZUNvbXBsZXRlZC5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kZWFkU3RhdHVzICYmIHRoaXMuZGVhZFN0YXR1cy5kYXRlU3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kZWFkU3RhdHVzLmRhdGVTdGF0dXMuaXNCZWZvcmUodGhpcy5lbnRpdHkuZGF0ZVZpc2l0KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9uLnNob3dFcnJvcihgQ2Fubm90IHNhdmUgcmVmaWxsLCBwYXRpZW50IHdhcyBkZWNsYXJlZCBkZWFkXG4gICAgICAgICAgICAgICAgICgke3RoaXMuZGVhZFN0YXR1cy5kYXRlU3RhdHVzLmZvcm1hdCgnREQgTU1NTSwgWVlZWScpfSkgYmVmb3JlIGRhdGUgb2YgY3VycmVudCByZWZpbGxgKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZW50aXR5LmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9TYXZlUmVzcG9uc2UodGhpcy5waGFybWFjeVNlcnZpY2UudXBkYXRlKHRoaXMuZW50aXR5KSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZVRvU2F2ZVJlc3BvbnNlKHRoaXMucGhhcm1hY3lTZXJ2aWNlLmNyZWF0ZSh0aGlzLmVudGl0eSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVnaW1lblR5cGVDaGFuZ2UodHlwZTogYW55KSB7XG4gICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLnJlZ2ltZXNCeVJlZ2ltZW5UeXBlKHR5cGUuaWQpLnN1YnNjcmliZSgocmVzOiBSZWdpbWVuW10pID0+IHtcbiAgICAgICAgICAgIHJlcy5mb3JFYWNoKChyZWdpbWVuOiBSZWdpbWVuKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlZ2ltZW5zLm1hcChyID0+IHIuaWQpLmluY2x1ZGVzKHJlZ2ltZW4uaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW1lbnMucHVzaChyZWdpbWVuKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpbWVucyA9IFsuLi50aGlzLnJlZ2ltZW5zXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZHVyYXRpb25DaGFuZ2VkKGR1cmF0aW9uKSB7XG4gICAgICAgIHRoaXMucm93cyA9IHRoaXMucm93cy5tYXAociA9PiB7XG4gICAgICAgICAgICByLmR1cmF0aW9uID0gZHVyYXRpb247XG4gICAgICAgICAgICByLnF1YW50aXR5ID0gKHIubW9ybmluZyArIHIuYWZ0ZXJub29uICsgci5ldmVuaW5nKSAqIGR1cmF0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJvd3MgPSBbLi4udGhpcy5yb3dzXTtcblxuICAgICAgICB0aGlzLmVudGl0eS5uZXh0QXBwb2ludG1lbnQgPSB0aGlzLnN1Z2dlc3RlZE5leHRBcHBvaW50bWVudCgpO1xuXG4gICAgICAgIGlmIChkdXJhdGlvbiA9PT0gOTApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTMnO1xuICAgICAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09PSAxMjApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTQnO1xuICAgICAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09PSAxNTApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTUnO1xuICAgICAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09PSAxODApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTYnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkubW1kVHlwZSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5lbnRpdHkuZGF0ZVZpc2l0KSB7XG4gICAgICAgICAgICB0aGlzLmlwdFsnZGF0ZUNvbXBsZXRlZCddID0gdGhpcy5lbnRpdHkuZGF0ZVZpc2l0LmNsb25lKCkuYWRkKGR1cmF0aW9uLCAnZGF5cycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXB0VHlwZXMoKSB7XG4gICAgICAgIHJldHVybiBJUFRfVFlQRTtcbiAgICB9XG5cbiAgICByZWdpbWVuQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRSZWdpbWVucy5mb3JFYWNoKHJlZ2ltZW4gPT4ge1xuICAgICAgICAgICAgaWYgKHJlZ2ltZW4ucmVnaW1lblR5cGUuaWQgPT09IDE1KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pcHRTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnBoYXJtYWN5U2VydmljZS5nZXREcnVnc0J5UmVnaW1lbihyZWdpbWVuLmlkKS5zdWJzY3JpYmUoKHJlczogRHJ1Z0RUT1tdKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKGRydWc6IERydWdEVE8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvd3MubWFwKHIgPT4gci5kZXNjcmlwdGlvbikuaW5jbHVkZXMoZHJ1Zy5kcnVnLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJ1ZzogZHJ1Zy5kcnVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkcnVnLmRydWcubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3JuaW5nOiBkcnVnLmRydWcubW9ybmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlcm5vb246IGRydWcuZHJ1Zy5hZnRlcm5vb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbmluZzogZHJ1Zy5kcnVnLmV2ZW5pbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW1lbl9pZDogcmVnaW1lbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5lbnRpdHkuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IHRoaXMuZW50aXR5LmR1cmF0aW9uICogKChkcnVnLmRydWcubW9ybmluZyB8fCAwKSArIChkcnVnLmRydWcuYWZ0ZXJub29uIHx8IDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgKGRydWcuZHJ1Zy5ldmVuaW5nIHx8IDApKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpbWVuX3R5cGVfaWQ6IHJlZ2ltZW4ucmVnaW1lblR5cGUuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW1lbl9kcnVnX2lkOiBkcnVnLnJlZ2ltZW5EcnVnLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm93cyA9IFsuLi50aGlzLnJvd3NdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5kcnVncy5wdXNoKGRydWcuZHJ1Zyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd3MgPSB0aGlzLnJvd3MuZmlsdGVyKHJvdyA9PiB0aGlzLnNlbGVjdGVkUmVnaW1lbnMubWFwKHJlZ2ltZW4xID0+IHJlZ2ltZW4xLmlkKS5pbmNsdWRlcyhyb3cucmVnaW1lbl9pZCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRydWdzLmZvckVhY2goZHJ1ZzEgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvd3MubWFwKHIgPT4gci5kZXNjcmlwdGlvbikuaW5jbHVkZXMoZHJ1ZzEubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRydWdzID0gdGhpcy5kcnVncy5maWx0ZXIoZCA9PiBkLmlkICE9PSBkcnVnMS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZVZhbHVlKGV2ZW50LCBjZWxsLCByb3dJbmRleCkge1xuICAgICAgICB0aGlzLmVkaXRpbmdbcm93SW5kZXggKyAnLScgKyBjZWxsXSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJvd3Nbcm93SW5kZXhdW2NlbGxdID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICBpZiAodGhpcy5lbnRpdHkuZHVyYXRpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQodGhpcy5yb3dzW3Jvd0luZGV4XVsnbW9ybmluZyddICsgJycgfHwgJzAnLCAxMCkgK1xuICAgICAgICAgICAgICAgIHBhcnNlSW50KHRoaXMucm93c1tyb3dJbmRleF1bJ2FmdGVybm9vbiddICsgJycgfHwgJzAnLCAxMCkgK1xuICAgICAgICAgICAgICAgIHBhcnNlSW50KHRoaXMucm93c1tyb3dJbmRleF1bJ2V2ZW5pbmcnXSArICcnIHx8ICcwJywgMTApO1xuICAgICAgICAgICAgdGhpcy5yb3dzW3Jvd0luZGV4XVsncXVhbnRpdHknXSA9ICh0b3RhbCAqIHRoaXMuZW50aXR5LmR1cmF0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VsbCA9PT0gJ2R1cmF0aW9uJyAmJiB0aGlzLnJvd3Nbcm93SW5kZXhdLnJlZ2ltZW5fdHlwZV9pZCA9PT0gMTUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5kYXRlVmlzaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlwdFsnZGF0ZUNvbXBsZXRlZCddID0gdGhpcy5lbnRpdHkuZGF0ZVZpc2l0LmNsb25lKCkuYWRkKGV2ZW50LnRhcmdldC52YWx1ZSwgJ2RheXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJvd3MgPSBbLi4udGhpcy5yb3dzXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN1YnNjcmliZVRvU2F2ZVJlc3BvbnNlKHJlc3VsdDogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8YW55Pj4pIHtcbiAgICAgICAgcmVzdWx0LnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB0aGlzLm9uU2F2ZVN1Y2Nlc3MocmVzLmJvZHkpLFxuICAgICAgICAgICAgKHJlczogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2F2ZUVycm9yKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHJlcy5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TYXZlU3VjY2VzcyhyZXN1bHQ6IGFueSkge1xuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbi5zaG93SW5mbygnUGhhcm1hY3kgdmlzaXQgc3VjY2Vzc2Z1bGx5IHNhdmVkJyk7XG4gICAgICAgIHRoaXMucHJldmlvdXNTdGF0ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TYXZlRXJyb3IoKSB7XG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uLnNob3dFcnJvcignRXJyb3Igc2F2aW5nIHBoYXJtYWN5IHZpc2l0Jyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uRXJyb3IoZXJyb3JNZXNzYWdlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbi5zaG93RXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICB9XG59XG4iXX0=
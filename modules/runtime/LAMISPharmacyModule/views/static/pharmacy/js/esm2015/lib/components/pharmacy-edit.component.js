import * as tslib_1 from "tslib";
import { Component, ViewChild } from '@angular/core';
import { PharmacyService } from '../services/pharmacy.service';
import { NotificationService } from '@alfresco/adf-core';
import { ActivatedRoute } from '@angular/router';
import { MatButton, MatProgressBar } from '@angular/material';
import { ColumnMode } from '@swimlane/ngx-datatable';
import * as moment_ from 'moment';
import { AppLoaderService, DATE_FORMAT, entityCompare } from '@lamis/web-core';
const moment = moment_;
export const IPT_TYPE = {
    'START_INITIATION': 'Start Initiation',
    'START_REFILL': 'Start Refill',
    'FOLLOWUP_INITIATION': 'Followup Initiation',
    'FOLLOWUP_REFILL': 'Followup Refill'
};
let PharmacyEditComponent = class PharmacyEditComponent {
    constructor(pharmacyService, notification, appLoaderService, activatedRoute) {
        this.pharmacyService = pharmacyService;
        this.notification = notification;
        this.appLoaderService = appLoaderService;
        this.activatedRoute = activatedRoute;
        this.entity = {};
        this.regimenTypes = [];
        this.regimens = [];
        this.selectedRegimens = [];
        this.error = false;
        this.tomorrow = moment().add(1, 'days');
        this.today = moment();
        this.ColumnMode = ColumnMode;
        this.editing = {};
        this.rows = [];
        this.drugIds = new Set();
        this.visitDates = [];
        this.drugs = [];
        this.iptSelected = false;
        this.ipt = {};
    }
    createEntity() {
        return {};
    }
    ngOnInit() {
        this.isSaving = false;
        this.activatedRoute.data.subscribe(({ entity }) => {
            this.entity = !!entity && entity.body ? entity.body : entity;
            if (this.entity === undefined) {
                this.entity = this.createEntity();
            }
            const patientId = this.activatedRoute.snapshot.paramMap.get('patientId');
            this.pharmacyService.getPatient(patientId).subscribe((res) => {
                this.entity.patient = res;
                this.patient = res;
                this.dateRegistration = res.dateRegistration;
                this.entity.facility = res.facility;
                this.minNextAppointment = this.dateRegistration.clone().add(15, 'days');
                this.pharmacyService.getVisitDatesByPatient(res.id).subscribe((res1) => {
                    this.visitDates = res1;
                });
                this.pharmacyService.regimenTypes().subscribe(res1 => {
                    this.regimenTypes = res1.filter(t => {
                        return this.entity.patient.extra && this.entity.patient.extra.prep && this.entity.patient.extra.prep.registered ?
                            t.id === 30 : t.id !== 30;
                    });
                });
                this.pharmacyService.hasDeadStatus(patientId).subscribe(r => this.deadStatus = r.body);
            });
            if (this.entity.id) {
                if (this.entity.extra && this.entity.extra.ipt) {
                    this.ipt = Object.assign({}, this.entity.extra.ipt, {
                        dateCompleted: this.entity.extra.ipt.dateCompleted != null ? moment(this.entity.extra.ipt.dateCompleted) : null
                    });
                }
                this.rows = [...this.entity.lines.map(r => {
                        this.pharmacyService.getDrugsByRegimen(r.regimen_id).subscribe((res) => {
                            r.description = res.find(d => d.regimenDrug.id === r.regimen_drug_id).drug.name;
                        });
                        r.morning = r.morning || 0;
                        r.afternoon = r.afternoon || 0;
                        r.evening = r.evening || 0;
                        if (r.regimen_type_id === 15) {
                            this.iptSelected = true;
                        }
                        r.quantity = ((r.morning || 0) + (r.afternoon || 0) + (r.evening || 0)) * r.duration;
                        this.pharmacyService.getRegimenById(r.regimen_id).subscribe(res => {
                            if (!this.regimens.map(rs => rs.id).includes(r.regimen_id)) {
                                this.regimens.push(res);
                                this.selectedRegimens.push(res);
                                this.regimens = [...this.regimens];
                                this.selectedRegimens = [...this.selectedRegimens];
                            }
                        });
                        return r;
                    })];
                this.entity.duration = this.entity.lines.map(r => r.duration)
                    .sort((r1, r2) => r1 - r2)
                    .pop();
                this.pharmacyService.getDevolvement(this.entity.patient.id, this.entity.dateVisit).subscribe(res => {
                    this.devolve = res;
                    this.updateDmocType();
                });
            }
        });
    }
    dateVisitChanged(date) {
        this.entity.nextAppointment = this.suggestedNextAppointment();
        this.minNextAppointment = this.entity.nextAppointment.clone().subtract(7, 'days');
        this.maxNextVisit = this.entity.nextAppointment.clone().add(8, 'months');
        this.pharmacyService.getDevolvement(this.entity.patient.id, this.entity.dateVisit).subscribe(res => {
            this.devolve = res;
            this.updateDmocType();
        });
    }
    suggestedNextAppointment() {
        if (this.entity.dateVisit) {
            let nextAppointment = this.entity.dateVisit.clone().add(this.entity.duration - 2 || 13, 'days');
            const weekday = nextAppointment.isoWeekday();
            if (weekday === 6) {
                nextAppointment = nextAppointment.clone().add(2, 'days');
            }
            else if (weekday === 7) {
                nextAppointment = nextAppointment.clone().add(1, 'days');
            }
            return nextAppointment;
        }
        return null;
    }
    updateDmocType() {
        let type = 'MMD';
        switch (this.devolve.dmocType) {
            case 'ARC':
                type = 'Adolescent Refill Club';
                break;
            case 'CPARP':
                type = 'CPARP';
                break;
            case 'CARC':
                type = 'CARC';
                break;
            case 'F_CARG':
                type = 'F-CARG';
                break;
            case 'FAST_TRACK':
                type = 'Fast Track';
                break;
            case 'S_CARG':
                type = 'S-CARG';
                break;
            case 'MMS':
                type = 'MMS';
                break;
        }
        this.dmocType = type;
    }
    filterDates(date) {
        let exists = false;
        this.visitDates.forEach(d => {
            if (date.diff(d, 'days') === 0) {
                exists = true;
            }
        });
        return (this.entity.id && date.diff(this.entity.dateVisit, 'days') === 0) || !exists;
    }
    previousState() {
        window.history.back();
    }
    entityCompare(e1, e2) {
        return entityCompare(e1, e2);
    }
    save() {
        this.submitButton.disabled = true;
        // this.progressBar.mode = 'indeterminate';
        this.appLoaderService.open('Saving visit...');
        this.entity.lines = this.rows;
        this.isSaving = true;
        if (!this.entity.extra) {
            this.entity.extra = {};
        }
        if (this.iptSelected && this.ipt) {
            this.entity.extra.ipt = Object.assign({}, this.ipt, {
                dateCompleted: this.ipt.dateCompleted != null && this.ipt.dateCompleted.isValid() ?
                    this.ipt.dateCompleted.format(DATE_FORMAT) : null
            });
        }
        if (this.deadStatus && this.deadStatus.dateStatus) {
            if (this.deadStatus.dateStatus.isBefore(this.entity.dateVisit)) {
                this.notification.showError(`Cannot save refill, patient was declared dead
                 (${this.deadStatus.dateStatus.format('DD MMMM, YYYY')}) before date of current refill`);
                this.appLoaderService.close();
                this.isSaving = false;
                return;
            }
        }
        if (this.entity.id !== undefined) {
            this.subscribeToSaveResponse(this.pharmacyService.update(this.entity));
        }
        else {
            this.subscribeToSaveResponse(this.pharmacyService.create(this.entity));
        }
    }
    regimenTypeChange(type) {
        this.pharmacyService.regimesByRegimenType(type.id).subscribe((res) => {
            res.forEach((regimen) => {
                if (!this.regimens.map(r => r.id).includes(regimen.id)) {
                    this.regimens.push(regimen);
                    this.regimens = [...this.regimens];
                }
            });
        });
    }
    durationChanged(duration) {
        this.rows = this.rows.map(r => {
            r.duration = duration;
            r.quantity = (r.morning + r.afternoon + r.evening) * duration;
            return r;
        });
        this.rows = [...this.rows];
        this.entity.nextAppointment = this.suggestedNextAppointment();
        if (duration === 90) {
            this.entity.mmdType = 'MMD-3';
        }
        else if (duration === 120) {
            this.entity.mmdType = 'MMD-4';
        }
        else if (duration === 150) {
            this.entity.mmdType = 'MMD-5';
        }
        else if (duration === 180) {
            this.entity.mmdType = 'MMD-6';
        }
        else {
            this.entity.mmdType = null;
        }
        if (this.entity.dateVisit) {
            this.ipt['dateCompleted'] = this.entity.dateVisit.clone().add(duration, 'days');
        }
    }
    iptTypes() {
        return IPT_TYPE;
    }
    regimenChange(event) {
        this.selectedRegimens.forEach(regimen => {
            if (regimen.regimenType.id === 15) {
                this.iptSelected = true;
            }
            this.pharmacyService.getDrugsByRegimen(regimen.id).subscribe((res) => {
                res.forEach((drug) => {
                    if (!this.rows.map(r => r.description).includes(drug.drug.name)) {
                        this.rows.push({
                            drug: drug.drug,
                            description: drug.drug.name,
                            morning: drug.drug.morning,
                            afternoon: drug.drug.afternoon,
                            evening: drug.drug.evening,
                            regimen_id: regimen.id,
                            duration: this.entity.duration,
                            quantity: this.entity.duration * ((drug.drug.morning || 0) + (drug.drug.afternoon || 0)
                                + (drug.drug.evening || 0)),
                            regimen_type_id: regimen.regimenType.id,
                            regimen_drug_id: drug.regimenDrug.id
                        });
                        this.rows = [...this.rows];
                        // this.drugs.push(drug.drug);
                    }
                    this.rows = this.rows.filter(row => this.selectedRegimens.map(regimen1 => regimen1.id).includes(row.regimen_id));
                    this.drugs.forEach(drug1 => {
                        if (!this.rows.map(r => r.description).includes(drug1.name)) {
                            this.drugs = this.drugs.filter(d => d.id !== drug1.id);
                        }
                    });
                });
            });
        });
    }
    updateValue(event, cell, rowIndex) {
        this.editing[rowIndex + '-' + cell] = false;
        this.rows[rowIndex][cell] = event.target.value;
        if (this.entity.duration) {
            const total = parseInt(this.rows[rowIndex]['morning'] + '' || '0', 10) +
                parseInt(this.rows[rowIndex]['afternoon'] + '' || '0', 10) +
                parseInt(this.rows[rowIndex]['evening'] + '' || '0', 10);
            this.rows[rowIndex]['quantity'] = (total * this.entity.duration);
        }
        if (cell === 'duration' && this.rows[rowIndex].regimen_type_id === 15) {
            if (this.entity.dateVisit) {
                this.ipt['dateCompleted'] = this.entity.dateVisit.clone().add(event.target.value, 'days');
            }
        }
        this.rows = [...this.rows];
    }
    subscribeToSaveResponse(result) {
        result.subscribe((res) => this.onSaveSuccess(res.body), (res) => {
            this.appLoaderService.close();
            this.onSaveError();
            this.onError(res.message);
        });
    }
    onSaveSuccess(result) {
        this.appLoaderService.close();
        this.isSaving = false;
        this.notification.showInfo('Pharmacy visit successfully saved');
        this.previousState();
    }
    onSaveError() {
        this.isSaving = false;
        this.error = true;
        this.notification.showError('Error saving pharmacy visit');
    }
    onError(errorMessage) {
        this.isSaving = false;
        this.notification.showError(errorMessage);
    }
};
PharmacyEditComponent.ctorParameters = () => [
    { type: PharmacyService },
    { type: NotificationService },
    { type: AppLoaderService },
    { type: ActivatedRoute }
];
tslib_1.__decorate([
    ViewChild(MatProgressBar, { static: true }),
    tslib_1.__metadata("design:type", MatProgressBar)
], PharmacyEditComponent.prototype, "progressBar", void 0);
tslib_1.__decorate([
    ViewChild(MatButton, { static: true }),
    tslib_1.__metadata("design:type", MatButton)
], PharmacyEditComponent.prototype, "submitButton", void 0);
PharmacyEditComponent = tslib_1.__decorate([
    Component({
        selector: 'lamis-pharmacy-edit',
        template: "<div class=\"lamis-edit-form\">\n    <div class=\"lamis-edit-form-container\">\n        <form name=\"form\" role=\"form\" novalidate (ngSubmit)=\"save()\" #pharmacyForm=\"ngForm\">\n            <mat-card class=\"default\">\n                <mat-card-header>\n                </mat-card-header>\n                <mat-card-content *ngIf=\"patient\">\n                    <div>\n                        <mat-form-field class=\"full-width\" *ngIf=\"entity && dateRegistration\">\n                            <input matInput [matDatepicker]=\"picker\"\n                                   placeholder=\"Date of Dispensing\"\n                                   [(ngModel)]=\"entity.dateVisit\"\n                                   [matDatepickerFilter]=\"filterDates.bind(this)\"\n                                   (dateChange)=\"dateVisitChanged($event.value)\"\n                                   #visit=\"ngModel\"\n                                   [max]=\"today\"\n                                   [min]=\"dateRegistration\"\n                                   name=\"visit\"\n                                   required>\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.required)\">\n                                Date of dispensing is required\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.min)\">\n                                Date of dispensing cannot be before {{dateRegistration | date: 'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"visit.errors && (visit.dirty || visit.touched) && (visit.errors.max)\">\n                                Date of dispensing cannot be in the future\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"row\" *ngIf=\"devolve && !devolve.dateReturnedToFacility\">\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\">\n                                <mat-label>Date of Devolvement</mat-label>\n                                <input matInput disabled value=\"{{devolve.dateDevolved | date: 'dd MMM, yyyy'}}\">\n                            </mat-form-field>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\">\n                                <mat-label>DMOC Type</mat-label>\n                                <input matInput disabled [value]=\"dmocType\">\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\">\n                            <mat-select [(ngModel)]=\"entity.duration\"\n                                        placeholder=\"Refill Period (days)\"\n                                        (selectionChange)=\"durationChanged($event.value)\"\n                                        #refill=\"ngModel\" required name=\"refill\">\n                                <mat-option></mat-option>\n                                <mat-option [value]=\"15\">15</mat-option>\n                                <mat-option [value]=\"30\">30</mat-option>\n                                <mat-option [value]=\"60\">60</mat-option>\n                                <mat-option [value]=\"90\">90</mat-option>\n                                <mat-option [value]=\"120\">120</mat-option>\n                                <mat-option [value]=\"150\">150</mat-option>\n                                <mat-option [value]=\"180\">180</mat-option>\n                            </mat-select>\n                            <mat-error\n                                    *ngIf=\"refill.errors && (refill.dirty || refill.touched) && (refill.errors.required)\">\n                                Refill Duration is required\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div *ngIf=\"minNextAppointment\">\n                        <mat-form-field class=\"full-width\">\n                            <input matInput [matDatepicker]=\"picker1\"\n                                   placeholder=\"Date of Next Appointment\"\n                                   [(ngModel)]=\"entity.nextAppointment\"\n                                   #next=\"ngModel\"\n                                   [min]=\"minNextAppointment\"\n                                   [max]=\"maxNextVisit\"\n                                   name=\"next\"\n                                   required>\n                            <mat-datepicker-toggle\n                                    matSuffix\n                                    [for]=\"picker1\">\n                            </mat-datepicker-toggle>\n                            <mat-datepicker #picker1></mat-datepicker>\n                            <mat-error\n                                    *ngIf=\"next.errors && (next.dirty || next.touched) && (next.errors.required)\">\n                                Date of Next Appointment is required\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"next.errors && (next.dirty || next.touched) && (next.errors.max)\">\n                                Date of Next Appointment must be after {{maxNextVisit | date:'dd MMM, yyyy'}}\n                            </mat-error>\n                            <mat-error\n                                    *ngIf=\"next.errors && (next.dirty || next.touched) && (next.errors.min)\">\n                                Date of Next Appointment must be after {{minNextAppointment | date:'dd MMM, yyyy'}}\n                            </mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div>\n                        <mat-form-field class=\"full-width\" *ngIf=\"entity.mmdType\">\n                            <mat-label>MMD Type</mat-label>\n                            <input matInput disabled [value]=\"entity.mmdType || ''\">\n                        </mat-form-field>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-checkbox [(ngModel)]=\"entity.prescriptionError\" name=\"error\">Any prescription error?\n                            </mat-checkbox>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-checkbox [(ngModel)]=\"entity.adrScreened\" name=\"screened\">Adverse Drug Reactions\n                            </mat-checkbox>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field *ngIf=\"entity.adrScreened\">\n                                <mat-select multiple [(ngModel)]=\"entity.adrs\"\n                                            name=\"adrs\"\n                                >\n                                    <mat-option></mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-form-field>\n                                <mat-select placeholder=\"Regimen Type\"\n                                            (selectionChange)=\"regimenTypeChange($event.value)\">\n                                    <mat-option></mat-option>\n                                    <mat-option *ngFor=\"let type of regimenTypes\"\n                                                [value]=\"type\">{{type.description}}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field>\n                                <mat-select placeholder=\"Regimen\"\n                                            multiple\n                                            name=\"regimen\"\n                                            [(ngModel)]=\"selectedRegimens\"\n                                            [compareWith]=\"entityCompare\"\n                                            (selectionChange)=\"regimenChange($event.value)\">\n                                    <mat-option *ngFor=\"let regimen of regimens\"\n                                                [value]=\"regimen\">{{regimen.description}}</mat-option>\n                                </mat-select>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div>\n                        Drug Dispensed\n                        <mat-divider></mat-divider>\n                        <ngx-datatable\n                            #mydatatable\n                            class=\"material\"\n                            [headerHeight]=\"50\"\n                            [limit]=\"8\"\n                            [columnMode]=\"ColumnMode.force\"\n                            [footerHeight]=\"50\"\n                            rowHeight=\"auto\"\n                            [rows]=\"rows\"\n                        >\n                            <ngx-datatable-column name=\"Description\">\n                                <ng-template ngx-datatable-cell-template let-value=\"value\">\n                                    <mat-form-field>\n                                        <input matInput disabled [value]=\"value\" style=\"font-weight: 900\">\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Morning\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'morning', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Afternoon\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'afternoon', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Evening\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'evening', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Duration\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field class=\"full-width\">\n                                        <input\n                                                autofocus\n                                                matInput\n                                                type=\"number\"\n                                                (blur)=\"updateValue($event, 'duration', rowIndex)\"\n                                                [value]=\"value\"\n                                        >\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column [maxWidth]=\"1\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                </ng-template>\n                            </ngx-datatable-column>\n                            <ngx-datatable-column name=\"Quantity\">\n                                <ng-template ngx-datatable-cell-template let-rowIndex=\"rowIndex\" let-value=\"value\"\n                                             let-row=\"row\">\n                                    <mat-form-field>\n                                        <input matInput disabled [value]=\"value\" style=\"font-weight: 900\">\n                                    </mat-form-field>\n                                </ng-template>\n                            </ngx-datatable-column>\n                        </ngx-datatable>\n                    </div>\n                    <mat-divider></mat-divider>\n                </mat-card-content>\n                <ng-container *ngIf=\"iptSelected\">\n                    <div class=\"row\">\n                        <div class=\"col-md-12\">\n                            <mat-form-field>\n                                <mat-label>IPT Type</mat-label>\n                                <mat-select required [(ngModel)]=\"ipt.type\" name=\"inh\" #inh=\"ngModel\">\n                                    <mat-option></mat-option>\n                                    <mat-option [value]=\"'START_INITIATION'\">Start Initiation</mat-option>\n                                    <mat-option [value]=\"'START_REFILL'\">Start Refill</mat-option>\n                                    <mat-option [value]=\"'FOLLOWUP_INITIATION'\">Followup Initiation</mat-option>\n                                    <mat-option [value]=\"'FOLLOWUP_REFILL'\">Followup Refill</mat-option>\n                                </mat-select>\n                                <mat-error\n                                        *ngIf=\"inh.errors && (inh.dirty || inh.touched) && (inh.errors.required)\">\n                                    IPT Type is required\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                    <div class=\"row\">\n                        <div class=\"col-md-6\">\n                            <mat-checkbox [(ngModel)]=\"ipt.completed\"\n                                          name=\"uibn\"\n                            >\n                                IPT completed?\n                            </mat-checkbox>\n                        </div>\n                        <div class=\"col-md-6\">\n                            <mat-form-field class=\"full-width\" *ngIf=\"entity.dateVisit && ipt.completed\">\n                                <input matInput [matDatepicker]=\"picker2\"\n                                       placeholder=\"Date of Completion\"\n                                       [(ngModel)]=\"ipt.dateCompleted\"\n                                       #com=\"ngModel\"\n                                       [min]=\"entity.dateVisit\"\n                                       name=\"com\"\n                                       required>\n                                <mat-datepicker-toggle\n                                        matSuffix\n                                        [for]=\"picker2\">\n                                </mat-datepicker-toggle>\n                                <mat-datepicker #picker2></mat-datepicker>\n                                <mat-error\n                                        *ngIf=\"com.errors && (com.dirty || com.touched) && (com.errors.required)\">\n                                    Date completed is required\n                                </mat-error>\n                                <mat-error\n                                        *ngIf=\"com.errors && (com.dirty || com.touched) && (com.errors.min)\">\n                                    Date must not be before {{entity.dateVisit | date:'dd MMM, yyyy'}}\n                                </mat-error>\n                            </mat-form-field>\n                        </div>\n                    </div>\n                </ng-container>\n                <mat-card-actions class=\"lamis-edit-form-actions\">\n                    <button mat-raised-button type=\"button\" (click)=\"previousState()\">Back</button>\n                    <button mat-raised-button color='primary'\n                            [disabled]=\"pharmacyForm.invalid || rows.length === 0 || isSaving\"\n                            type=\"submit\">\n                        {{entity.id !== undefined ? 'Update' : 'Save'}}\n                    </button>\n                </mat-card-actions>\n            </mat-card>\n        </form>\n    </div>\n</div>\n"
    }),
    tslib_1.__metadata("design:paramtypes", [PharmacyService,
        NotificationService,
        AppLoaderService,
        ActivatedRoute])
], PharmacyEditComponent);
export { PharmacyEditComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGhhcm1hY3ktZWRpdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9sYW1pcy1waGFybWFjeS0xLjQuMC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BoYXJtYWN5LWVkaXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFVLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUUzRCxPQUFPLEVBQUMsZUFBZSxFQUFDLE1BQU0sOEJBQThCLENBQUM7QUFDN0QsT0FBTyxFQUFDLG1CQUFtQixFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFDdkQsT0FBTyxFQUFDLGNBQWMsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBQyxTQUFTLEVBQUUsY0FBYyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFHNUQsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ25ELE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDO0FBRWxDLE9BQU8sRUFBQyxnQkFBZ0IsRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFFN0UsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDO0FBRXZCLE1BQU0sQ0FBQyxNQUFNLFFBQVEsR0FBRztJQUNwQixrQkFBa0IsRUFBRSxrQkFBa0I7SUFDdEMsY0FBYyxFQUFFLGNBQWM7SUFDOUIscUJBQXFCLEVBQUUscUJBQXFCO0lBQzVDLGlCQUFpQixFQUFFLGlCQUFpQjtDQUN2QyxDQUFDO0FBWUYsSUFBYSxxQkFBcUIsR0FBbEMsTUFBYSxxQkFBcUI7SUE0QjlCLFlBQW9CLGVBQWdDLEVBQzlCLFlBQWlDLEVBQ25DLGdCQUFrQyxFQUNoQyxjQUE4QjtRQUhoQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFDOUIsaUJBQVksR0FBWixZQUFZLENBQXFCO1FBQ25DLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDaEMsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBNUJwRCxXQUFNLEdBQWEsRUFBRSxDQUFDO1FBSXRCLGlCQUFZLEdBQWtCLEVBQUUsQ0FBQztRQUNqQyxhQUFRLEdBQWMsRUFBRSxDQUFDO1FBQ3pCLHFCQUFnQixHQUFjLEVBQUUsQ0FBQztRQUdqQyxVQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2QsYUFBUSxHQUFHLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbkMsVUFBSyxHQUFHLE1BQU0sRUFBRSxDQUFDO1FBRWpCLGVBQVUsR0FBRyxVQUFVLENBQUM7UUFDeEIsWUFBTyxHQUFHLEVBQUUsQ0FBQztRQUNiLFNBQUksR0FBbUIsRUFBRSxDQUFDO1FBQzFCLFlBQU8sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLGVBQVUsR0FBYSxFQUFFLENBQUM7UUFHMUIsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUNuQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQixRQUFHLEdBQVEsRUFBRSxDQUFDO0lBT2QsQ0FBQztJQUVELFlBQVk7UUFDUixPQUFpQixFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFDLE1BQU0sRUFBQyxFQUFFLEVBQUU7WUFDNUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUM3RCxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssU0FBUyxFQUFFO2dCQUMzQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQzthQUNyQztZQUNELE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDekUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ3pELElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztnQkFDMUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUM7Z0JBQ25CLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsZ0JBQWdCLENBQUM7Z0JBQzdDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDeEUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxzQkFBc0IsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7b0JBQ25FLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO2dCQUMzQixDQUFDLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDakQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO3dCQUNoQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7NEJBQzdHLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQztvQkFDbEMsQ0FBQyxDQUFDLENBQUM7Z0JBQ1AsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsSUFBSSxDQUFDLGVBQWUsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0YsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFO2dCQUNoQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRTtvQkFDNUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUU7d0JBQ2hELGFBQWEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSTtxQkFDbEgsQ0FBQyxDQUFDO2lCQUNOO2dCQUVELElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTt3QkFDdEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBYyxFQUFFLEVBQUU7NEJBQzlFLENBQUMsQ0FBQyxXQUFXLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO3dCQUNwRixDQUFDLENBQUMsQ0FBQzt3QkFDSCxDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDO3dCQUMzQixDQUFDLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDO3dCQUMvQixDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDO3dCQUMzQixJQUFJLENBQUMsQ0FBQyxlQUFlLEtBQUssRUFBRSxFQUFFOzRCQUMxQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQzt5QkFDM0I7d0JBQ0QsQ0FBQyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQzt3QkFFckYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTs0QkFDOUQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLEVBQUU7Z0NBQ3hELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dDQUN4QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dDQUNoQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7Z0NBQ25DLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7NkJBQ3REO3dCQUNMLENBQUMsQ0FBQyxDQUFDO3dCQUNILE9BQU8sQ0FBQyxDQUFDO29CQUNiLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRUosSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztxQkFDeEQsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztxQkFDekIsR0FBRyxFQUFFLENBQUM7Z0JBRVgsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUMvRixJQUFJLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztvQkFDbkIsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUMxQixDQUFDLENBQUMsQ0FBQzthQUNOO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsZ0JBQWdCLENBQUMsSUFBWTtRQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUM5RCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNsRixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDekUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQy9GLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1lBQ25CLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztJQUVQLENBQUM7SUFFRCx3QkFBd0I7UUFDcEIsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRTtZQUN2QixJQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNoRyxNQUFNLE9BQU8sR0FBRyxlQUFlLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDN0MsSUFBSSxPQUFPLEtBQUssQ0FBQyxFQUFFO2dCQUNmLGVBQWUsR0FBRyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQzthQUM1RDtpQkFBTSxJQUFJLE9BQU8sS0FBSyxDQUFDLEVBQUU7Z0JBQ3RCLGVBQWUsR0FBRyxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQzthQUM1RDtZQUNELE9BQU8sZUFBZSxDQUFDO1NBQzFCO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVELGNBQWM7UUFDVixJQUFJLElBQUksR0FBRyxLQUFLLENBQUM7UUFDakIsUUFBUSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUMzQixLQUFLLEtBQUs7Z0JBQ04sSUFBSSxHQUFHLHdCQUF3QixDQUFDO2dCQUNoQyxNQUFNO1lBQ1YsS0FBSyxPQUFPO2dCQUNSLElBQUksR0FBRyxPQUFPLENBQUM7Z0JBQ2YsTUFBTTtZQUNWLEtBQUssTUFBTTtnQkFDUCxJQUFJLEdBQUcsTUFBTSxDQUFDO2dCQUNkLE1BQU07WUFDVixLQUFLLFFBQVE7Z0JBQ1QsSUFBSSxHQUFHLFFBQVEsQ0FBQztnQkFDaEIsTUFBTTtZQUNWLEtBQUssWUFBWTtnQkFDYixJQUFJLEdBQUcsWUFBWSxDQUFDO2dCQUNwQixNQUFNO1lBQ1YsS0FBSyxRQUFRO2dCQUNULElBQUksR0FBRyxRQUFRLENBQUM7Z0JBQ2hCLE1BQU07WUFDVixLQUFLLEtBQUs7Z0JBQ04sSUFBSSxHQUFHLEtBQUssQ0FBQztnQkFDYixNQUFNO1NBQ2I7UUFDRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUN6QixDQUFDO0lBRUQsV0FBVyxDQUFDLElBQVk7UUFDcEIsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBRW5CLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ3hCLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUM1QixNQUFNLEdBQUcsSUFBSSxDQUFDO2FBQ2pCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN6RixDQUFDO0lBR0QsYUFBYTtRQUNULE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVELGFBQWEsQ0FBQyxFQUFFLEVBQUUsRUFBRTtRQUNoQixPQUFPLGFBQWEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDakMsQ0FBQztJQUVELElBQUk7UUFDQSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDbEMsMkNBQTJDO1FBQzNDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzlCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRTtZQUNwQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7U0FDMUI7UUFDRCxJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtZQUM5QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDaEQsYUFBYSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxJQUFJLElBQUksSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO29CQUMvRSxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7YUFDeEQsQ0FBQyxDQUFDO1NBQ047UUFFRCxJQUFJLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUU7WUFDL0MsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsRUFBRTtnQkFDNUQsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUM7b0JBQ3hCLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsaUNBQWlDLENBQUMsQ0FBQztnQkFDekYsSUFBSSxDQUFDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUM5QixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztnQkFDdEIsT0FBTzthQUNWO1NBQ0o7UUFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLFNBQVMsRUFBRTtZQUM5QixJQUFJLENBQUMsdUJBQXVCLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7U0FDMUU7YUFBTTtZQUNILElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztTQUMxRTtJQUNMLENBQUM7SUFFRCxpQkFBaUIsQ0FBQyxJQUFTO1FBQ3ZCLElBQUksQ0FBQyxlQUFlLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQWMsRUFBRSxFQUFFO1lBQzVFLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFnQixFQUFFLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO29CQUNwRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDNUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO2lCQUN0QztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsZUFBZSxDQUFDLFFBQVE7UUFDcEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUMxQixDQUFDLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztZQUN0QixDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxRQUFRLENBQUM7WUFDOUQsT0FBTyxDQUFDLENBQUM7UUFDYixDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUzQixJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUU5RCxJQUFJLFFBQVEsS0FBSyxFQUFFLEVBQUU7WUFDakIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1NBQ2pDO2FBQU0sSUFBSSxRQUFRLEtBQUssR0FBRyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztTQUNqQzthQUFNLElBQUksUUFBUSxLQUFLLEdBQUcsRUFBRTtZQUN6QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7U0FDakM7YUFBTSxJQUFJLFFBQVEsS0FBSyxHQUFHLEVBQUU7WUFDekIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1NBQ2pDO2FBQU07WUFDSCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7U0FDOUI7UUFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUNuRjtJQUNMLENBQUM7SUFFRCxRQUFRO1FBQ0osT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQztJQUVELGFBQWEsQ0FBQyxLQUFLO1FBQ2YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNwQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDL0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7YUFDM0I7WUFDRCxJQUFJLENBQUMsZUFBZSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFjLEVBQUUsRUFBRTtnQkFDNUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQWEsRUFBRSxFQUFFO29CQUMxQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7d0JBQzdELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDOzRCQUNYLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSTs0QkFDZixXQUFXLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJOzRCQUMzQixPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPOzRCQUMxQixTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTOzRCQUM5QixPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPOzRCQUMxQixVQUFVLEVBQUUsT0FBTyxDQUFDLEVBQUU7NEJBQ3RCLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVE7NEJBQzlCLFFBQVEsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsSUFBSSxDQUFDLENBQUM7a0NBQ2pGLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLENBQUM7NEJBQy9CLGVBQWUsRUFBRSxPQUFPLENBQUMsV0FBVyxDQUFDLEVBQUU7NEJBQ3ZDLGVBQWUsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUU7eUJBQ3ZDLENBQUMsQ0FBQzt3QkFDSCxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7d0JBQzNCLDhCQUE4QjtxQkFDakM7b0JBRUQsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUNqSCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTt3QkFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7NEJBQ3pELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQzt5QkFDMUQ7b0JBQ0wsQ0FBQyxDQUFDLENBQUM7Z0JBQ1AsQ0FBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLFFBQVE7UUFDN0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQy9DLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUU7WUFDdEIsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLENBQUM7Z0JBQ2xFLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxHQUFHLEVBQUUsRUFBRSxDQUFDO2dCQUMxRCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzdELElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNwRTtRQUNELElBQUksSUFBSSxLQUFLLFVBQVUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLGVBQWUsS0FBSyxFQUFFLEVBQUU7WUFDbkUsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRTtnQkFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7YUFDN0Y7U0FDSjtRQUNELElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRU8sdUJBQXVCLENBQUMsTUFBcUM7UUFDakUsTUFBTSxDQUFDLFNBQVMsQ0FDWixDQUFDLEdBQXNCLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUN4RCxDQUFDLEdBQXNCLEVBQUUsRUFBRTtZQUN2QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDOUIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ25CLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVPLGFBQWEsQ0FBQyxNQUFXO1FBQzdCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRU8sV0FBVztRQUNmLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLDZCQUE2QixDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVTLE9BQU8sQ0FBQyxZQUFvQjtRQUNsQyxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM5QyxDQUFDO0NBQ0osQ0FBQTs7WUFwVHdDLGVBQWU7WUFDaEIsbUJBQW1CO1lBQ2pCLGdCQUFnQjtZQUNoQixjQUFjOztBQTlCVDtJQUExQyxTQUFTLENBQUMsY0FBYyxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDO3NDQUFjLGNBQWM7MERBQUM7QUFDakM7SUFBckMsU0FBUyxDQUFDLFNBQVMsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsQ0FBQztzQ0FBZSxTQUFTOzJEQUFDO0FBRnJELHFCQUFxQjtJQUpqQyxTQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUscUJBQXFCO1FBQy9CLDZvb0JBQTZDO0tBQ2hELENBQUM7NkNBNkJ1QyxlQUFlO1FBQ2hCLG1CQUFtQjtRQUNqQixnQkFBZ0I7UUFDaEIsY0FBYztHQS9CM0MscUJBQXFCLENBZ1ZqQztTQWhWWSxxQkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtBZHIsIERldm9sdmUsIERydWcsIERydWdEVE8sIFBhdGllbnQsIFBoYXJtYWN5LCBQaGFybWFjeUxpbmUsIFJlZ2ltZW4sIFJlZ2ltZW5UeXBlLCBTdGF0dXNIaXN0b3J5fSBmcm9tICcuLi9tb2RlbC9waGFybWFjeS5tb2RlbCc7XG5pbXBvcnQge1BoYXJtYWN5U2VydmljZX0gZnJvbSAnLi4vc2VydmljZXMvcGhhcm1hY3kuc2VydmljZSc7XG5pbXBvcnQge05vdGlmaWNhdGlvblNlcnZpY2V9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5pbXBvcnQge0FjdGl2YXRlZFJvdXRlfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHtNYXRCdXR0b24sIE1hdFByb2dyZXNzQmFyfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbCc7XG5pbXBvcnQge0h0dHBFcnJvclJlc3BvbnNlLCBIdHRwUmVzcG9uc2V9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5pbXBvcnQge0NvbHVtbk1vZGV9IGZyb20gJ0Bzd2ltbGFuZS9uZ3gtZGF0YXRhYmxlJztcbmltcG9ydCAqIGFzIG1vbWVudF8gZnJvbSAnbW9tZW50JztcbmltcG9ydCB7TW9tZW50fSBmcm9tICdtb21lbnQnO1xuaW1wb3J0IHtBcHBMb2FkZXJTZXJ2aWNlLCBEQVRFX0ZPUk1BVCwgZW50aXR5Q29tcGFyZX0gZnJvbSAnQGxhbWlzL3dlYi1jb3JlJztcblxuY29uc3QgbW9tZW50ID0gbW9tZW50XztcblxuZXhwb3J0IGNvbnN0IElQVF9UWVBFID0ge1xuICAgICdTVEFSVF9JTklUSUFUSU9OJzogJ1N0YXJ0IEluaXRpYXRpb24nLFxuICAgICdTVEFSVF9SRUZJTEwnOiAnU3RhcnQgUmVmaWxsJyxcbiAgICAnRk9MTE9XVVBfSU5JVElBVElPTic6ICdGb2xsb3d1cCBJbml0aWF0aW9uJyxcbiAgICAnRk9MTE9XVVBfUkVGSUxMJzogJ0ZvbGxvd3VwIFJlZmlsbCdcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgSXB0IHtcbiAgICB0eXBlPzogc3RyaW5nO1xuICAgIGNvbXBsZXRlZD86IGJvb2xlYW47XG4gICAgZGF0ZUNvbXBsZXRlZD86IE1vbWVudDtcbn1cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdsYW1pcy1waGFybWFjeS1lZGl0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vcGhhcm1hY3ktZWRpdC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUGhhcm1hY3lFZGl0Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBAVmlld0NoaWxkKE1hdFByb2dyZXNzQmFyLCB7c3RhdGljOiB0cnVlfSkgcHJvZ3Jlc3NCYXI6IE1hdFByb2dyZXNzQmFyO1xuICAgIEBWaWV3Q2hpbGQoTWF0QnV0dG9uLCB7c3RhdGljOiB0cnVlfSkgc3VibWl0QnV0dG9uOiBNYXRCdXR0b247XG4gICAgZW50aXR5OiBQaGFybWFjeSA9IHt9O1xuICAgIHBhdGllbnQ6IFBhdGllbnQ7XG4gICAgZGF0ZVJlZ2lzdHJhdGlvbjogTW9tZW50O1xuICAgIG1heE5leHRWaXNpdDogTW9tZW50O1xuICAgIHJlZ2ltZW5UeXBlczogUmVnaW1lblR5cGVbXSA9IFtdO1xuICAgIHJlZ2ltZW5zOiBSZWdpbWVuW10gPSBbXTtcbiAgICBzZWxlY3RlZFJlZ2ltZW5zOiBSZWdpbWVuW10gPSBbXTtcbiAgICBhZHJzOiBBZHJbXTtcbiAgICBpc1NhdmluZzogYm9vbGVhbjtcbiAgICBlcnJvciA9IGZhbHNlO1xuICAgIHRvbW9ycm93ID0gbW9tZW50KCkuYWRkKDEsICdkYXlzJyk7XG4gICAgdG9kYXkgPSBtb21lbnQoKTtcbiAgICBtaW5OZXh0QXBwb2ludG1lbnQ6IE1vbWVudDtcbiAgICBDb2x1bW5Nb2RlID0gQ29sdW1uTW9kZTtcbiAgICBlZGl0aW5nID0ge307XG4gICAgcm93czogUGhhcm1hY3lMaW5lW10gPSBbXTtcbiAgICBkcnVnSWRzID0gbmV3IFNldCgpO1xuICAgIHZpc2l0RGF0ZXM6IE1vbWVudFtdID0gW107XG4gICAgZGV2b2x2ZTogRGV2b2x2ZTtcbiAgICBkbW9jVHlwZTogc3RyaW5nO1xuICAgIGRydWdzOiBEcnVnW10gPSBbXTtcbiAgICBpcHRTZWxlY3RlZCA9IGZhbHNlO1xuICAgIGlwdDogSXB0ID0ge307XG4gICAgZGVhZFN0YXR1czogU3RhdHVzSGlzdG9yeTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcGhhcm1hY3lTZXJ2aWNlOiBQaGFybWFjeVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIG5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcExvYWRlclNlcnZpY2U6IEFwcExvYWRlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIGFjdGl2YXRlZFJvdXRlOiBBY3RpdmF0ZWRSb3V0ZSkge1xuICAgIH1cblxuICAgIGNyZWF0ZUVudGl0eSgpOiBQaGFybWFjeSB7XG4gICAgICAgIHJldHVybiA8UGhhcm1hY3k+e307XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hY3RpdmF0ZWRSb3V0ZS5kYXRhLnN1YnNjcmliZSgoe2VudGl0eX0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5ID0gISFlbnRpdHkgJiYgZW50aXR5LmJvZHkgPyBlbnRpdHkuYm9keSA6IGVudGl0eTtcbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkgPSB0aGlzLmNyZWF0ZUVudGl0eSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcGF0aWVudElkID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5wYXJhbU1hcC5nZXQoJ3BhdGllbnRJZCcpO1xuICAgICAgICAgICAgdGhpcy5waGFybWFjeVNlcnZpY2UuZ2V0UGF0aWVudChwYXRpZW50SWQpLnN1YnNjcmliZSgocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkucGF0aWVudCA9IHJlcztcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGllbnQgPSByZXM7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRlUmVnaXN0cmF0aW9uID0gcmVzLmRhdGVSZWdpc3RyYXRpb247XG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkuZmFjaWxpdHkgPSByZXMuZmFjaWxpdHk7XG4gICAgICAgICAgICAgICAgdGhpcy5taW5OZXh0QXBwb2ludG1lbnQgPSB0aGlzLmRhdGVSZWdpc3RyYXRpb24uY2xvbmUoKS5hZGQoMTUsICdkYXlzJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5waGFybWFjeVNlcnZpY2UuZ2V0VmlzaXREYXRlc0J5UGF0aWVudChyZXMuaWQpLnN1YnNjcmliZSgocmVzMSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2l0RGF0ZXMgPSByZXMxO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5waGFybWFjeVNlcnZpY2UucmVnaW1lblR5cGVzKCkuc3Vic2NyaWJlKHJlczEgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5UeXBlcyA9IHJlczEuZmlsdGVyKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW50aXR5LnBhdGllbnQuZXh0cmEgJiYgdGhpcy5lbnRpdHkucGF0aWVudC5leHRyYS5wcmVwICYmIHRoaXMuZW50aXR5LnBhdGllbnQuZXh0cmEucHJlcC5yZWdpc3RlcmVkID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0LmlkID09PSAzMCA6IHQuaWQgIT09IDMwO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLmhhc0RlYWRTdGF0dXMocGF0aWVudElkKS5zdWJzY3JpYmUociA9PiB0aGlzLmRlYWRTdGF0dXMgPSByLmJvZHkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5pZCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5leHRyYSAmJiB0aGlzLmVudGl0eS5leHRyYS5pcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pcHQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmVudGl0eS5leHRyYS5pcHQsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVDb21wbGV0ZWQ6IHRoaXMuZW50aXR5LmV4dHJhLmlwdC5kYXRlQ29tcGxldGVkICE9IG51bGwgPyBtb21lbnQodGhpcy5lbnRpdHkuZXh0cmEuaXB0LmRhdGVDb21wbGV0ZWQpIDogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0aGlzLnJvd3MgPSBbLi4udGhpcy5lbnRpdHkubGluZXMubWFwKHIgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBoYXJtYWN5U2VydmljZS5nZXREcnVnc0J5UmVnaW1lbihyLnJlZ2ltZW5faWQpLnN1YnNjcmliZSgocmVzOiBEcnVnRFRPW10pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIuZGVzY3JpcHRpb24gPSByZXMuZmluZChkID0+IGQucmVnaW1lbkRydWcuaWQgPT09IHIucmVnaW1lbl9kcnVnX2lkKS5kcnVnLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByLm1vcm5pbmcgPSByLm1vcm5pbmcgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgci5hZnRlcm5vb24gPSByLmFmdGVybm9vbiB8fCAwO1xuICAgICAgICAgICAgICAgICAgICByLmV2ZW5pbmcgPSByLmV2ZW5pbmcgfHwgMDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHIucmVnaW1lbl90eXBlX2lkID09PSAxNSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pcHRTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgci5xdWFudGl0eSA9ICgoci5tb3JuaW5nIHx8IDApICsgKHIuYWZ0ZXJub29uIHx8IDApICsgKHIuZXZlbmluZyB8fCAwKSkgKiByLmR1cmF0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLmdldFJlZ2ltZW5CeUlkKHIucmVnaW1lbl9pZCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMucmVnaW1lbnMubWFwKHJzID0+IHJzLmlkKS5pbmNsdWRlcyhyLnJlZ2ltZW5faWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpbWVucy5wdXNoKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFJlZ2ltZW5zLnB1c2gocmVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2ltZW5zID0gWy4uLnRoaXMucmVnaW1lbnNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRSZWdpbWVucyA9IFsuLi50aGlzLnNlbGVjdGVkUmVnaW1lbnNdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgICAgICAgICAgfSldO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5lbnRpdHkuZHVyYXRpb24gPSB0aGlzLmVudGl0eS5saW5lcy5tYXAociA9PiByLmR1cmF0aW9uKVxuICAgICAgICAgICAgICAgICAgICAuc29ydCgocjEsIHIyKSA9PiByMSAtIHIyKVxuICAgICAgICAgICAgICAgICAgICAucG9wKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnBoYXJtYWN5U2VydmljZS5nZXREZXZvbHZlbWVudCh0aGlzLmVudGl0eS5wYXRpZW50LmlkLCB0aGlzLmVudGl0eS5kYXRlVmlzaXQpLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRldm9sdmUgPSByZXM7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRG1vY1R5cGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZGF0ZVZpc2l0Q2hhbmdlZChkYXRlOiBNb21lbnQpIHtcbiAgICAgICAgdGhpcy5lbnRpdHkubmV4dEFwcG9pbnRtZW50ID0gdGhpcy5zdWdnZXN0ZWROZXh0QXBwb2ludG1lbnQoKTtcbiAgICAgICAgdGhpcy5taW5OZXh0QXBwb2ludG1lbnQgPSB0aGlzLmVudGl0eS5uZXh0QXBwb2ludG1lbnQuY2xvbmUoKS5zdWJ0cmFjdCg3LCAnZGF5cycpO1xuICAgICAgICB0aGlzLm1heE5leHRWaXNpdCA9IHRoaXMuZW50aXR5Lm5leHRBcHBvaW50bWVudC5jbG9uZSgpLmFkZCg4LCAnbW9udGhzJyk7XG4gICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLmdldERldm9sdmVtZW50KHRoaXMuZW50aXR5LnBhdGllbnQuaWQsIHRoaXMuZW50aXR5LmRhdGVWaXNpdCkuc3Vic2NyaWJlKHJlcyA9PiB7XG4gICAgICAgICAgICB0aGlzLmRldm9sdmUgPSByZXM7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZURtb2NUeXBlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgc3VnZ2VzdGVkTmV4dEFwcG9pbnRtZW50KCk6IE1vbWVudCB7XG4gICAgICAgIGlmICh0aGlzLmVudGl0eS5kYXRlVmlzaXQpIHtcbiAgICAgICAgICAgIGxldCBuZXh0QXBwb2ludG1lbnQgPSB0aGlzLmVudGl0eS5kYXRlVmlzaXQuY2xvbmUoKS5hZGQodGhpcy5lbnRpdHkuZHVyYXRpb24gLSAyIHx8IDEzLCAnZGF5cycpO1xuICAgICAgICAgICAgY29uc3Qgd2Vla2RheSA9IG5leHRBcHBvaW50bWVudC5pc29XZWVrZGF5KCk7XG4gICAgICAgICAgICBpZiAod2Vla2RheSA9PT0gNikge1xuICAgICAgICAgICAgICAgIG5leHRBcHBvaW50bWVudCA9IG5leHRBcHBvaW50bWVudC5jbG9uZSgpLmFkZCgyLCAnZGF5cycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh3ZWVrZGF5ID09PSA3KSB7XG4gICAgICAgICAgICAgICAgbmV4dEFwcG9pbnRtZW50ID0gbmV4dEFwcG9pbnRtZW50LmNsb25lKCkuYWRkKDEsICdkYXlzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV4dEFwcG9pbnRtZW50O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHVwZGF0ZURtb2NUeXBlKCkge1xuICAgICAgICBsZXQgdHlwZSA9ICdNTUQnO1xuICAgICAgICBzd2l0Y2ggKHRoaXMuZGV2b2x2ZS5kbW9jVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnQVJDJzpcbiAgICAgICAgICAgICAgICB0eXBlID0gJ0Fkb2xlc2NlbnQgUmVmaWxsIENsdWInO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQ1BBUlAnOlxuICAgICAgICAgICAgICAgIHR5cGUgPSAnQ1BBUlAnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQ0FSQyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdDQVJDJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ0ZfQ0FSRyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdGLUNBUkcnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnRkFTVF9UUkFDSyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdGYXN0IFRyYWNrJztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ1NfQ0FSRyc6XG4gICAgICAgICAgICAgICAgdHlwZSA9ICdTLUNBUkcnO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnTU1TJzpcbiAgICAgICAgICAgICAgICB0eXBlID0gJ01NUyc7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kbW9jVHlwZSA9IHR5cGU7XG4gICAgfVxuXG4gICAgZmlsdGVyRGF0ZXMoZGF0ZTogTW9tZW50KTogYm9vbGVhbiB7XG4gICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLnZpc2l0RGF0ZXMuZm9yRWFjaChkID0+IHtcbiAgICAgICAgICAgIGlmIChkYXRlLmRpZmYoZCwgJ2RheXMnKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKHRoaXMuZW50aXR5LmlkICYmIGRhdGUuZGlmZih0aGlzLmVudGl0eS5kYXRlVmlzaXQsICdkYXlzJykgPT09IDApIHx8ICFleGlzdHM7XG4gICAgfVxuXG5cbiAgICBwcmV2aW91c1N0YXRlKCkge1xuICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgfVxuXG4gICAgZW50aXR5Q29tcGFyZShlMSwgZTIpIHtcbiAgICAgICAgcmV0dXJuIGVudGl0eUNvbXBhcmUoZTEsIGUyKTtcbiAgICB9XG5cbiAgICBzYXZlKCkge1xuICAgICAgICB0aGlzLnN1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMucHJvZ3Jlc3NCYXIubW9kZSA9ICdpbmRldGVybWluYXRlJztcbiAgICAgICAgdGhpcy5hcHBMb2FkZXJTZXJ2aWNlLm9wZW4oJ1NhdmluZyB2aXNpdC4uLicpO1xuICAgICAgICB0aGlzLmVudGl0eS5saW5lcyA9IHRoaXMucm93cztcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IHRydWU7XG4gICAgICAgIGlmICghdGhpcy5lbnRpdHkuZXh0cmEpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXB0U2VsZWN0ZWQgJiYgdGhpcy5pcHQpIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5LmV4dHJhLmlwdCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuaXB0LCB7XG4gICAgICAgICAgICAgICAgZGF0ZUNvbXBsZXRlZDogdGhpcy5pcHQuZGF0ZUNvbXBsZXRlZCAhPSBudWxsICYmIHRoaXMuaXB0LmRhdGVDb21wbGV0ZWQuaXNWYWxpZCgpID9cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pcHQuZGF0ZUNvbXBsZXRlZC5mb3JtYXQoREFURV9GT1JNQVQpIDogbnVsbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5kZWFkU3RhdHVzICYmIHRoaXMuZGVhZFN0YXR1cy5kYXRlU3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kZWFkU3RhdHVzLmRhdGVTdGF0dXMuaXNCZWZvcmUodGhpcy5lbnRpdHkuZGF0ZVZpc2l0KSkge1xuICAgICAgICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9uLnNob3dFcnJvcihgQ2Fubm90IHNhdmUgcmVmaWxsLCBwYXRpZW50IHdhcyBkZWNsYXJlZCBkZWFkXG4gICAgICAgICAgICAgICAgICgke3RoaXMuZGVhZFN0YXR1cy5kYXRlU3RhdHVzLmZvcm1hdCgnREQgTU1NTSwgWVlZWScpfSkgYmVmb3JlIGRhdGUgb2YgY3VycmVudCByZWZpbGxgKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZW50aXR5LmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlVG9TYXZlUmVzcG9uc2UodGhpcy5waGFybWFjeVNlcnZpY2UudXBkYXRlKHRoaXMuZW50aXR5KSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZVRvU2F2ZVJlc3BvbnNlKHRoaXMucGhhcm1hY3lTZXJ2aWNlLmNyZWF0ZSh0aGlzLmVudGl0eSkpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVnaW1lblR5cGVDaGFuZ2UodHlwZTogYW55KSB7XG4gICAgICAgIHRoaXMucGhhcm1hY3lTZXJ2aWNlLnJlZ2ltZXNCeVJlZ2ltZW5UeXBlKHR5cGUuaWQpLnN1YnNjcmliZSgocmVzOiBSZWdpbWVuW10pID0+IHtcbiAgICAgICAgICAgIHJlcy5mb3JFYWNoKChyZWdpbWVuOiBSZWdpbWVuKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlZ2ltZW5zLm1hcChyID0+IHIuaWQpLmluY2x1ZGVzKHJlZ2ltZW4uaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVnaW1lbnMucHVzaChyZWdpbWVuKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpbWVucyA9IFsuLi50aGlzLnJlZ2ltZW5zXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZHVyYXRpb25DaGFuZ2VkKGR1cmF0aW9uKSB7XG4gICAgICAgIHRoaXMucm93cyA9IHRoaXMucm93cy5tYXAociA9PiB7XG4gICAgICAgICAgICByLmR1cmF0aW9uID0gZHVyYXRpb247XG4gICAgICAgICAgICByLnF1YW50aXR5ID0gKHIubW9ybmluZyArIHIuYWZ0ZXJub29uICsgci5ldmVuaW5nKSAqIGR1cmF0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHI7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJvd3MgPSBbLi4udGhpcy5yb3dzXTtcblxuICAgICAgICB0aGlzLmVudGl0eS5uZXh0QXBwb2ludG1lbnQgPSB0aGlzLnN1Z2dlc3RlZE5leHRBcHBvaW50bWVudCgpO1xuXG4gICAgICAgIGlmIChkdXJhdGlvbiA9PT0gOTApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTMnO1xuICAgICAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09PSAxMjApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTQnO1xuICAgICAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09PSAxNTApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTUnO1xuICAgICAgICB9IGVsc2UgaWYgKGR1cmF0aW9uID09PSAxODApIHtcbiAgICAgICAgICAgIHRoaXMuZW50aXR5Lm1tZFR5cGUgPSAnTU1ELTYnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbnRpdHkubW1kVHlwZSA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5lbnRpdHkuZGF0ZVZpc2l0KSB7XG4gICAgICAgICAgICB0aGlzLmlwdFsnZGF0ZUNvbXBsZXRlZCddID0gdGhpcy5lbnRpdHkuZGF0ZVZpc2l0LmNsb25lKCkuYWRkKGR1cmF0aW9uLCAnZGF5cycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaXB0VHlwZXMoKSB7XG4gICAgICAgIHJldHVybiBJUFRfVFlQRTtcbiAgICB9XG5cbiAgICByZWdpbWVuQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRSZWdpbWVucy5mb3JFYWNoKHJlZ2ltZW4gPT4ge1xuICAgICAgICAgICAgaWYgKHJlZ2ltZW4ucmVnaW1lblR5cGUuaWQgPT09IDE1KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pcHRTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnBoYXJtYWN5U2VydmljZS5nZXREcnVnc0J5UmVnaW1lbihyZWdpbWVuLmlkKS5zdWJzY3JpYmUoKHJlczogRHJ1Z0RUT1tdKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzLmZvckVhY2goKGRydWc6IERydWdEVE8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvd3MubWFwKHIgPT4gci5kZXNjcmlwdGlvbikuaW5jbHVkZXMoZHJ1Zy5kcnVnLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJ1ZzogZHJ1Zy5kcnVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkcnVnLmRydWcubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3JuaW5nOiBkcnVnLmRydWcubW9ybmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlcm5vb246IGRydWcuZHJ1Zy5hZnRlcm5vb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbmluZzogZHJ1Zy5kcnVnLmV2ZW5pbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW1lbl9pZDogcmVnaW1lbi5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy5lbnRpdHkuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IHRoaXMuZW50aXR5LmR1cmF0aW9uICogKChkcnVnLmRydWcubW9ybmluZyB8fCAwKSArIChkcnVnLmRydWcuYWZ0ZXJub29uIHx8IDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgKGRydWcuZHJ1Zy5ldmVuaW5nIHx8IDApKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpbWVuX3R5cGVfaWQ6IHJlZ2ltZW4ucmVnaW1lblR5cGUuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW1lbl9kcnVnX2lkOiBkcnVnLnJlZ2ltZW5EcnVnLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucm93cyA9IFsuLi50aGlzLnJvd3NdO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5kcnVncy5wdXNoKGRydWcuZHJ1Zyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvd3MgPSB0aGlzLnJvd3MuZmlsdGVyKHJvdyA9PiB0aGlzLnNlbGVjdGVkUmVnaW1lbnMubWFwKHJlZ2ltZW4xID0+IHJlZ2ltZW4xLmlkKS5pbmNsdWRlcyhyb3cucmVnaW1lbl9pZCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRydWdzLmZvckVhY2goZHJ1ZzEgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJvd3MubWFwKHIgPT4gci5kZXNjcmlwdGlvbikuaW5jbHVkZXMoZHJ1ZzEubmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRydWdzID0gdGhpcy5kcnVncy5maWx0ZXIoZCA9PiBkLmlkICE9PSBkcnVnMS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHVwZGF0ZVZhbHVlKGV2ZW50LCBjZWxsLCByb3dJbmRleCkge1xuICAgICAgICB0aGlzLmVkaXRpbmdbcm93SW5kZXggKyAnLScgKyBjZWxsXSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJvd3Nbcm93SW5kZXhdW2NlbGxdID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgICAgICBpZiAodGhpcy5lbnRpdHkuZHVyYXRpb24pIHtcbiAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQodGhpcy5yb3dzW3Jvd0luZGV4XVsnbW9ybmluZyddICsgJycgfHwgJzAnLCAxMCkgK1xuICAgICAgICAgICAgICAgIHBhcnNlSW50KHRoaXMucm93c1tyb3dJbmRleF1bJ2FmdGVybm9vbiddICsgJycgfHwgJzAnLCAxMCkgK1xuICAgICAgICAgICAgICAgIHBhcnNlSW50KHRoaXMucm93c1tyb3dJbmRleF1bJ2V2ZW5pbmcnXSArICcnIHx8ICcwJywgMTApO1xuICAgICAgICAgICAgdGhpcy5yb3dzW3Jvd0luZGV4XVsncXVhbnRpdHknXSA9ICh0b3RhbCAqIHRoaXMuZW50aXR5LmR1cmF0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2VsbCA9PT0gJ2R1cmF0aW9uJyAmJiB0aGlzLnJvd3Nbcm93SW5kZXhdLnJlZ2ltZW5fdHlwZV9pZCA9PT0gMTUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmVudGl0eS5kYXRlVmlzaXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmlwdFsnZGF0ZUNvbXBsZXRlZCddID0gdGhpcy5lbnRpdHkuZGF0ZVZpc2l0LmNsb25lKCkuYWRkKGV2ZW50LnRhcmdldC52YWx1ZSwgJ2RheXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJvd3MgPSBbLi4udGhpcy5yb3dzXTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN1YnNjcmliZVRvU2F2ZVJlc3BvbnNlKHJlc3VsdDogT2JzZXJ2YWJsZTxIdHRwUmVzcG9uc2U8YW55Pj4pIHtcbiAgICAgICAgcmVzdWx0LnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXM6IEh0dHBSZXNwb25zZTxhbnk+KSA9PiB0aGlzLm9uU2F2ZVN1Y2Nlc3MocmVzLmJvZHkpLFxuICAgICAgICAgICAgKHJlczogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2F2ZUVycm9yKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKHJlcy5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TYXZlU3VjY2VzcyhyZXN1bHQ6IGFueSkge1xuICAgICAgICB0aGlzLmFwcExvYWRlclNlcnZpY2UuY2xvc2UoKTtcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbi5zaG93SW5mbygnUGhhcm1hY3kgdmlzaXQgc3VjY2Vzc2Z1bGx5IHNhdmVkJyk7XG4gICAgICAgIHRoaXMucHJldmlvdXNTdGF0ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgb25TYXZlRXJyb3IoKSB7XG4gICAgICAgIHRoaXMuaXNTYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lcnJvciA9IHRydWU7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uLnNob3dFcnJvcignRXJyb3Igc2F2aW5nIHBoYXJtYWN5IHZpc2l0Jyk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIG9uRXJyb3IoZXJyb3JNZXNzYWdlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5pc1NhdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbi5zaG93RXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICB9XG59XG4iXX0=